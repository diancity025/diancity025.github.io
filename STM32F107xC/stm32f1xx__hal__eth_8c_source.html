<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>STM32F107xC HAL User Manual: stm32f1xx_hal_eth.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">STM32F107xC HAL User Manual
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_87d736d687b37c2c2535f3171b4da10d.html">Firmware</a>      </li>
      <li class="navelem"><a class="el" href="dir_77a4a036479ba611396f4796e3271770.html">Drivers</a>      </li>
      <li class="navelem"><a class="el" href="dir_e90ca8f7a3453277a713b77fb925b18f.html">STM32F1xx_HAL_Driver</a>      </li>
      <li class="navelem"><a class="el" href="dir_08b87254197b135abc61821bb66d28f7.html">Src</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">stm32f1xx_hal_eth.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="stm32f1xx__hal__eth_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**</span>
<a name="l00002"></a>00002 <span class="comment">  ******************************************************************************</span>
<a name="l00003"></a>00003 <span class="comment">  * @file    stm32f1xx_hal_eth.c</span>
<a name="l00004"></a>00004 <span class="comment">  * @author  MCD Application Team</span>
<a name="l00005"></a>00005 <span class="comment">  * @brief   ETH HAL module driver.</span>
<a name="l00006"></a>00006 <span class="comment">  *          This file provides firmware functions to manage the following</span>
<a name="l00007"></a>00007 <span class="comment">  *          functionalities of the Ethernet (ETH) peripheral:</span>
<a name="l00008"></a>00008 <span class="comment">  *           + Initialization and de-initialization functions</span>
<a name="l00009"></a>00009 <span class="comment">  *           + IO operation functions</span>
<a name="l00010"></a>00010 <span class="comment">  *           + Peripheral Control functions</span>
<a name="l00011"></a>00011 <span class="comment">  *           + Peripheral State and Errors functions</span>
<a name="l00012"></a>00012 <span class="comment">  *</span>
<a name="l00013"></a>00013 <span class="comment">  @verbatim</span>
<a name="l00014"></a>00014 <span class="comment">  ==============================================================================</span>
<a name="l00015"></a>00015 <span class="comment">                    ##### How to use this driver #####</span>
<a name="l00016"></a>00016 <span class="comment">  ==============================================================================</span>
<a name="l00017"></a>00017 <span class="comment">    [..]</span>
<a name="l00018"></a>00018 <span class="comment">      (#)Declare a ETH_HandleTypeDef handle structure, for example:</span>
<a name="l00019"></a>00019 <span class="comment">         ETH_HandleTypeDef  heth;</span>
<a name="l00020"></a>00020 <span class="comment"></span>
<a name="l00021"></a>00021 <span class="comment">      (#)Fill parameters of Init structure in heth handle</span>
<a name="l00022"></a>00022 <span class="comment"></span>
<a name="l00023"></a>00023 <span class="comment">      (#)Call HAL_ETH_Init() API to initialize the Ethernet peripheral (MAC, DMA, ...)</span>
<a name="l00024"></a>00024 <span class="comment"></span>
<a name="l00025"></a>00025 <span class="comment">      (#)Initialize the ETH low level resources through the HAL_ETH_MspInit() API:</span>
<a name="l00026"></a>00026 <span class="comment">          (##) Enable the Ethernet interface clock using</span>
<a name="l00027"></a>00027 <span class="comment">               (+++) __HAL_RCC_ETHMAC_CLK_ENABLE();</span>
<a name="l00028"></a>00028 <span class="comment">               (+++) __HAL_RCC_ETHMACTX_CLK_ENABLE();</span>
<a name="l00029"></a>00029 <span class="comment">               (+++) __HAL_RCC_ETHMACRX_CLK_ENABLE();</span>
<a name="l00030"></a>00030 <span class="comment"></span>
<a name="l00031"></a>00031 <span class="comment">          (##) Initialize the related GPIO clocks</span>
<a name="l00032"></a>00032 <span class="comment">          (##) Configure Ethernet pin-out</span>
<a name="l00033"></a>00033 <span class="comment">          (##) Configure Ethernet NVIC interrupt (IT mode)</span>
<a name="l00034"></a>00034 <span class="comment"></span>
<a name="l00035"></a>00035 <span class="comment">      (#)Initialize Ethernet DMA Descriptors in chain mode and point to allocated buffers:</span>
<a name="l00036"></a>00036 <span class="comment">          (##) HAL_ETH_DMATxDescListInit(); for Transmission process</span>
<a name="l00037"></a>00037 <span class="comment">          (##) HAL_ETH_DMARxDescListInit(); for Reception process</span>
<a name="l00038"></a>00038 <span class="comment"></span>
<a name="l00039"></a>00039 <span class="comment">      (#)Enable MAC and DMA transmission and reception:</span>
<a name="l00040"></a>00040 <span class="comment">          (##) HAL_ETH_Start();</span>
<a name="l00041"></a>00041 <span class="comment"></span>
<a name="l00042"></a>00042 <span class="comment">      (#)Prepare ETH DMA TX Descriptors and give the hand to ETH DMA to transfer</span>
<a name="l00043"></a>00043 <span class="comment">         the frame to MAC TX FIFO:</span>
<a name="l00044"></a>00044 <span class="comment">         (##) HAL_ETH_TransmitFrame();</span>
<a name="l00045"></a>00045 <span class="comment"></span>
<a name="l00046"></a>00046 <span class="comment">      (#)Poll for a received frame in ETH RX DMA Descriptors and get received</span>
<a name="l00047"></a>00047 <span class="comment">         frame parameters</span>
<a name="l00048"></a>00048 <span class="comment">         (##) HAL_ETH_GetReceivedFrame(); (should be called into an infinite loop)</span>
<a name="l00049"></a>00049 <span class="comment"></span>
<a name="l00050"></a>00050 <span class="comment">      (#) Get a received frame when an ETH RX interrupt occurs:</span>
<a name="l00051"></a>00051 <span class="comment">         (##) HAL_ETH_GetReceivedFrame_IT(); (called in IT mode only)</span>
<a name="l00052"></a>00052 <span class="comment"></span>
<a name="l00053"></a>00053 <span class="comment">      (#) Communicate with external PHY device:</span>
<a name="l00054"></a>00054 <span class="comment">         (##) Read a specific register from the PHY</span>
<a name="l00055"></a>00055 <span class="comment">              HAL_ETH_ReadPHYRegister();</span>
<a name="l00056"></a>00056 <span class="comment">         (##) Write data to a specific RHY register:</span>
<a name="l00057"></a>00057 <span class="comment">              HAL_ETH_WritePHYRegister();</span>
<a name="l00058"></a>00058 <span class="comment"></span>
<a name="l00059"></a>00059 <span class="comment">      (#) Configure the Ethernet MAC after ETH peripheral initialization</span>
<a name="l00060"></a>00060 <span class="comment">          HAL_ETH_ConfigMAC(); all MAC parameters should be filled.</span>
<a name="l00061"></a>00061 <span class="comment"></span>
<a name="l00062"></a>00062 <span class="comment">      (#) Configure the Ethernet DMA after ETH peripheral initialization</span>
<a name="l00063"></a>00063 <span class="comment">          HAL_ETH_ConfigDMA(); all DMA parameters should be filled.</span>
<a name="l00064"></a>00064 <span class="comment"></span>
<a name="l00065"></a>00065 <span class="comment">      -@- The PTP protocol and the DMA descriptors ring mode are not supported</span>
<a name="l00066"></a>00066 <span class="comment">          in this driver</span>
<a name="l00067"></a>00067 <span class="comment">*** Callback registration ***</span>
<a name="l00068"></a>00068 <span class="comment">  =============================================</span>
<a name="l00069"></a>00069 <span class="comment"></span>
<a name="l00070"></a>00070 <span class="comment">  The compilation define  USE_HAL_ETH_REGISTER_CALLBACKS when set to 1</span>
<a name="l00071"></a>00071 <span class="comment">  allows the user to configure dynamically the driver callbacks.</span>
<a name="l00072"></a>00072 <span class="comment">  Use Function @ref HAL_ETH_RegisterCallback() to register an interrupt callback.</span>
<a name="l00073"></a>00073 <span class="comment"></span>
<a name="l00074"></a>00074 <span class="comment">  Function @ref HAL_ETH_RegisterCallback() allows to register following callbacks:</span>
<a name="l00075"></a>00075 <span class="comment">    (+) TxCpltCallback   : Tx Complete Callback.</span>
<a name="l00076"></a>00076 <span class="comment">    (+) RxCpltCallback   : Rx Complete Callback.</span>
<a name="l00077"></a>00077 <span class="comment">    (+) DMAErrorCallback : DMA Error Callback.</span>
<a name="l00078"></a>00078 <span class="comment">    (+) MspInitCallback  : MspInit Callback.</span>
<a name="l00079"></a>00079 <span class="comment">    (+) MspDeInitCallback: MspDeInit Callback.</span>
<a name="l00080"></a>00080 <span class="comment"></span>
<a name="l00081"></a>00081 <span class="comment">  This function takes as parameters the HAL peripheral handle, the Callback ID</span>
<a name="l00082"></a>00082 <span class="comment">  and a pointer to the user callback function.</span>
<a name="l00083"></a>00083 <span class="comment"></span>
<a name="l00084"></a>00084 <span class="comment">  Use function @ref HAL_ETH_UnRegisterCallback() to reset a callback to the default</span>
<a name="l00085"></a>00085 <span class="comment">  weak function.</span>
<a name="l00086"></a>00086 <span class="comment">  @ref HAL_ETH_UnRegisterCallback takes as parameters the HAL peripheral handle,</span>
<a name="l00087"></a>00087 <span class="comment">  and the Callback ID.</span>
<a name="l00088"></a>00088 <span class="comment">  This function allows to reset following callbacks:</span>
<a name="l00089"></a>00089 <span class="comment">    (+) TxCpltCallback   : Tx Complete Callback.</span>
<a name="l00090"></a>00090 <span class="comment">    (+) RxCpltCallback   : Rx Complete Callback.</span>
<a name="l00091"></a>00091 <span class="comment">    (+) DMAErrorCallback : DMA Error Callback.</span>
<a name="l00092"></a>00092 <span class="comment">    (+) MspInitCallback  : MspInit Callback.</span>
<a name="l00093"></a>00093 <span class="comment">    (+) MspDeInitCallback: MspDeInit Callback.</span>
<a name="l00094"></a>00094 <span class="comment"></span>
<a name="l00095"></a>00095 <span class="comment">  By default, after the HAL_ETH_Init and when the state is HAL_ETH_STATE_RESET</span>
<a name="l00096"></a>00096 <span class="comment">  all callbacks are set to the corresponding weak functions:</span>
<a name="l00097"></a>00097 <span class="comment">  examples @ref HAL_ETH_TxCpltCallback(), @ref HAL_ETH_RxCpltCallback().</span>
<a name="l00098"></a>00098 <span class="comment">  Exception done for MspInit and MspDeInit functions that are</span>
<a name="l00099"></a>00099 <span class="comment">  reset to the legacy weak function in the HAL_ETH_Init/ @ref HAL_ETH_DeInit only when</span>
<a name="l00100"></a>00100 <span class="comment">  these callbacks are null (not registered beforehand).</span>
<a name="l00101"></a>00101 <span class="comment">  if not, MspInit or MspDeInit are not null, the HAL_ETH_Init/ @ref HAL_ETH_DeInit</span>
<a name="l00102"></a>00102 <span class="comment">  keep and use the user MspInit/MspDeInit callbacks (registered beforehand)</span>
<a name="l00103"></a>00103 <span class="comment"></span>
<a name="l00104"></a>00104 <span class="comment">  Callbacks can be registered/unregistered in HAL_ETH_STATE_READY state only.</span>
<a name="l00105"></a>00105 <span class="comment">  Exception done MspInit/MspDeInit that can be registered/unregistered</span>
<a name="l00106"></a>00106 <span class="comment">  in HAL_ETH_STATE_READY or HAL_ETH_STATE_RESET state,</span>
<a name="l00107"></a>00107 <span class="comment">  thus registered (user) MspInit/DeInit callbacks can be used during the Init/DeInit.</span>
<a name="l00108"></a>00108 <span class="comment">  In that case first register the MspInit/MspDeInit user callbacks</span>
<a name="l00109"></a>00109 <span class="comment">  using @ref HAL_ETH_RegisterCallback() before calling @ref HAL_ETH_DeInit</span>
<a name="l00110"></a>00110 <span class="comment">  or HAL_ETH_Init function.</span>
<a name="l00111"></a>00111 <span class="comment"></span>
<a name="l00112"></a>00112 <span class="comment">  When The compilation define USE_HAL_ETH_REGISTER_CALLBACKS is set to 0 or</span>
<a name="l00113"></a>00113 <span class="comment">  not defined, the callback registration feature is not available and all callbacks</span>
<a name="l00114"></a>00114 <span class="comment">  are set to the corresponding weak functions.</span>
<a name="l00115"></a>00115 <span class="comment"></span>
<a name="l00116"></a>00116 <span class="comment">  @endverbatim</span>
<a name="l00117"></a>00117 <span class="comment">  ******************************************************************************</span>
<a name="l00118"></a>00118 <span class="comment">  * @attention</span>
<a name="l00119"></a>00119 <span class="comment">  *</span>
<a name="l00120"></a>00120 <span class="comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2016 STMicroelectronics.</span>
<a name="l00121"></a>00121 <span class="comment">  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;</span>
<a name="l00122"></a>00122 <span class="comment">  *</span>
<a name="l00123"></a>00123 <span class="comment">  * This software component is licensed by ST under BSD 3-Clause license,</span>
<a name="l00124"></a>00124 <span class="comment">  * the &quot;License&quot;; You may not use this file except in compliance with the</span>
<a name="l00125"></a>00125 <span class="comment">  * License. You may obtain a copy of the License at:</span>
<a name="l00126"></a>00126 <span class="comment">  *                        opensource.org/licenses/BSD-3-Clause</span>
<a name="l00127"></a>00127 <span class="comment">  *</span>
<a name="l00128"></a>00128 <span class="comment">  ******************************************************************************</span>
<a name="l00129"></a>00129 <span class="comment">  */</span>
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 <span class="comment">/* Includes ------------------------------------------------------------------*/</span>
<a name="l00132"></a>00132 <span class="preprocessor">#include &quot;<a class="code" href="stm32f1xx__hal_8h.html" title="This file contains all the functions prototypes for the HAL module driver.">stm32f1xx_hal.h</a>&quot;</span>
<a name="l00133"></a>00133 <span class="comment"></span>
<a name="l00134"></a>00134 <span class="comment">/** @addtogroup STM32F1xx_HAL_Driver</span>
<a name="l00135"></a>00135 <span class="comment">  * @{</span>
<a name="l00136"></a>00136 <span class="comment">  */</span>
<a name="l00137"></a>00137 <span class="comment"></span>
<a name="l00138"></a>00138 <span class="comment">/** @defgroup ETH ETH</span>
<a name="l00139"></a>00139 <span class="comment">  * @brief ETH HAL module driver</span>
<a name="l00140"></a>00140 <span class="comment">  * @{</span>
<a name="l00141"></a>00141 <span class="comment">  */</span>
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="preprocessor">#ifdef HAL_ETH_MODULE_ENABLED</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span>
<a name="l00145"></a>00145 <span class="preprocessor">#if defined (ETH)</span>
<a name="l00146"></a>00146 <span class="preprocessor"></span>
<a name="l00147"></a>00147 <span class="comment">/* Private typedef -----------------------------------------------------------*/</span>
<a name="l00148"></a>00148 <span class="comment">/* Private define ------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l00149"></a>00149 <span class="comment">/** @defgroup ETH_Private_Constants ETH Private Constants</span>
<a name="l00150"></a>00150 <span class="comment">  * @{</span>
<a name="l00151"></a>00151 <span class="comment">  */</span>
<a name="l00152"></a><a class="code" href="group/group__ETH__Private__Constants.html#gac22cbf92abb4371ef309c5e623639de9">00152</a> <span class="preprocessor">#define ETH_TIMEOUT_SWRESET               500U</span>
<a name="l00153"></a><a class="code" href="group/group__ETH__Private__Constants.html#gaf261cec2719fc1c246c1ee6d45f2148f">00153</a> <span class="preprocessor"></span><span class="preprocessor">#define ETH_TIMEOUT_LINKED_STATE          5000U</span>
<a name="l00154"></a><a class="code" href="group/group__ETH__Private__Constants.html#ga97c7d17c7b6eacccdc39e32fc822ea92">00154</a> <span class="preprocessor"></span><span class="preprocessor">#define ETH_TIMEOUT_AUTONEGO_COMPLETED    5000U</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00156"></a>00156 <span class="comment">/**</span>
<a name="l00157"></a>00157 <span class="comment">  * @}</span>
<a name="l00158"></a>00158 <span class="comment">  */</span>
<a name="l00159"></a>00159 <span class="comment">/* Private macro -------------------------------------------------------------*/</span>
<a name="l00160"></a>00160 <span class="comment">/* Private variables ---------------------------------------------------------*/</span>
<a name="l00161"></a>00161 <span class="comment">/* Private function prototypes -----------------------------------------------*/</span><span class="comment"></span>
<a name="l00162"></a>00162 <span class="comment">/** @defgroup ETH_Private_Functions ETH Private Functions</span>
<a name="l00163"></a>00163 <span class="comment">  * @{</span>
<a name="l00164"></a>00164 <span class="comment">  */</span>
<a name="l00165"></a>00165 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#gab88fa6b6dcdf01c9924e353067112052" title="Configures Ethernet MAC and DMA with default parameters.">ETH_MACDMAConfig</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth, uint32_t err);
<a name="l00166"></a>00166 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#gad9cce41a1e68624c8ce48536a2f71bb6" title="Configures the selected MAC address.">ETH_MACAddressConfig</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth, uint32_t MacAddr, uint8_t *Addr);
<a name="l00167"></a>00167 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#ga745fa00d6214af8cecf06542f9e05d63" title="Enables the MAC reception.">ETH_MACReceptionEnable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth);
<a name="l00168"></a>00168 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#ga4d330655bc9aa7e89b0678c8e41dc843" title="Disables the MAC reception.">ETH_MACReceptionDisable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth);
<a name="l00169"></a>00169 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#gabb47dbf0dc21c9a513dd950ac0fc5a0d" title="Enables the MAC transmission.">ETH_MACTransmissionEnable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth);
<a name="l00170"></a>00170 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#ga8d818da79bab22874e7915ccded59130" title="Disables the MAC transmission.">ETH_MACTransmissionDisable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth);
<a name="l00171"></a>00171 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#ga93b1d3f59736fff1b50ef3ccc85c3bf6" title="Enables the DMA transmission.">ETH_DMATransmissionEnable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth);
<a name="l00172"></a>00172 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#ga58c934fdbdd20c3ec7a15f6e245933bf" title="Disables the DMA transmission.">ETH_DMATransmissionDisable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth);
<a name="l00173"></a>00173 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#ga40f6929c9bb79bbb13fcf8923090c4d7" title="Enables the DMA reception.">ETH_DMAReceptionEnable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth);
<a name="l00174"></a>00174 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#gaed0cf21dc49879e0fd45b2873d4a75e5" title="Disables the DMA reception.">ETH_DMAReceptionDisable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth);
<a name="l00175"></a>00175 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#gaf608a0b63258ad4adb1e9a14f8a0546f" title="Clears the ETHERNET transmit FIFO.">ETH_FlushTransmitFIFO</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth);
<a name="l00176"></a>00176 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#ga76faf4a9f268c24dccb0db6422c5a550" title="This function provides delay (in milliseconds) based on CPU cycles method.">ETH_Delay</a>(uint32_t mdelay);
<a name="l00177"></a>00177 <span class="preprocessor">#if (USE_HAL_ETH_REGISTER_CALLBACKS == 1)</span>
<a name="l00178"></a>00178 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> ETH_InitCallbacksToDefault(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth);
<a name="l00179"></a>00179 <span class="preprocessor">#endif </span><span class="comment">/* USE_HAL_ETH_REGISTER_CALLBACKS */</span>
<a name="l00180"></a>00180 <span class="comment"></span>
<a name="l00181"></a>00181 <span class="comment">/**</span>
<a name="l00182"></a>00182 <span class="comment">  * @}</span>
<a name="l00183"></a>00183 <span class="comment">  */</span>
<a name="l00184"></a>00184 <span class="comment">/* Private functions ---------------------------------------------------------*/</span>
<a name="l00185"></a>00185 <span class="comment"></span>
<a name="l00186"></a>00186 <span class="comment">/** @defgroup ETH_Exported_Functions ETH Exported Functions</span>
<a name="l00187"></a>00187 <span class="comment">  * @{</span>
<a name="l00188"></a>00188 <span class="comment">  */</span>
<a name="l00189"></a>00189 <span class="comment"></span>
<a name="l00190"></a>00190 <span class="comment">/** @defgroup ETH_Exported_Functions_Group1 Initialization and de-initialization functions</span>
<a name="l00191"></a>00191 <span class="comment">  *  @brief   Initialization and Configuration functions</span>
<a name="l00192"></a>00192 <span class="comment">  *</span>
<a name="l00193"></a>00193 <span class="comment">  @verbatim</span>
<a name="l00194"></a>00194 <span class="comment">  ===============================================================================</span>
<a name="l00195"></a>00195 <span class="comment">            ##### Initialization and de-initialization functions #####</span>
<a name="l00196"></a>00196 <span class="comment">  ===============================================================================</span>
<a name="l00197"></a>00197 <span class="comment">  [..]  This section provides functions allowing to:</span>
<a name="l00198"></a>00198 <span class="comment">      (+) Initialize and configure the Ethernet peripheral</span>
<a name="l00199"></a>00199 <span class="comment">      (+) De-initialize the Ethernet peripheral</span>
<a name="l00200"></a>00200 <span class="comment"></span>
<a name="l00201"></a>00201 <span class="comment">  @endverbatim</span>
<a name="l00202"></a>00202 <span class="comment">  * @{</span>
<a name="l00203"></a>00203 <span class="comment">  */</span>
<a name="l00204"></a>00204 <span class="comment"></span>
<a name="l00205"></a>00205 <span class="comment">/**</span>
<a name="l00206"></a>00206 <span class="comment">  * @brief  Initializes the Ethernet MAC and DMA according to default</span>
<a name="l00207"></a>00207 <span class="comment">  *         parameters.</span>
<a name="l00208"></a>00208 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l00209"></a>00209 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l00210"></a>00210 <span class="comment">  * @retval HAL status</span>
<a name="l00211"></a>00211 <span class="comment">  */</span>
<a name="l00212"></a><a class="code" href="group/group__ETH__Exported__Functions__Group1.html#gab3be78c101a3cc1ff0531bb64957cf92">00212</a> HAL_StatusTypeDef <a class="code" href="group/group__ETH__Exported__Functions__Group1.html#gab3be78c101a3cc1ff0531bb64957cf92" title="Initializes the Ethernet MAC and DMA according to default parameters.">HAL_ETH_Init</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l00213"></a>00213 {
<a name="l00214"></a>00214   uint32_t tmpreg1 = 0U, phyreg = 0U;
<a name="l00215"></a>00215   uint32_t hclk = 60000000U;
<a name="l00216"></a>00216   uint32_t tickstart = 0U;
<a name="l00217"></a>00217   uint32_t err = <a class="code" href="group/group__ETH__Private__Defines.html#ga2fb2e6248630a20832d42340e122c81c">ETH_SUCCESS</a>;
<a name="l00218"></a>00218 
<a name="l00219"></a>00219   <span class="comment">/* Check the ETH peripheral state */</span>
<a name="l00220"></a>00220   <span class="keywordflow">if</span> (heth == NULL)
<a name="l00221"></a>00221   {
<a name="l00222"></a>00222     <span class="keywordflow">return</span> HAL_ERROR;
<a name="l00223"></a>00223   }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225   <span class="comment">/* Check parameters */</span>
<a name="l00226"></a>00226   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga6741f6eb5b129d6bfbfec265175d599b">IS_ETH_AUTONEGOTIATION</a>(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#acfea26b30560ab6dad5903ec0e3f1227">AutoNegotiation</a>));
<a name="l00227"></a>00227   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga3cfc5af4ac6be1511ddf77c3d92cfdaf">IS_ETH_RX_MODE</a>(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#a6345d6d8c5ab7ad896fdcc18f5da50a2">RxMode</a>));
<a name="l00228"></a>00228   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga04b2c98598335b3e792b2429ce4b1ab2">IS_ETH_CHECKSUM_MODE</a>(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#a416fc3299228f47bf581a6c6bd6a35d3">ChecksumMode</a>));
<a name="l00229"></a>00229   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gab9fbbb170a749444e366d7fc5f9d2052">IS_ETH_MEDIA_INTERFACE</a>(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#a8e4ccbe04edd63eceec90734a90e5830">MediaInterface</a>));
<a name="l00230"></a>00230 
<a name="l00231"></a>00231   <span class="keywordflow">if</span> (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> == <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa1d415b0d43770dd61ae1bda06c487a8f">HAL_ETH_STATE_RESET</a>)
<a name="l00232"></a>00232   {
<a name="l00233"></a>00233     <span class="comment">/* Allocate lock resource and initialize it */</span>
<a name="l00234"></a>00234     heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a1f607c54995c03f79da62870f2f81676">Lock</a> = HAL_UNLOCKED;
<a name="l00235"></a>00235 <span class="preprocessor">#if (USE_HAL_ETH_REGISTER_CALLBACKS == 1)</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span>    ETH_InitCallbacksToDefault(heth);
<a name="l00237"></a>00237 
<a name="l00238"></a>00238     <span class="keywordflow">if</span> (heth-&gt;MspInitCallback == NULL)
<a name="l00239"></a>00239     {
<a name="l00240"></a>00240       <span class="comment">/* Init the low level hardware : GPIO, CLOCK, NVIC. */</span>
<a name="l00241"></a>00241       heth-&gt;MspInitCallback = <a class="code" href="group/group__ETH__Exported__Functions__Group1.html#ga1ffa1e1337d6e52a3b175144a4505ea7" title="Initializes the ETH MSP.">HAL_ETH_MspInit</a>;
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243     heth-&gt;MspInitCallback(heth);
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 <span class="preprocessor">#else</span>
<a name="l00246"></a>00246 <span class="preprocessor"></span>    <span class="comment">/* Init the low level hardware : GPIO, CLOCK, NVIC. */</span>
<a name="l00247"></a>00247     <a class="code" href="group/group__ETH__Exported__Functions__Group1.html#ga1ffa1e1337d6e52a3b175144a4505ea7" title="Initializes the ETH MSP.">HAL_ETH_MspInit</a>(heth);
<a name="l00248"></a>00248 <span class="preprocessor">#endif </span><span class="comment">/* USE_HAL_ETH_REGISTER_CALLBACKS */</span>
<a name="l00249"></a>00249   }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251   <span class="comment">/* Select MII or RMII Mode*/</span>
<a name="l00252"></a>00252   AFIO-&gt;MAPR &amp;= ~(AFIO_MAPR_MII_RMII_SEL);
<a name="l00253"></a>00253   AFIO-&gt;MAPR |= (uint32_t)heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#a8e4ccbe04edd63eceec90734a90e5830">MediaInterface</a>;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255   <span class="comment">/* Ethernet Software reset */</span>
<a name="l00256"></a>00256   <span class="comment">/* Set the SWR bit: resets all MAC subsystem internal registers and logic */</span>
<a name="l00257"></a>00257   <span class="comment">/* After reset all the registers holds their respective reset values */</span>
<a name="l00258"></a>00258   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMABMR |= ETH_DMABMR_SR;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260   <span class="comment">/* Get tick */</span>
<a name="l00261"></a>00261   tickstart = <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gaf2c4f03d53e997a54e1fd5e80daa55c4" title="Provides a tick value in millisecond.">HAL_GetTick</a>();
<a name="l00262"></a>00262 
<a name="l00263"></a>00263   <span class="comment">/* Wait for software reset */</span>
<a name="l00264"></a>00264   <span class="keywordflow">while</span> (((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMABMR &amp; ETH_DMABMR_SR) != (uint32_t)RESET)
<a name="l00265"></a>00265   {
<a name="l00266"></a>00266     <span class="comment">/* Check for the Timeout */</span>
<a name="l00267"></a>00267     <span class="keywordflow">if</span> ((<a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gaf2c4f03d53e997a54e1fd5e80daa55c4" title="Provides a tick value in millisecond.">HAL_GetTick</a>() - tickstart) &gt; <a class="code" href="group/group__ETH__Private__Constants.html#gac22cbf92abb4371ef309c5e623639de9">ETH_TIMEOUT_SWRESET</a>)
<a name="l00268"></a>00268     {
<a name="l00269"></a>00269       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfab4c4e00abe9f8ff6c006bb127282b190">HAL_ETH_STATE_TIMEOUT</a>;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271       <span class="comment">/* Process Unlocked */</span>
<a name="l00272"></a>00272       __HAL_UNLOCK(heth);
<a name="l00273"></a>00273 
<a name="l00274"></a>00274       <span class="comment">/* Note: The SWR is not performed if the ETH_RX_CLK or the ETH_TX_CLK are</span>
<a name="l00275"></a>00275 <span class="comment">         not available, please check your external PHY or the IO configuration */</span>
<a name="l00276"></a>00276       <span class="keywordflow">return</span> HAL_TIMEOUT;
<a name="l00277"></a>00277     }
<a name="l00278"></a>00278   }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280   <span class="comment">/*-------------------------------- MAC Initialization ----------------------*/</span>
<a name="l00281"></a>00281   <span class="comment">/* Get the ETHERNET MACMIIAR value */</span>
<a name="l00282"></a>00282   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACMIIAR;
<a name="l00283"></a>00283   <span class="comment">/* Clear CSR Clock Range CR[2:0] bits */</span>
<a name="l00284"></a>00284   tmpreg1 &amp;= <a class="code" href="group/group__ETH__Private__Defines.html#gaf99ee8ca4e2417ef84c83dcb8efd6319">ETH_MACMIIAR_CR_MASK</a>;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286   <span class="comment">/* Get hclk frequency value */</span>
<a name="l00287"></a>00287   hclk = <a class="code" href="group__RCC__Exported__Functions__Group2.html#ga38d6c5c7a5d8758849912c9aa0a2156d" title="Returns the HCLK frequency.">HAL_RCC_GetHCLKFreq</a>();
<a name="l00288"></a>00288 
<a name="l00289"></a>00289   <span class="comment">/* Set CR bits depending on hclk value */</span>
<a name="l00290"></a>00290   <span class="keywordflow">if</span> ((hclk &gt;= 20000000U) &amp;&amp; (hclk &lt; 35000000U))
<a name="l00291"></a>00291   {
<a name="l00292"></a>00292     <span class="comment">/* CSR Clock Range between 20-35 MHz */</span>
<a name="l00293"></a>00293     tmpreg1 |= (uint32_t)ETH_MACMIIAR_CR_DIV16;
<a name="l00294"></a>00294   }
<a name="l00295"></a>00295   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((hclk &gt;= 35000000U) &amp;&amp; (hclk &lt; 60000000U))
<a name="l00296"></a>00296   {
<a name="l00297"></a>00297     <span class="comment">/* CSR Clock Range between 35-60 MHz */</span>
<a name="l00298"></a>00298     tmpreg1 |= (uint32_t)ETH_MACMIIAR_CR_DIV26;
<a name="l00299"></a>00299   }
<a name="l00300"></a>00300   <span class="keywordflow">else</span>
<a name="l00301"></a>00301   {
<a name="l00302"></a>00302     <span class="comment">/* CSR Clock Range between 60-72 MHz */</span>
<a name="l00303"></a>00303     tmpreg1 |= (uint32_t)ETH_MACMIIAR_CR_DIV42;
<a name="l00304"></a>00304   }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306   <span class="comment">/* Write to ETHERNET MAC MIIAR: Configure the ETHERNET CSR Clock Range */</span>
<a name="l00307"></a>00307   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACMIIAR = (uint32_t)tmpreg1;
<a name="l00308"></a>00308 
<a name="l00309"></a>00309   <span class="comment">/*-------------------- PHY initialization and configuration ----------------*/</span>
<a name="l00310"></a>00310   <span class="comment">/* Put the PHY in reset mode */</span>
<a name="l00311"></a>00311   <span class="keywordflow">if</span> ((<a class="code" href="group/group__ETH__Exported__Functions__Group2.html#ga3e46a062a5a97b8b5920bbd5bfdd09e7" title="Writes to a PHY register.">HAL_ETH_WritePHYRegister</a>(heth, <a class="code" href="stm32f1xx__hal__conf_8h.html#a8abe1a40c71e68881ec669d59f513fdb">PHY_BCR</a>, <a class="code" href="stm32f1xx__hal__conf_8h.html#a6f5048620b3dde8583f7f1118e9de187">PHY_RESET</a>)) != HAL_OK)
<a name="l00312"></a>00312   {
<a name="l00313"></a>00313     <span class="comment">/* In case of write timeout */</span>
<a name="l00314"></a>00314     err = <a class="code" href="group/group__ETH__Private__Defines.html#ga86fb9fb94bfcabd7360fc2307131f853">ETH_ERROR</a>;
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     <span class="comment">/* Config MAC and DMA */</span>
<a name="l00317"></a>00317     <a class="code" href="group/group__ETH__Private__Functions.html#gab88fa6b6dcdf01c9924e353067112052" title="Configures Ethernet MAC and DMA with default parameters.">ETH_MACDMAConfig</a>(heth, err);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     <span class="comment">/* Set the ETH peripheral state to READY */</span>
<a name="l00320"></a>00320     heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     <span class="comment">/* Return HAL_ERROR */</span>
<a name="l00323"></a>00323     <span class="keywordflow">return</span> HAL_ERROR;
<a name="l00324"></a>00324   }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326   <span class="comment">/* Delay to assure PHY reset */</span>
<a name="l00327"></a>00327   <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gae63b34eea12780ca2e1100c2402da18e" title="This function provides minimum delay (in milliseconds) based on variable incremented.">HAL_Delay</a>(<a class="code" href="stm32f1xx__hal__conf_8h.html#a0ede6087f7b71403bcddb5d3a8f47ff4">PHY_RESET_DELAY</a>);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329   <span class="keywordflow">if</span> ((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).AutoNegotiation != <a class="code" href="group/group__ETH__AutoNegotiation.html#ga87276ad51565f38e4b9f621c23046004">ETH_AUTONEGOTIATION_DISABLE</a>)
<a name="l00330"></a>00330   {
<a name="l00331"></a>00331     <span class="comment">/* Get tick */</span>
<a name="l00332"></a>00332     tickstart = <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gaf2c4f03d53e997a54e1fd5e80daa55c4" title="Provides a tick value in millisecond.">HAL_GetTick</a>();
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     <span class="comment">/* We wait for linked status */</span>
<a name="l00335"></a>00335     <span class="keywordflow">do</span>
<a name="l00336"></a>00336     {
<a name="l00337"></a>00337       <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#ga1cc478c81ef8f44c021828249b07b86a" title="Reads a PHY register.">HAL_ETH_ReadPHYRegister</a>(heth, <a class="code" href="stm32f1xx__hal__conf_8h.html#a4b8f2c29a9e74412395e1b1809666838">PHY_BSR</a>, &amp;phyreg);
<a name="l00338"></a>00338 
<a name="l00339"></a>00339       <span class="comment">/* Check for the Timeout */</span>
<a name="l00340"></a>00340       <span class="keywordflow">if</span> ((<a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gaf2c4f03d53e997a54e1fd5e80daa55c4" title="Provides a tick value in millisecond.">HAL_GetTick</a>() - tickstart) &gt; <a class="code" href="group/group__ETH__Private__Constants.html#gaf261cec2719fc1c246c1ee6d45f2148f">ETH_TIMEOUT_LINKED_STATE</a>)
<a name="l00341"></a>00341       {
<a name="l00342"></a>00342         <span class="comment">/* In case of write timeout */</span>
<a name="l00343"></a>00343         err = <a class="code" href="group/group__ETH__Private__Defines.html#ga86fb9fb94bfcabd7360fc2307131f853">ETH_ERROR</a>;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345         <span class="comment">/* Config MAC and DMA */</span>
<a name="l00346"></a>00346         <a class="code" href="group/group__ETH__Private__Functions.html#gab88fa6b6dcdf01c9924e353067112052" title="Configures Ethernet MAC and DMA with default parameters.">ETH_MACDMAConfig</a>(heth, err);
<a name="l00347"></a>00347 
<a name="l00348"></a>00348         heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l00349"></a>00349 
<a name="l00350"></a>00350         <span class="comment">/* Process Unlocked */</span>
<a name="l00351"></a>00351         __HAL_UNLOCK(heth);
<a name="l00352"></a>00352 
<a name="l00353"></a>00353         <span class="keywordflow">return</span> HAL_TIMEOUT;
<a name="l00354"></a>00354       }
<a name="l00355"></a>00355     }
<a name="l00356"></a>00356     <span class="keywordflow">while</span> (((phyreg &amp; <a class="code" href="stm32f1xx__hal__conf_8h.html#ace209074499dbef0b97300da5bd7c707">PHY_LINKED_STATUS</a>) != PHY_LINKED_STATUS));
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 
<a name="l00359"></a>00359     <span class="comment">/* Enable Auto-Negotiation */</span>
<a name="l00360"></a>00360     <span class="keywordflow">if</span> ((<a class="code" href="group/group__ETH__Exported__Functions__Group2.html#ga3e46a062a5a97b8b5920bbd5bfdd09e7" title="Writes to a PHY register.">HAL_ETH_WritePHYRegister</a>(heth, <a class="code" href="stm32f1xx__hal__conf_8h.html#a8abe1a40c71e68881ec669d59f513fdb">PHY_BCR</a>, <a class="code" href="stm32f1xx__hal__conf_8h.html#a9b7f5c8f71047ee449f21562d26b1b43">PHY_AUTONEGOTIATION</a>)) != HAL_OK)
<a name="l00361"></a>00361     {
<a name="l00362"></a>00362       <span class="comment">/* In case of write timeout */</span>
<a name="l00363"></a>00363       err = <a class="code" href="group/group__ETH__Private__Defines.html#ga86fb9fb94bfcabd7360fc2307131f853">ETH_ERROR</a>;
<a name="l00364"></a>00364 
<a name="l00365"></a>00365       <span class="comment">/* Config MAC and DMA */</span>
<a name="l00366"></a>00366       <a class="code" href="group/group__ETH__Private__Functions.html#gab88fa6b6dcdf01c9924e353067112052" title="Configures Ethernet MAC and DMA with default parameters.">ETH_MACDMAConfig</a>(heth, err);
<a name="l00367"></a>00367 
<a name="l00368"></a>00368       <span class="comment">/* Set the ETH peripheral state to READY */</span>
<a name="l00369"></a>00369       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371       <span class="comment">/* Return HAL_ERROR */</span>
<a name="l00372"></a>00372       <span class="keywordflow">return</span> HAL_ERROR;
<a name="l00373"></a>00373     }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="comment">/* Get tick */</span>
<a name="l00376"></a>00376     tickstart = <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gaf2c4f03d53e997a54e1fd5e80daa55c4" title="Provides a tick value in millisecond.">HAL_GetTick</a>();
<a name="l00377"></a>00377 
<a name="l00378"></a>00378     <span class="comment">/* Wait until the auto-negotiation will be completed */</span>
<a name="l00379"></a>00379     <span class="keywordflow">do</span>
<a name="l00380"></a>00380     {
<a name="l00381"></a>00381       <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#ga1cc478c81ef8f44c021828249b07b86a" title="Reads a PHY register.">HAL_ETH_ReadPHYRegister</a>(heth, <a class="code" href="stm32f1xx__hal__conf_8h.html#a4b8f2c29a9e74412395e1b1809666838">PHY_BSR</a>, &amp;phyreg);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383       <span class="comment">/* Check for the Timeout */</span>
<a name="l00384"></a>00384       <span class="keywordflow">if</span> ((<a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gaf2c4f03d53e997a54e1fd5e80daa55c4" title="Provides a tick value in millisecond.">HAL_GetTick</a>() - tickstart) &gt; <a class="code" href="group/group__ETH__Private__Constants.html#ga97c7d17c7b6eacccdc39e32fc822ea92">ETH_TIMEOUT_AUTONEGO_COMPLETED</a>)
<a name="l00385"></a>00385       {
<a name="l00386"></a>00386         <span class="comment">/* In case of write timeout */</span>
<a name="l00387"></a>00387         err = <a class="code" href="group/group__ETH__Private__Defines.html#ga86fb9fb94bfcabd7360fc2307131f853">ETH_ERROR</a>;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389         <span class="comment">/* Config MAC and DMA */</span>
<a name="l00390"></a>00390         <a class="code" href="group/group__ETH__Private__Functions.html#gab88fa6b6dcdf01c9924e353067112052" title="Configures Ethernet MAC and DMA with default parameters.">ETH_MACDMAConfig</a>(heth, err);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392         heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l00393"></a>00393 
<a name="l00394"></a>00394         <span class="comment">/* Process Unlocked */</span>
<a name="l00395"></a>00395         __HAL_UNLOCK(heth);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397         <span class="keywordflow">return</span> HAL_TIMEOUT;
<a name="l00398"></a>00398       }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400     }
<a name="l00401"></a>00401     <span class="keywordflow">while</span> (((phyreg &amp; <a class="code" href="stm32f1xx__hal__conf_8h.html#a36c4dbd5f6df1f5eaefa010929ef9773">PHY_AUTONEGO_COMPLETE</a>) != PHY_AUTONEGO_COMPLETE));
<a name="l00402"></a>00402 
<a name="l00403"></a>00403     <span class="comment">/* Read the result of the auto-negotiation */</span>
<a name="l00404"></a>00404     <span class="keywordflow">if</span> ((<a class="code" href="group/group__ETH__Exported__Functions__Group2.html#ga1cc478c81ef8f44c021828249b07b86a" title="Reads a PHY register.">HAL_ETH_ReadPHYRegister</a>(heth, <a class="code" href="stm32f1xx__hal__conf_8h.html#a32b55e84d27cf298a77f54b133cd1acc">PHY_SR</a>, &amp;phyreg)) != HAL_OK)
<a name="l00405"></a>00405     {
<a name="l00406"></a>00406       <span class="comment">/* In case of write timeout */</span>
<a name="l00407"></a>00407       err = <a class="code" href="group/group__ETH__Private__Defines.html#ga86fb9fb94bfcabd7360fc2307131f853">ETH_ERROR</a>;
<a name="l00408"></a>00408 
<a name="l00409"></a>00409       <span class="comment">/* Config MAC and DMA */</span>
<a name="l00410"></a>00410       <a class="code" href="group/group__ETH__Private__Functions.html#gab88fa6b6dcdf01c9924e353067112052" title="Configures Ethernet MAC and DMA with default parameters.">ETH_MACDMAConfig</a>(heth, err);
<a name="l00411"></a>00411 
<a name="l00412"></a>00412       <span class="comment">/* Set the ETH peripheral state to READY */</span>
<a name="l00413"></a>00413       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l00414"></a>00414 
<a name="l00415"></a>00415       <span class="comment">/* Return HAL_ERROR */</span>
<a name="l00416"></a>00416       <span class="keywordflow">return</span> HAL_ERROR;
<a name="l00417"></a>00417     }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419     <span class="comment">/* Configure the MAC with the Duplex Mode fixed by the auto-negotiation process */</span>
<a name="l00420"></a>00420     <span class="keywordflow">if</span> ((phyreg &amp; <a class="code" href="stm32f1xx__hal__conf_8h.html#ab928f45585242fde1a8d81a2d9ed22d0">PHY_DUPLEX_STATUS</a>) != (uint32_t)RESET)
<a name="l00421"></a>00421     {
<a name="l00422"></a>00422       <span class="comment">/* Set Ethernet duplex mode to Full-duplex following the auto-negotiation */</span>
<a name="l00423"></a>00423       (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).DuplexMode = <a class="code" href="group/group__ETH__Duplex__Mode.html#ga348c63c8ed45aa8db82b2854621a3e0f">ETH_MODE_FULLDUPLEX</a>;
<a name="l00424"></a>00424     }
<a name="l00425"></a>00425     <span class="keywordflow">else</span>
<a name="l00426"></a>00426     {
<a name="l00427"></a>00427       <span class="comment">/* Set Ethernet duplex mode to Half-duplex following the auto-negotiation */</span>
<a name="l00428"></a>00428       (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).DuplexMode = <a class="code" href="group/group__ETH__Duplex__Mode.html#gac37172fec3fd5b1baf59ce5bc6a0cc39">ETH_MODE_HALFDUPLEX</a>;
<a name="l00429"></a>00429     }
<a name="l00430"></a>00430     <span class="comment">/* Configure the MAC with the speed fixed by the auto-negotiation process */</span>
<a name="l00431"></a>00431     <span class="keywordflow">if</span> ((phyreg &amp; <a class="code" href="stm32f1xx__hal__conf_8h.html#a74c081bc55e9ff96bf229f44e96c6155">PHY_SPEED_STATUS</a>) == <a class="code" href="stm32f1xx__hal__conf_8h.html#a74c081bc55e9ff96bf229f44e96c6155">PHY_SPEED_STATUS</a>)
<a name="l00432"></a>00432     {
<a name="l00433"></a>00433       <span class="comment">/* Set Ethernet speed to 10M following the auto-negotiation */</span>
<a name="l00434"></a>00434       (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).Speed = <a class="code" href="group/group__ETH__Speed.html#ga6250c0719b4711b6d225d3fdfa4272e8">ETH_SPEED_10M</a>;
<a name="l00435"></a>00435     }
<a name="l00436"></a>00436     <span class="keywordflow">else</span>
<a name="l00437"></a>00437     {
<a name="l00438"></a>00438       <span class="comment">/* Set Ethernet speed to 100M following the auto-negotiation */</span>
<a name="l00439"></a>00439       (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).Speed = <a class="code" href="group/group__ETH__Speed.html#ga30250d05d2e66449bfde40ff20a5bc85">ETH_SPEED_100M</a>;
<a name="l00440"></a>00440     }
<a name="l00441"></a>00441   }
<a name="l00442"></a>00442   <span class="keywordflow">else</span> <span class="comment">/* AutoNegotiation Disable */</span>
<a name="l00443"></a>00443   {
<a name="l00444"></a>00444     <span class="comment">/* Check parameters */</span>
<a name="l00445"></a>00445     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga40e3bc2833cd65e7f1ea1d2501cb6f5b">IS_ETH_SPEED</a>(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#aa3937b6109b57f923be10b7ed01d4851">Speed</a>));
<a name="l00446"></a>00446     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga969fd727f78be3069201ce46af4bd9a5">IS_ETH_DUPLEX_MODE</a>(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#a54655cd6e0aa3279608559e2eeb5e28c">DuplexMode</a>));
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <span class="comment">/* Set MAC Speed and Duplex Mode */</span>
<a name="l00449"></a>00449     <span class="keywordflow">if</span> (<a class="code" href="group/group__ETH__Exported__Functions__Group2.html#ga3e46a062a5a97b8b5920bbd5bfdd09e7" title="Writes to a PHY register.">HAL_ETH_WritePHYRegister</a>(heth, <a class="code" href="stm32f1xx__hal__conf_8h.html#a8abe1a40c71e68881ec669d59f513fdb">PHY_BCR</a>, ((uint16_t)((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).DuplexMode &gt;&gt; 3U) |
<a name="l00450"></a>00450                                                  (uint16_t)((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).Speed &gt;&gt; 1U))) != HAL_OK)
<a name="l00451"></a>00451     {
<a name="l00452"></a>00452       <span class="comment">/* In case of write timeout */</span>
<a name="l00453"></a>00453       err = <a class="code" href="group/group__ETH__Private__Defines.html#ga86fb9fb94bfcabd7360fc2307131f853">ETH_ERROR</a>;
<a name="l00454"></a>00454 
<a name="l00455"></a>00455       <span class="comment">/* Config MAC and DMA */</span>
<a name="l00456"></a>00456       <a class="code" href="group/group__ETH__Private__Functions.html#gab88fa6b6dcdf01c9924e353067112052" title="Configures Ethernet MAC and DMA with default parameters.">ETH_MACDMAConfig</a>(heth, err);
<a name="l00457"></a>00457 
<a name="l00458"></a>00458       <span class="comment">/* Set the ETH peripheral state to READY */</span>
<a name="l00459"></a>00459       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l00460"></a>00460 
<a name="l00461"></a>00461       <span class="comment">/* Return HAL_ERROR */</span>
<a name="l00462"></a>00462       <span class="keywordflow">return</span> HAL_ERROR;
<a name="l00463"></a>00463     }
<a name="l00464"></a>00464 
<a name="l00465"></a>00465     <span class="comment">/* Delay to assure PHY configuration */</span>
<a name="l00466"></a>00466     <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gae63b34eea12780ca2e1100c2402da18e" title="This function provides minimum delay (in milliseconds) based on variable incremented.">HAL_Delay</a>(<a class="code" href="stm32f1xx__hal__conf_8h.html#abba7114255a2a41b81fdcb2a3702c270">PHY_CONFIG_DELAY</a>);
<a name="l00467"></a>00467   }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469   <span class="comment">/* Config MAC and DMA */</span>
<a name="l00470"></a>00470   <a class="code" href="group/group__ETH__Private__Functions.html#gab88fa6b6dcdf01c9924e353067112052" title="Configures Ethernet MAC and DMA with default parameters.">ETH_MACDMAConfig</a>(heth, err);
<a name="l00471"></a>00471 
<a name="l00472"></a>00472   <span class="comment">/* Set ETH HAL State to Ready */</span>
<a name="l00473"></a>00473   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l00474"></a>00474 
<a name="l00475"></a>00475   <span class="comment">/* Return function status */</span>
<a name="l00476"></a>00476   <span class="keywordflow">return</span> HAL_OK;
<a name="l00477"></a>00477 }
<a name="l00478"></a>00478 <span class="comment"></span>
<a name="l00479"></a>00479 <span class="comment">/**</span>
<a name="l00480"></a>00480 <span class="comment">  * @brief  De-Initializes the ETH peripheral.</span>
<a name="l00481"></a>00481 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l00482"></a>00482 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l00483"></a>00483 <span class="comment">  * @retval HAL status</span>
<a name="l00484"></a>00484 <span class="comment">  */</span>
<a name="l00485"></a><a class="code" href="group/group__ETH__Exported__Functions__Group1.html#gabae088dc391c6b7a7ddb93103031195b">00485</a> HAL_StatusTypeDef <a class="code" href="group/group__ETH__Exported__Functions__Group1.html#gabae088dc391c6b7a7ddb93103031195b" title="De-Initializes the ETH peripheral.">HAL_ETH_DeInit</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l00486"></a>00486 {
<a name="l00487"></a>00487   <span class="comment">/* Set the ETH peripheral state to BUSY */</span>
<a name="l00488"></a>00488   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfae4efe1419676b9077d9ca9133d6dce9c">HAL_ETH_STATE_BUSY</a>;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490 <span class="preprocessor">#if (USE_HAL_ETH_REGISTER_CALLBACKS == 1)</span>
<a name="l00491"></a>00491 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (heth-&gt;MspDeInitCallback == NULL)
<a name="l00492"></a>00492   {
<a name="l00493"></a>00493     heth-&gt;MspDeInitCallback = <a class="code" href="group/group__ETH__Exported__Functions__Group1.html#gadb9c31d86584307ca7791f3c3fbe58d9" title="DeInitializes ETH MSP.">HAL_ETH_MspDeInit</a>;
<a name="l00494"></a>00494   }
<a name="l00495"></a>00495   <span class="comment">/* De-Init the low level hardware : GPIO, CLOCK, NVIC. */</span>
<a name="l00496"></a>00496   heth-&gt;MspDeInitCallback(heth);
<a name="l00497"></a>00497 <span class="preprocessor">#else</span>
<a name="l00498"></a>00498 <span class="preprocessor"></span>  <span class="comment">/* De-Init the low level hardware : GPIO, CLOCK, NVIC. */</span>
<a name="l00499"></a>00499   <a class="code" href="group/group__ETH__Exported__Functions__Group1.html#gadb9c31d86584307ca7791f3c3fbe58d9" title="DeInitializes ETH MSP.">HAL_ETH_MspDeInit</a>(heth);
<a name="l00500"></a>00500 <span class="preprocessor">#endif</span>
<a name="l00501"></a>00501 <span class="preprocessor"></span>
<a name="l00502"></a>00502   <span class="comment">/* Set ETH HAL state to Disabled */</span>
<a name="l00503"></a>00503   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa1d415b0d43770dd61ae1bda06c487a8f">HAL_ETH_STATE_RESET</a>;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505   <span class="comment">/* Release Lock */</span>
<a name="l00506"></a>00506   __HAL_UNLOCK(heth);
<a name="l00507"></a>00507 
<a name="l00508"></a>00508   <span class="comment">/* Return function status */</span>
<a name="l00509"></a>00509   <span class="keywordflow">return</span> HAL_OK;
<a name="l00510"></a>00510 }
<a name="l00511"></a>00511 <span class="comment"></span>
<a name="l00512"></a>00512 <span class="comment">/**</span>
<a name="l00513"></a>00513 <span class="comment">  * @brief  Initializes the DMA Tx descriptors in chain mode.</span>
<a name="l00514"></a>00514 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l00515"></a>00515 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l00516"></a>00516 <span class="comment">  * @param  DMATxDescTab: Pointer to the first Tx desc list</span>
<a name="l00517"></a>00517 <span class="comment">  * @param  TxBuff: Pointer to the first TxBuffer list</span>
<a name="l00518"></a>00518 <span class="comment">  * @param  TxBuffCount: Number of the used Tx desc in the list</span>
<a name="l00519"></a>00519 <span class="comment">  * @retval HAL status</span>
<a name="l00520"></a>00520 <span class="comment">  */</span>
<a name="l00521"></a><a class="code" href="group/group__ETH__Exported__Functions__Group1.html#ga349a3f5021f5ae421077e23a26743a65">00521</a> HAL_StatusTypeDef <a class="code" href="group/group__ETH__Exported__Functions__Group1.html#ga349a3f5021f5ae421077e23a26743a65" title="Initializes the DMA Tx descriptors in chain mode.">HAL_ETH_DMATxDescListInit</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth, <a class="code" href="structETH__DMADescTypeDef.html" title="ETH DMA Descriptors data structure definition.">ETH_DMADescTypeDef</a> *DMATxDescTab, uint8_t *TxBuff, uint32_t TxBuffCount)
<a name="l00522"></a>00522 {
<a name="l00523"></a>00523   uint32_t i = 0U;
<a name="l00524"></a>00524   <a class="code" href="structETH__DMADescTypeDef.html" title="ETH DMA Descriptors data structure definition.">ETH_DMADescTypeDef</a> *dmatxdesc;
<a name="l00525"></a>00525 
<a name="l00526"></a>00526   <span class="comment">/* Process Locked */</span>
<a name="l00527"></a>00527   __HAL_LOCK(heth);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529   <span class="comment">/* Set the ETH peripheral state to BUSY */</span>
<a name="l00530"></a>00530   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfae4efe1419676b9077d9ca9133d6dce9c">HAL_ETH_STATE_BUSY</a>;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532   <span class="comment">/* Set the DMATxDescToSet pointer with the first one of the DMATxDescTab list */</span>
<a name="l00533"></a>00533   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a96207949522aca0a017eb9247a3f4ffd">TxDesc</a> = DMATxDescTab;
<a name="l00534"></a>00534 
<a name="l00535"></a>00535   <span class="comment">/* Fill each DMATxDesc descriptor with the right values */</span>
<a name="l00536"></a>00536   <span class="keywordflow">for</span> (i = 0U; i &lt; TxBuffCount; i++)
<a name="l00537"></a>00537   {
<a name="l00538"></a>00538     <span class="comment">/* Get the pointer on the ith member of the Tx Desc list */</span>
<a name="l00539"></a>00539     dmatxdesc = DMATxDescTab + i;
<a name="l00540"></a>00540 
<a name="l00541"></a>00541     <span class="comment">/* Set Second Address Chained bit */</span>
<a name="l00542"></a>00542     dmatxdesc-&gt;<a class="code" href="structETH__DMADescTypeDef.html#af265b9bc7cf452993709d3630ebc1303">Status</a> = <a class="code" href="group/group__ETH__DMA__TX__Descriptor.html#gac6a08721d7f1ec32788738f4ec0fc037">ETH_DMATXDESC_TCH</a>;
<a name="l00543"></a>00543 
<a name="l00544"></a>00544     <span class="comment">/* Set Buffer1 address pointer */</span>
<a name="l00545"></a>00545     dmatxdesc-&gt;<a class="code" href="structETH__DMADescTypeDef.html#ac50dc23affda2cec95ea257c294d0b10">Buffer1Addr</a> = (uint32_t)(&amp;TxBuff[i * <a class="code" href="stm32f1xx__hal__conf_8h.html#af83956dfc1b135c3c92ac409758b6cf4">ETH_TX_BUF_SIZE</a>]);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547     <span class="keywordflow">if</span> ((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).ChecksumMode == <a class="code" href="group/group__ETH__Checksum__Mode.html#ga33e327fcecd000644e567173eb32a452">ETH_CHECKSUM_BY_HARDWARE</a>)
<a name="l00548"></a>00548     {
<a name="l00549"></a>00549       <span class="comment">/* Set the DMA Tx descriptors checksum insertion */</span>
<a name="l00550"></a>00550       dmatxdesc-&gt;<a class="code" href="structETH__DMADescTypeDef.html#af265b9bc7cf452993709d3630ebc1303">Status</a> |= <a class="code" href="group/group__ETH__DMA__Tx__descriptor__Checksum__Insertion__Control.html#ga7d7341ecfbde6109a5305f6bf38aaf53">ETH_DMATXDESC_CHECKSUMTCPUDPICMPFULL</a>;
<a name="l00551"></a>00551     }
<a name="l00552"></a>00552 
<a name="l00553"></a>00553     <span class="comment">/* Initialize the next descriptor with the Next Descriptor Polling Enable */</span>
<a name="l00554"></a>00554     <span class="keywordflow">if</span> (i &lt; (TxBuffCount - 1U))
<a name="l00555"></a>00555     {
<a name="l00556"></a>00556       <span class="comment">/* Set next descriptor address register with next descriptor base address */</span>
<a name="l00557"></a>00557       dmatxdesc-&gt;<a class="code" href="structETH__DMADescTypeDef.html#a0153644a6efbcc4e5d44563bd5350dc7">Buffer2NextDescAddr</a> = (uint32_t)(DMATxDescTab + i + 1U);
<a name="l00558"></a>00558     }
<a name="l00559"></a>00559     <span class="keywordflow">else</span>
<a name="l00560"></a>00560     {
<a name="l00561"></a>00561       <span class="comment">/* For last descriptor, set next descriptor address register equal to the first descriptor base address */</span>
<a name="l00562"></a>00562       dmatxdesc-&gt;<a class="code" href="structETH__DMADescTypeDef.html#a0153644a6efbcc4e5d44563bd5350dc7">Buffer2NextDescAddr</a> = (uint32_t) DMATxDescTab;
<a name="l00563"></a>00563     }
<a name="l00564"></a>00564   }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566   <span class="comment">/* Set Transmit Descriptor List Address Register */</span>
<a name="l00567"></a>00567   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMATDLAR = (uint32_t) DMATxDescTab;
<a name="l00568"></a>00568 
<a name="l00569"></a>00569   <span class="comment">/* Set ETH HAL State to Ready */</span>
<a name="l00570"></a>00570   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l00571"></a>00571 
<a name="l00572"></a>00572   <span class="comment">/* Process Unlocked */</span>
<a name="l00573"></a>00573   __HAL_UNLOCK(heth);
<a name="l00574"></a>00574 
<a name="l00575"></a>00575   <span class="comment">/* Return function status */</span>
<a name="l00576"></a>00576   <span class="keywordflow">return</span> HAL_OK;
<a name="l00577"></a>00577 }
<a name="l00578"></a>00578 <span class="comment"></span>
<a name="l00579"></a>00579 <span class="comment">/**</span>
<a name="l00580"></a>00580 <span class="comment">  * @brief  Initializes the DMA Rx descriptors in chain mode.</span>
<a name="l00581"></a>00581 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l00582"></a>00582 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l00583"></a>00583 <span class="comment">  * @param  DMARxDescTab: Pointer to the first Rx desc list</span>
<a name="l00584"></a>00584 <span class="comment">  * @param  RxBuff: Pointer to the first RxBuffer list</span>
<a name="l00585"></a>00585 <span class="comment">  * @param  RxBuffCount: Number of the used Rx desc in the list</span>
<a name="l00586"></a>00586 <span class="comment">  * @retval HAL status</span>
<a name="l00587"></a>00587 <span class="comment">  */</span>
<a name="l00588"></a><a class="code" href="group/group__ETH__Exported__Functions__Group1.html#ga9d0c046521c50c14c45c18cd069c8b57">00588</a> HAL_StatusTypeDef <a class="code" href="group/group__ETH__Exported__Functions__Group1.html#ga9d0c046521c50c14c45c18cd069c8b57" title="Initializes the DMA Rx descriptors in chain mode.">HAL_ETH_DMARxDescListInit</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth, <a class="code" href="structETH__DMADescTypeDef.html" title="ETH DMA Descriptors data structure definition.">ETH_DMADescTypeDef</a> *DMARxDescTab, uint8_t *RxBuff, uint32_t RxBuffCount)
<a name="l00589"></a>00589 {
<a name="l00590"></a>00590   uint32_t i = 0U;
<a name="l00591"></a>00591   <a class="code" href="structETH__DMADescTypeDef.html" title="ETH DMA Descriptors data structure definition.">ETH_DMADescTypeDef</a> *DMARxDesc;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593   <span class="comment">/* Process Locked */</span>
<a name="l00594"></a>00594   __HAL_LOCK(heth);
<a name="l00595"></a>00595 
<a name="l00596"></a>00596   <span class="comment">/* Set the ETH peripheral state to BUSY */</span>
<a name="l00597"></a>00597   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfae4efe1419676b9077d9ca9133d6dce9c">HAL_ETH_STATE_BUSY</a>;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599   <span class="comment">/* Set the Ethernet RxDesc pointer with the first one of the DMARxDescTab list */</span>
<a name="l00600"></a>00600   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a> = DMARxDescTab;
<a name="l00601"></a>00601 
<a name="l00602"></a>00602   <span class="comment">/* Fill each DMARxDesc descriptor with the right values */</span>
<a name="l00603"></a>00603   <span class="keywordflow">for</span> (i = 0U; i &lt; RxBuffCount; i++)
<a name="l00604"></a>00604   {
<a name="l00605"></a>00605     <span class="comment">/* Get the pointer on the ith member of the Rx Desc list */</span>
<a name="l00606"></a>00606     DMARxDesc = DMARxDescTab + i;
<a name="l00607"></a>00607 
<a name="l00608"></a>00608     <span class="comment">/* Set Own bit of the Rx descriptor Status */</span>
<a name="l00609"></a>00609     DMARxDesc-&gt;<a class="code" href="structETH__DMADescTypeDef.html#af265b9bc7cf452993709d3630ebc1303">Status</a> = <a class="code" href="group/group__ETH__DMA__RX__Descriptor.html#ga7df74546d804a664bdfc4571cd6b7d8a" title="Bit definition of RDES0 register: DMA Rx descriptor status register.">ETH_DMARXDESC_OWN</a>;
<a name="l00610"></a>00610 
<a name="l00611"></a>00611     <span class="comment">/* Set Buffer1 size and Second Address Chained bit */</span>
<a name="l00612"></a>00612     DMARxDesc-&gt;<a class="code" href="structETH__DMADescTypeDef.html#afb5fa0b688967a2b31c8a5fc9369850c">ControlBufferSize</a> = <a class="code" href="group/group__ETH__DMA__RX__Descriptor.html#ga9649cf1f21701da0e596df91eb2f3ab0">ETH_DMARXDESC_RCH</a> | <a class="code" href="stm32f1xx__hal__conf_8h.html#a0cdaf687f7a7f2dba570d5a722990786">ETH_RX_BUF_SIZE</a>;
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     <span class="comment">/* Set Buffer1 address pointer */</span>
<a name="l00615"></a>00615     DMARxDesc-&gt;<a class="code" href="structETH__DMADescTypeDef.html#ac50dc23affda2cec95ea257c294d0b10">Buffer1Addr</a> = (uint32_t)(&amp;RxBuff[i * <a class="code" href="stm32f1xx__hal__conf_8h.html#a0cdaf687f7a7f2dba570d5a722990786">ETH_RX_BUF_SIZE</a>]);
<a name="l00616"></a>00616 
<a name="l00617"></a>00617     <span class="keywordflow">if</span> ((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).RxMode == <a class="code" href="group/group__ETH__Rx__Mode.html#ga66f979e1658e1ecdc05a46f8c2b6073f">ETH_RXINTERRUPT_MODE</a>)
<a name="l00618"></a>00618     {
<a name="l00619"></a>00619       <span class="comment">/* Enable Ethernet DMA Rx Descriptor interrupt */</span>
<a name="l00620"></a>00620       DMARxDesc-&gt;<a class="code" href="structETH__DMADescTypeDef.html#afb5fa0b688967a2b31c8a5fc9369850c">ControlBufferSize</a> &amp;= ~<a class="code" href="group/group__ETH__DMA__RX__Descriptor.html#gabbe07b0f863b45c1f93f36eb014e49e9" title="Bit definition of RDES1 register.">ETH_DMARXDESC_DIC</a>;
<a name="l00621"></a>00621     }
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     <span class="comment">/* Initialize the next descriptor with the Next Descriptor Polling Enable */</span>
<a name="l00624"></a>00624     <span class="keywordflow">if</span> (i &lt; (RxBuffCount - 1U))
<a name="l00625"></a>00625     {
<a name="l00626"></a>00626       <span class="comment">/* Set next descriptor address register with next descriptor base address */</span>
<a name="l00627"></a>00627       DMARxDesc-&gt;<a class="code" href="structETH__DMADescTypeDef.html#a0153644a6efbcc4e5d44563bd5350dc7">Buffer2NextDescAddr</a> = (uint32_t)(DMARxDescTab + i + 1U);
<a name="l00628"></a>00628     }
<a name="l00629"></a>00629     <span class="keywordflow">else</span>
<a name="l00630"></a>00630     {
<a name="l00631"></a>00631       <span class="comment">/* For last descriptor, set next descriptor address register equal to the first descriptor base address */</span>
<a name="l00632"></a>00632       DMARxDesc-&gt;<a class="code" href="structETH__DMADescTypeDef.html#a0153644a6efbcc4e5d44563bd5350dc7">Buffer2NextDescAddr</a> = (uint32_t)(DMARxDescTab);
<a name="l00633"></a>00633     }
<a name="l00634"></a>00634   }
<a name="l00635"></a>00635 
<a name="l00636"></a>00636   <span class="comment">/* Set Receive Descriptor List Address Register */</span>
<a name="l00637"></a>00637   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMARDLAR = (uint32_t) DMARxDescTab;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639   <span class="comment">/* Set ETH HAL State to Ready */</span>
<a name="l00640"></a>00640   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l00641"></a>00641 
<a name="l00642"></a>00642   <span class="comment">/* Process Unlocked */</span>
<a name="l00643"></a>00643   __HAL_UNLOCK(heth);
<a name="l00644"></a>00644 
<a name="l00645"></a>00645   <span class="comment">/* Return function status */</span>
<a name="l00646"></a>00646   <span class="keywordflow">return</span> HAL_OK;
<a name="l00647"></a>00647 }
<a name="l00648"></a>00648 <span class="comment"></span>
<a name="l00649"></a>00649 <span class="comment">/**</span>
<a name="l00650"></a>00650 <span class="comment">  * @brief  Initializes the ETH MSP.</span>
<a name="l00651"></a>00651 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l00652"></a>00652 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l00653"></a>00653 <span class="comment">  * @retval None</span>
<a name="l00654"></a>00654 <span class="comment">  */</span>
<a name="l00655"></a><a class="code" href="group/group__ETH__Exported__Functions__Group1.html#ga1ffa1e1337d6e52a3b175144a4505ea7">00655</a> __weak <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Exported__Functions__Group1.html#ga1ffa1e1337d6e52a3b175144a4505ea7" title="Initializes the ETH MSP.">HAL_ETH_MspInit</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l00656"></a>00656 {
<a name="l00657"></a>00657   <span class="comment">/* Prevent unused argument(s) compilation warning */</span>
<a name="l00658"></a>00658   UNUSED(heth);
<a name="l00659"></a>00659   <span class="comment">/* NOTE : This function Should not be modified, when the callback is needed,</span>
<a name="l00660"></a>00660 <span class="comment">  the HAL_ETH_MspInit could be implemented in the user file</span>
<a name="l00661"></a>00661 <span class="comment">  */</span>
<a name="l00662"></a>00662 }
<a name="l00663"></a>00663 <span class="comment"></span>
<a name="l00664"></a>00664 <span class="comment">/**</span>
<a name="l00665"></a>00665 <span class="comment">  * @brief  DeInitializes ETH MSP.</span>
<a name="l00666"></a>00666 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l00667"></a>00667 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l00668"></a>00668 <span class="comment">  * @retval None</span>
<a name="l00669"></a>00669 <span class="comment">  */</span>
<a name="l00670"></a><a class="code" href="group/group__ETH__Exported__Functions__Group1.html#gadb9c31d86584307ca7791f3c3fbe58d9">00670</a> __weak <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Exported__Functions__Group1.html#gadb9c31d86584307ca7791f3c3fbe58d9" title="DeInitializes ETH MSP.">HAL_ETH_MspDeInit</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l00671"></a>00671 {
<a name="l00672"></a>00672   <span class="comment">/* Prevent unused argument(s) compilation warning */</span>
<a name="l00673"></a>00673   UNUSED(heth);
<a name="l00674"></a>00674   <span class="comment">/* NOTE : This function Should not be modified, when the callback is needed,</span>
<a name="l00675"></a>00675 <span class="comment">  the HAL_ETH_MspDeInit could be implemented in the user file</span>
<a name="l00676"></a>00676 <span class="comment">  */</span>
<a name="l00677"></a>00677 }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679 <span class="preprocessor">#if (USE_HAL_ETH_REGISTER_CALLBACKS == 1)</span>
<a name="l00680"></a>00680 <span class="preprocessor"></span><span class="comment">/**</span>
<a name="l00681"></a>00681 <span class="comment">  * @brief  Register a User ETH Callback</span>
<a name="l00682"></a>00682 <span class="comment">  *         To be used instead of the weak predefined callback</span>
<a name="l00683"></a>00683 <span class="comment">  * @param heth eth handle</span>
<a name="l00684"></a>00684 <span class="comment">  * @param CallbackID ID of the callback to be registered</span>
<a name="l00685"></a>00685 <span class="comment">  *        This parameter can be one of the following values:</span>
<a name="l00686"></a>00686 <span class="comment">  *          @arg @ref HAL_ETH_TX_COMPLETE_CB_ID Tx Complete Callback ID</span>
<a name="l00687"></a>00687 <span class="comment">  *          @arg @ref HAL_ETH_RX_COMPLETE_CB_ID Rx Complete Callback ID</span>
<a name="l00688"></a>00688 <span class="comment">  *          @arg @ref HAL_ETH_DMA_ERROR_CB_ID   DMA Error Callback ID</span>
<a name="l00689"></a>00689 <span class="comment">  *          @arg @ref HAL_ETH_MSPINIT_CB_ID     MspInit callback ID</span>
<a name="l00690"></a>00690 <span class="comment">  *          @arg @ref HAL_ETH_MSPDEINIT_CB_ID   MspDeInit callback ID</span>
<a name="l00691"></a>00691 <span class="comment">  * @param pCallback pointer to the Callback function</span>
<a name="l00692"></a>00692 <span class="comment">  * @retval status</span>
<a name="l00693"></a>00693 <span class="comment">  */</span>
<a name="l00694"></a>00694 HAL_StatusTypeDef HAL_ETH_RegisterCallback(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth, HAL_ETH_CallbackIDTypeDef CallbackID, pETH_CallbackTypeDef pCallback)
<a name="l00695"></a>00695 {
<a name="l00696"></a>00696   HAL_StatusTypeDef status = HAL_OK;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698   <span class="keywordflow">if</span> (pCallback == NULL)
<a name="l00699"></a>00699   {
<a name="l00700"></a>00700     <span class="keywordflow">return</span> HAL_ERROR;
<a name="l00701"></a>00701   }
<a name="l00702"></a>00702   <span class="comment">/* Process locked */</span>
<a name="l00703"></a>00703   __HAL_LOCK(heth);
<a name="l00704"></a>00704 
<a name="l00705"></a>00705   <span class="keywordflow">if</span> (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> == <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>)
<a name="l00706"></a>00706   {
<a name="l00707"></a>00707     <span class="keywordflow">switch</span> (CallbackID)
<a name="l00708"></a>00708     {
<a name="l00709"></a>00709       <span class="keywordflow">case</span> HAL_ETH_TX_COMPLETE_CB_ID :
<a name="l00710"></a>00710         heth-&gt;TxCpltCallback = pCallback;
<a name="l00711"></a>00711         <span class="keywordflow">break</span>;
<a name="l00712"></a>00712 
<a name="l00713"></a>00713       <span class="keywordflow">case</span> HAL_ETH_RX_COMPLETE_CB_ID :
<a name="l00714"></a>00714         heth-&gt;RxCpltCallback = pCallback;
<a name="l00715"></a>00715         <span class="keywordflow">break</span>;
<a name="l00716"></a>00716 
<a name="l00717"></a>00717       <span class="keywordflow">case</span> HAL_ETH_DMA_ERROR_CB_ID :
<a name="l00718"></a>00718         heth-&gt;DMAErrorCallback = pCallback;
<a name="l00719"></a>00719         <span class="keywordflow">break</span>;
<a name="l00720"></a>00720 
<a name="l00721"></a>00721       <span class="keywordflow">case</span> HAL_ETH_MSPINIT_CB_ID :
<a name="l00722"></a>00722         heth-&gt;MspInitCallback = pCallback;
<a name="l00723"></a>00723         <span class="keywordflow">break</span>;
<a name="l00724"></a>00724 
<a name="l00725"></a>00725       <span class="keywordflow">case</span> HAL_ETH_MSPDEINIT_CB_ID :
<a name="l00726"></a>00726         heth-&gt;MspDeInitCallback = pCallback;
<a name="l00727"></a>00727         <span class="keywordflow">break</span>;
<a name="l00728"></a>00728 
<a name="l00729"></a>00729       <span class="keywordflow">default</span> :
<a name="l00730"></a>00730         <span class="comment">/* Return error status */</span>
<a name="l00731"></a>00731         status =  HAL_ERROR;
<a name="l00732"></a>00732         <span class="keywordflow">break</span>;
<a name="l00733"></a>00733     }
<a name="l00734"></a>00734   }
<a name="l00735"></a>00735   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> == <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa1d415b0d43770dd61ae1bda06c487a8f">HAL_ETH_STATE_RESET</a>)
<a name="l00736"></a>00736   {
<a name="l00737"></a>00737     <span class="keywordflow">switch</span> (CallbackID)
<a name="l00738"></a>00738     {
<a name="l00739"></a>00739       <span class="keywordflow">case</span> HAL_ETH_MSPINIT_CB_ID :
<a name="l00740"></a>00740         heth-&gt;MspInitCallback = pCallback;
<a name="l00741"></a>00741         <span class="keywordflow">break</span>;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743       <span class="keywordflow">case</span> HAL_ETH_MSPDEINIT_CB_ID :
<a name="l00744"></a>00744         heth-&gt;MspDeInitCallback = pCallback;
<a name="l00745"></a>00745         <span class="keywordflow">break</span>;
<a name="l00746"></a>00746 
<a name="l00747"></a>00747       <span class="keywordflow">default</span> :
<a name="l00748"></a>00748         <span class="comment">/* Return error status */</span>
<a name="l00749"></a>00749         status =  HAL_ERROR;
<a name="l00750"></a>00750         <span class="keywordflow">break</span>;
<a name="l00751"></a>00751     }
<a name="l00752"></a>00752   }
<a name="l00753"></a>00753   <span class="keywordflow">else</span>
<a name="l00754"></a>00754   {
<a name="l00755"></a>00755     <span class="comment">/* Return error status */</span>
<a name="l00756"></a>00756     status =  HAL_ERROR;
<a name="l00757"></a>00757   }
<a name="l00758"></a>00758 
<a name="l00759"></a>00759   <span class="comment">/* Release Lock */</span>
<a name="l00760"></a>00760   __HAL_UNLOCK(heth);
<a name="l00761"></a>00761 
<a name="l00762"></a>00762   <span class="keywordflow">return</span> status;
<a name="l00763"></a>00763 }
<a name="l00764"></a>00764 <span class="comment"></span>
<a name="l00765"></a>00765 <span class="comment">/**</span>
<a name="l00766"></a>00766 <span class="comment">  * @brief  Unregister an ETH Callback</span>
<a name="l00767"></a>00767 <span class="comment">  *         ETH callabck is redirected to the weak predefined callback</span>
<a name="l00768"></a>00768 <span class="comment">  * @param heth eth handle</span>
<a name="l00769"></a>00769 <span class="comment">  * @param CallbackID ID of the callback to be unregistered</span>
<a name="l00770"></a>00770 <span class="comment">  *        This parameter can be one of the following values:</span>
<a name="l00771"></a>00771 <span class="comment">  *          @arg @ref HAL_ETH_TX_COMPLETE_CB_ID Tx Complete Callback ID</span>
<a name="l00772"></a>00772 <span class="comment">  *          @arg @ref HAL_ETH_RX_COMPLETE_CB_ID Rx Complete Callback ID</span>
<a name="l00773"></a>00773 <span class="comment">  *          @arg @ref HAL_ETH_DMA_ERROR_CB_ID      DMA Error Callback ID</span>
<a name="l00774"></a>00774 <span class="comment">  *          @arg @ref HAL_ETH_MSPINIT_CB_ID     MspInit callback ID</span>
<a name="l00775"></a>00775 <span class="comment">  *          @arg @ref HAL_ETH_MSPDEINIT_CB_ID   MspDeInit callback ID</span>
<a name="l00776"></a>00776 <span class="comment">  * @retval status</span>
<a name="l00777"></a>00777 <span class="comment">  */</span>
<a name="l00778"></a>00778 HAL_StatusTypeDef HAL_ETH_UnRegisterCallback(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth, HAL_ETH_CallbackIDTypeDef CallbackID)
<a name="l00779"></a>00779 {
<a name="l00780"></a>00780   HAL_StatusTypeDef status = HAL_OK;
<a name="l00781"></a>00781 
<a name="l00782"></a>00782   <span class="comment">/* Process locked */</span>
<a name="l00783"></a>00783   __HAL_LOCK(heth);
<a name="l00784"></a>00784 
<a name="l00785"></a>00785   <span class="keywordflow">if</span> (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> == <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>)
<a name="l00786"></a>00786   {
<a name="l00787"></a>00787     <span class="keywordflow">switch</span> (CallbackID)
<a name="l00788"></a>00788     {
<a name="l00789"></a>00789       <span class="keywordflow">case</span> HAL_ETH_TX_COMPLETE_CB_ID :
<a name="l00790"></a>00790         heth-&gt;TxCpltCallback = <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gac96b23dde481e897508e8b9ad69e3ecb" title="Tx Transfer completed callbacks.">HAL_ETH_TxCpltCallback</a>;
<a name="l00791"></a>00791         <span class="keywordflow">break</span>;
<a name="l00792"></a>00792 
<a name="l00793"></a>00793       <span class="keywordflow">case</span> HAL_ETH_RX_COMPLETE_CB_ID :
<a name="l00794"></a>00794         heth-&gt;RxCpltCallback = <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gac0609dc4bf97bb5906afdab6b9428654" title="Rx Transfer completed callbacks.">HAL_ETH_RxCpltCallback</a>;
<a name="l00795"></a>00795         <span class="keywordflow">break</span>;
<a name="l00796"></a>00796 
<a name="l00797"></a>00797       <span class="keywordflow">case</span> HAL_ETH_DMA_ERROR_CB_ID :
<a name="l00798"></a>00798         heth-&gt;DMAErrorCallback = <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gabb9424d761aa8a5691f983c5aa842dbe" title="Ethernet transfer error callbacks.">HAL_ETH_ErrorCallback</a>;
<a name="l00799"></a>00799         <span class="keywordflow">break</span>;
<a name="l00800"></a>00800 
<a name="l00801"></a>00801       <span class="keywordflow">case</span> HAL_ETH_MSPINIT_CB_ID :
<a name="l00802"></a>00802         heth-&gt;MspInitCallback = <a class="code" href="group/group__ETH__Exported__Functions__Group1.html#ga1ffa1e1337d6e52a3b175144a4505ea7" title="Initializes the ETH MSP.">HAL_ETH_MspInit</a>;
<a name="l00803"></a>00803         <span class="keywordflow">break</span>;
<a name="l00804"></a>00804 
<a name="l00805"></a>00805       <span class="keywordflow">case</span> HAL_ETH_MSPDEINIT_CB_ID :
<a name="l00806"></a>00806         heth-&gt;MspDeInitCallback = <a class="code" href="group/group__ETH__Exported__Functions__Group1.html#gadb9c31d86584307ca7791f3c3fbe58d9" title="DeInitializes ETH MSP.">HAL_ETH_MspDeInit</a>;
<a name="l00807"></a>00807         <span class="keywordflow">break</span>;
<a name="l00808"></a>00808 
<a name="l00809"></a>00809       <span class="keywordflow">default</span> :
<a name="l00810"></a>00810         <span class="comment">/* Return error status */</span>
<a name="l00811"></a>00811         status =  HAL_ERROR;
<a name="l00812"></a>00812         <span class="keywordflow">break</span>;
<a name="l00813"></a>00813     }
<a name="l00814"></a>00814   }
<a name="l00815"></a>00815   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> == <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa1d415b0d43770dd61ae1bda06c487a8f">HAL_ETH_STATE_RESET</a>)
<a name="l00816"></a>00816   {
<a name="l00817"></a>00817     <span class="keywordflow">switch</span> (CallbackID)
<a name="l00818"></a>00818     {
<a name="l00819"></a>00819       <span class="keywordflow">case</span> HAL_ETH_MSPINIT_CB_ID :
<a name="l00820"></a>00820         heth-&gt;MspInitCallback = <a class="code" href="group/group__ETH__Exported__Functions__Group1.html#ga1ffa1e1337d6e52a3b175144a4505ea7" title="Initializes the ETH MSP.">HAL_ETH_MspInit</a>;
<a name="l00821"></a>00821         <span class="keywordflow">break</span>;
<a name="l00822"></a>00822 
<a name="l00823"></a>00823       <span class="keywordflow">case</span> HAL_ETH_MSPDEINIT_CB_ID :
<a name="l00824"></a>00824         heth-&gt;MspDeInitCallback = <a class="code" href="group/group__ETH__Exported__Functions__Group1.html#gadb9c31d86584307ca7791f3c3fbe58d9" title="DeInitializes ETH MSP.">HAL_ETH_MspDeInit</a>;
<a name="l00825"></a>00825         <span class="keywordflow">break</span>;
<a name="l00826"></a>00826 
<a name="l00827"></a>00827       <span class="keywordflow">default</span> :
<a name="l00828"></a>00828         <span class="comment">/* Return error status */</span>
<a name="l00829"></a>00829         status =  HAL_ERROR;
<a name="l00830"></a>00830         <span class="keywordflow">break</span>;
<a name="l00831"></a>00831     }
<a name="l00832"></a>00832   }
<a name="l00833"></a>00833   <span class="keywordflow">else</span>
<a name="l00834"></a>00834   {
<a name="l00835"></a>00835     <span class="comment">/* Return error status */</span>
<a name="l00836"></a>00836     status =  HAL_ERROR;
<a name="l00837"></a>00837   }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839   <span class="comment">/* Release Lock */</span>
<a name="l00840"></a>00840   __HAL_UNLOCK(heth);
<a name="l00841"></a>00841 
<a name="l00842"></a>00842   <span class="keywordflow">return</span> status;
<a name="l00843"></a>00843 }
<a name="l00844"></a>00844 <span class="preprocessor">#endif </span><span class="comment">/* USE_HAL_ETH_REGISTER_CALLBACKS */</span>
<a name="l00845"></a>00845 <span class="comment"></span>
<a name="l00846"></a>00846 <span class="comment">/**</span>
<a name="l00847"></a>00847 <span class="comment">  * @}</span>
<a name="l00848"></a>00848 <span class="comment">  */</span>
<a name="l00849"></a>00849 <span class="comment"></span>
<a name="l00850"></a>00850 <span class="comment">/** @defgroup ETH_Exported_Functions_Group2 IO operation functions</span>
<a name="l00851"></a>00851 <span class="comment">  *  @brief   Data transfers functions</span>
<a name="l00852"></a>00852 <span class="comment">  *</span>
<a name="l00853"></a>00853 <span class="comment">  @verbatim</span>
<a name="l00854"></a>00854 <span class="comment">  ==============================================================================</span>
<a name="l00855"></a>00855 <span class="comment">                          ##### IO operation functions #####</span>
<a name="l00856"></a>00856 <span class="comment">  ==============================================================================</span>
<a name="l00857"></a>00857 <span class="comment">  [..]  This section provides functions allowing to:</span>
<a name="l00858"></a>00858 <span class="comment">        (+) Transmit a frame</span>
<a name="l00859"></a>00859 <span class="comment">            HAL_ETH_TransmitFrame();</span>
<a name="l00860"></a>00860 <span class="comment">        (+) Receive a frame</span>
<a name="l00861"></a>00861 <span class="comment">            HAL_ETH_GetReceivedFrame();</span>
<a name="l00862"></a>00862 <span class="comment">            HAL_ETH_GetReceivedFrame_IT();</span>
<a name="l00863"></a>00863 <span class="comment">        (+) Read from an External PHY register</span>
<a name="l00864"></a>00864 <span class="comment">            HAL_ETH_ReadPHYRegister();</span>
<a name="l00865"></a>00865 <span class="comment">        (+) Write to an External PHY register</span>
<a name="l00866"></a>00866 <span class="comment">            HAL_ETH_WritePHYRegister();</span>
<a name="l00867"></a>00867 <span class="comment"></span>
<a name="l00868"></a>00868 <span class="comment">  @endverbatim</span>
<a name="l00869"></a>00869 <span class="comment"></span>
<a name="l00870"></a>00870 <span class="comment">  * @{</span>
<a name="l00871"></a>00871 <span class="comment">  */</span>
<a name="l00872"></a>00872 <span class="comment"></span>
<a name="l00873"></a>00873 <span class="comment">/**</span>
<a name="l00874"></a>00874 <span class="comment">  * @brief  Sends an Ethernet frame.</span>
<a name="l00875"></a>00875 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l00876"></a>00876 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l00877"></a>00877 <span class="comment">  * @param  FrameLength: Amount of data to be sent</span>
<a name="l00878"></a>00878 <span class="comment">  * @retval HAL status</span>
<a name="l00879"></a>00879 <span class="comment">  */</span>
<a name="l00880"></a><a class="code" href="group/group__ETH__Exported__Functions__Group2.html#ga09dc8287c10b5882ce7adf0fd7ba3cda">00880</a> HAL_StatusTypeDef <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#ga09dc8287c10b5882ce7adf0fd7ba3cda" title="Sends an Ethernet frame.">HAL_ETH_TransmitFrame</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth, uint32_t FrameLength)
<a name="l00881"></a>00881 {
<a name="l00882"></a>00882   uint32_t bufcount = 0U, size = 0U, i = 0U;
<a name="l00883"></a>00883 
<a name="l00884"></a>00884   <span class="comment">/* Process Locked */</span>
<a name="l00885"></a>00885   __HAL_LOCK(heth);
<a name="l00886"></a>00886 
<a name="l00887"></a>00887   <span class="comment">/* Set the ETH peripheral state to BUSY */</span>
<a name="l00888"></a>00888   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfae4efe1419676b9077d9ca9133d6dce9c">HAL_ETH_STATE_BUSY</a>;
<a name="l00889"></a>00889 
<a name="l00890"></a>00890   <span class="keywordflow">if</span> (FrameLength == 0U)
<a name="l00891"></a>00891   {
<a name="l00892"></a>00892     <span class="comment">/* Set ETH HAL state to READY */</span>
<a name="l00893"></a>00893     heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l00894"></a>00894 
<a name="l00895"></a>00895     <span class="comment">/* Process Unlocked */</span>
<a name="l00896"></a>00896     __HAL_UNLOCK(heth);
<a name="l00897"></a>00897 
<a name="l00898"></a>00898     <span class="keywordflow">return</span>  HAL_ERROR;
<a name="l00899"></a>00899   }
<a name="l00900"></a>00900 
<a name="l00901"></a>00901   <span class="comment">/* Check if the descriptor is owned by the ETHERNET DMA (when set) or CPU (when reset) */</span>
<a name="l00902"></a>00902   <span class="keywordflow">if</span> (((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a96207949522aca0a017eb9247a3f4ffd">TxDesc</a>)-&gt;Status &amp; <a class="code" href="group/group__ETH__DMA__TX__Descriptor.html#ga1050b0c24083743691620ab9614fa0ac" title="Bit definition of TDES0 register: DMA Tx descriptor status register.">ETH_DMATXDESC_OWN</a>) != (uint32_t)RESET)
<a name="l00903"></a>00903   {
<a name="l00904"></a>00904     <span class="comment">/* OWN bit set */</span>
<a name="l00905"></a>00905     heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa5fc828dfa7972545c7a8b30477f9de19">HAL_ETH_STATE_BUSY_TX</a>;
<a name="l00906"></a>00906 
<a name="l00907"></a>00907     <span class="comment">/* Process Unlocked */</span>
<a name="l00908"></a>00908     __HAL_UNLOCK(heth);
<a name="l00909"></a>00909 
<a name="l00910"></a>00910     <span class="keywordflow">return</span> HAL_ERROR;
<a name="l00911"></a>00911   }
<a name="l00912"></a>00912 
<a name="l00913"></a>00913   <span class="comment">/* Get the number of needed Tx buffers for the current frame */</span>
<a name="l00914"></a>00914   <span class="keywordflow">if</span> (FrameLength &gt; <a class="code" href="stm32f1xx__hal__conf_8h.html#af83956dfc1b135c3c92ac409758b6cf4">ETH_TX_BUF_SIZE</a>)
<a name="l00915"></a>00915   {
<a name="l00916"></a>00916     bufcount = FrameLength / <a class="code" href="stm32f1xx__hal__conf_8h.html#af83956dfc1b135c3c92ac409758b6cf4">ETH_TX_BUF_SIZE</a>;
<a name="l00917"></a>00917     <span class="keywordflow">if</span> (FrameLength % <a class="code" href="stm32f1xx__hal__conf_8h.html#af83956dfc1b135c3c92ac409758b6cf4">ETH_TX_BUF_SIZE</a>)
<a name="l00918"></a>00918     {
<a name="l00919"></a>00919       bufcount++;
<a name="l00920"></a>00920     }
<a name="l00921"></a>00921   }
<a name="l00922"></a>00922   <span class="keywordflow">else</span>
<a name="l00923"></a>00923   {
<a name="l00924"></a>00924     bufcount = 1U;
<a name="l00925"></a>00925   }
<a name="l00926"></a>00926   <span class="keywordflow">if</span> (bufcount == 1U)
<a name="l00927"></a>00927   {
<a name="l00928"></a>00928     <span class="comment">/* Set LAST and FIRST segment */</span>
<a name="l00929"></a>00929     heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a96207949522aca0a017eb9247a3f4ffd">TxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#af265b9bc7cf452993709d3630ebc1303">Status</a> |= <a class="code" href="group/group__ETH__DMA__TX__Descriptor.html#ga8720b1b1510ad9d3d0fd6896789f521e">ETH_DMATXDESC_FS</a> | <a class="code" href="group/group__ETH__DMA__TX__Descriptor.html#ga9155683ac59d93651f78fd44f5169fe5">ETH_DMATXDESC_LS</a>;
<a name="l00930"></a>00930     <span class="comment">/* Set frame size */</span>
<a name="l00931"></a>00931     heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a96207949522aca0a017eb9247a3f4ffd">TxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#afb5fa0b688967a2b31c8a5fc9369850c">ControlBufferSize</a> = (FrameLength &amp; <a class="code" href="group/group__ETH__DMA__TX__Descriptor.html#gacc1451346770171dcb987ce5ea727b1d">ETH_DMATXDESC_TBS1</a>);
<a name="l00932"></a>00932     <span class="comment">/* Set Own bit of the Tx descriptor Status: gives the buffer back to ETHERNET DMA */</span>
<a name="l00933"></a>00933     heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a96207949522aca0a017eb9247a3f4ffd">TxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#af265b9bc7cf452993709d3630ebc1303">Status</a> |= <a class="code" href="group/group__ETH__DMA__TX__Descriptor.html#ga1050b0c24083743691620ab9614fa0ac" title="Bit definition of TDES0 register: DMA Tx descriptor status register.">ETH_DMATXDESC_OWN</a>;
<a name="l00934"></a>00934     <span class="comment">/* Point to next descriptor */</span>
<a name="l00935"></a>00935     heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a96207949522aca0a017eb9247a3f4ffd">TxDesc</a> = (<a class="code" href="structETH__DMADescTypeDef.html" title="ETH DMA Descriptors data structure definition.">ETH_DMADescTypeDef</a> *)(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a96207949522aca0a017eb9247a3f4ffd">TxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#a0153644a6efbcc4e5d44563bd5350dc7">Buffer2NextDescAddr</a>);
<a name="l00936"></a>00936   }
<a name="l00937"></a>00937   <span class="keywordflow">else</span>
<a name="l00938"></a>00938   {
<a name="l00939"></a>00939     <span class="keywordflow">for</span> (i = 0U; i &lt; bufcount; i++)
<a name="l00940"></a>00940     {
<a name="l00941"></a>00941       <span class="comment">/* Clear FIRST and LAST segment bits */</span>
<a name="l00942"></a>00942       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a96207949522aca0a017eb9247a3f4ffd">TxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#af265b9bc7cf452993709d3630ebc1303">Status</a> &amp;= ~(<a class="code" href="group/group__ETH__DMA__TX__Descriptor.html#ga8720b1b1510ad9d3d0fd6896789f521e">ETH_DMATXDESC_FS</a> | <a class="code" href="group/group__ETH__DMA__TX__Descriptor.html#ga9155683ac59d93651f78fd44f5169fe5">ETH_DMATXDESC_LS</a>);
<a name="l00943"></a>00943 
<a name="l00944"></a>00944       <span class="keywordflow">if</span> (i == 0U)
<a name="l00945"></a>00945       {
<a name="l00946"></a>00946         <span class="comment">/* Setting the first segment bit */</span>
<a name="l00947"></a>00947         heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a96207949522aca0a017eb9247a3f4ffd">TxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#af265b9bc7cf452993709d3630ebc1303">Status</a> |= <a class="code" href="group/group__ETH__DMA__TX__Descriptor.html#ga8720b1b1510ad9d3d0fd6896789f521e">ETH_DMATXDESC_FS</a>;
<a name="l00948"></a>00948       }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950       <span class="comment">/* Program size */</span>
<a name="l00951"></a>00951       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a96207949522aca0a017eb9247a3f4ffd">TxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#afb5fa0b688967a2b31c8a5fc9369850c">ControlBufferSize</a> = (<a class="code" href="stm32f1xx__hal__conf_8h.html#af83956dfc1b135c3c92ac409758b6cf4">ETH_TX_BUF_SIZE</a> &amp; <a class="code" href="group/group__ETH__DMA__TX__Descriptor.html#gacc1451346770171dcb987ce5ea727b1d">ETH_DMATXDESC_TBS1</a>);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953       <span class="keywordflow">if</span> (i == (bufcount - 1U))
<a name="l00954"></a>00954       {
<a name="l00955"></a>00955         <span class="comment">/* Setting the last segment bit */</span>
<a name="l00956"></a>00956         heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a96207949522aca0a017eb9247a3f4ffd">TxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#af265b9bc7cf452993709d3630ebc1303">Status</a> |= <a class="code" href="group/group__ETH__DMA__TX__Descriptor.html#ga9155683ac59d93651f78fd44f5169fe5">ETH_DMATXDESC_LS</a>;
<a name="l00957"></a>00957         size = FrameLength - (bufcount - 1U) * <a class="code" href="stm32f1xx__hal__conf_8h.html#af83956dfc1b135c3c92ac409758b6cf4">ETH_TX_BUF_SIZE</a>;
<a name="l00958"></a>00958         heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a96207949522aca0a017eb9247a3f4ffd">TxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#afb5fa0b688967a2b31c8a5fc9369850c">ControlBufferSize</a> = (size &amp; <a class="code" href="group/group__ETH__DMA__TX__Descriptor.html#gacc1451346770171dcb987ce5ea727b1d">ETH_DMATXDESC_TBS1</a>);
<a name="l00959"></a>00959       }
<a name="l00960"></a>00960 
<a name="l00961"></a>00961       <span class="comment">/* Set Own bit of the Tx descriptor Status: gives the buffer back to ETHERNET DMA */</span>
<a name="l00962"></a>00962       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a96207949522aca0a017eb9247a3f4ffd">TxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#af265b9bc7cf452993709d3630ebc1303">Status</a> |= <a class="code" href="group/group__ETH__DMA__TX__Descriptor.html#ga1050b0c24083743691620ab9614fa0ac" title="Bit definition of TDES0 register: DMA Tx descriptor status register.">ETH_DMATXDESC_OWN</a>;
<a name="l00963"></a>00963       <span class="comment">/* point to next descriptor */</span>
<a name="l00964"></a>00964       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a96207949522aca0a017eb9247a3f4ffd">TxDesc</a> = (<a class="code" href="structETH__DMADescTypeDef.html" title="ETH DMA Descriptors data structure definition.">ETH_DMADescTypeDef</a> *)(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a96207949522aca0a017eb9247a3f4ffd">TxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#a0153644a6efbcc4e5d44563bd5350dc7">Buffer2NextDescAddr</a>);
<a name="l00965"></a>00965     }
<a name="l00966"></a>00966   }
<a name="l00967"></a>00967 
<a name="l00968"></a>00968   <span class="comment">/* When Tx Buffer unavailable flag is set: clear it and resume transmission */</span>
<a name="l00969"></a>00969   <span class="keywordflow">if</span> (((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMASR &amp; ETH_DMASR_TBUS) != (uint32_t)RESET)
<a name="l00970"></a>00970   {
<a name="l00971"></a>00971     <span class="comment">/* Clear TBUS ETHERNET DMA flag */</span>
<a name="l00972"></a>00972     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMASR = ETH_DMASR_TBUS;
<a name="l00973"></a>00973     <span class="comment">/* Resume DMA transmission*/</span>
<a name="l00974"></a>00974     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMATPDR = 0U;
<a name="l00975"></a>00975   }
<a name="l00976"></a>00976 
<a name="l00977"></a>00977   <span class="comment">/* Set ETH HAL State to Ready */</span>
<a name="l00978"></a>00978   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l00979"></a>00979 
<a name="l00980"></a>00980   <span class="comment">/* Process Unlocked */</span>
<a name="l00981"></a>00981   __HAL_UNLOCK(heth);
<a name="l00982"></a>00982 
<a name="l00983"></a>00983   <span class="comment">/* Return function status */</span>
<a name="l00984"></a>00984   <span class="keywordflow">return</span> HAL_OK;
<a name="l00985"></a>00985 }
<a name="l00986"></a>00986 <span class="comment"></span>
<a name="l00987"></a>00987 <span class="comment">/**</span>
<a name="l00988"></a>00988 <span class="comment">  * @brief  Checks for received frames.</span>
<a name="l00989"></a>00989 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l00990"></a>00990 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l00991"></a>00991 <span class="comment">  * @retval HAL status</span>
<a name="l00992"></a>00992 <span class="comment">  */</span>
<a name="l00993"></a><a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gab630598f1bfd6073ca77c8a04a28b121">00993</a> HAL_StatusTypeDef <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gab630598f1bfd6073ca77c8a04a28b121" title="Checks for received frames.">HAL_ETH_GetReceivedFrame</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l00994"></a>00994 {
<a name="l00995"></a>00995   uint32_t framelength = 0U;
<a name="l00996"></a>00996 
<a name="l00997"></a>00997   <span class="comment">/* Process Locked */</span>
<a name="l00998"></a>00998   __HAL_LOCK(heth);
<a name="l00999"></a>00999 
<a name="l01000"></a>01000   <span class="comment">/* Check the ETH state to BUSY */</span>
<a name="l01001"></a>01001   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfae4efe1419676b9077d9ca9133d6dce9c">HAL_ETH_STATE_BUSY</a>;
<a name="l01002"></a>01002 
<a name="l01003"></a>01003   <span class="comment">/* Check if segment is not owned by DMA */</span>
<a name="l01004"></a>01004   <span class="comment">/* (((heth-&gt;RxDesc-&gt;Status &amp; ETH_DMARXDESC_OWN) == (uint32_t)RESET) &amp;&amp; ((heth-&gt;RxDesc-&gt;Status &amp; ETH_DMARXDESC_LS) != (uint32_t)RESET)) */</span>
<a name="l01005"></a>01005   <span class="keywordflow">if</span> (((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#af265b9bc7cf452993709d3630ebc1303">Status</a> &amp; <a class="code" href="group/group__ETH__DMA__RX__Descriptor.html#ga7df74546d804a664bdfc4571cd6b7d8a" title="Bit definition of RDES0 register: DMA Rx descriptor status register.">ETH_DMARXDESC_OWN</a>) == (uint32_t)RESET))
<a name="l01006"></a>01006   {
<a name="l01007"></a>01007     <span class="comment">/* Check if last segment */</span>
<a name="l01008"></a>01008     <span class="keywordflow">if</span> (((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#af265b9bc7cf452993709d3630ebc1303">Status</a> &amp; <a class="code" href="group/group__ETH__DMA__RX__Descriptor.html#gab8a91e41f3b4d5ecfba08b71f0008e8f">ETH_DMARXDESC_LS</a>) != (uint32_t)RESET))
<a name="l01009"></a>01009     {
<a name="l01010"></a>01010       <span class="comment">/* increment segment count */</span>
<a name="l01011"></a>01011       (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>).SegCount++;
<a name="l01012"></a>01012 
<a name="l01013"></a>01013       <span class="comment">/* Check if last segment is first segment: one segment contains the frame */</span>
<a name="l01014"></a>01014       <span class="keywordflow">if</span> ((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>).SegCount == 1U)
<a name="l01015"></a>01015       {
<a name="l01016"></a>01016         (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>).FSRxDesc = heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>;
<a name="l01017"></a>01017       }
<a name="l01018"></a>01018 
<a name="l01019"></a>01019       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>.<a class="code" href="structETH__DMARxFrameInfos.html#af2ffc09f96d107ae65cc006eae868ed3">LSRxDesc</a> = heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>;
<a name="l01020"></a>01020 
<a name="l01021"></a>01021       <span class="comment">/* Get the Frame Length of the received packet: substruct 4 bytes of the CRC */</span>
<a name="l01022"></a>01022       framelength = (((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>)-&gt;Status &amp; <a class="code" href="group/group__ETH__DMA__RX__Descriptor.html#ga42a29a1104881addcfba3b8a1750b893">ETH_DMARXDESC_FL</a>) &gt;&gt; <a class="code" href="group/group__ETH__Private__Defines.html#gac6ead229f2e09555967ed73507961b1d">ETH_DMARXDESC_FRAMELENGTHSHIFT</a>) - 4U;
<a name="l01023"></a>01023       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>.<a class="code" href="structETH__DMARxFrameInfos.html#a596e39e8b9cfc5cbb4ab4119e355029c">length</a> = framelength;
<a name="l01024"></a>01024 
<a name="l01025"></a>01025       <span class="comment">/* Get the address of the buffer start address */</span>
<a name="l01026"></a>01026       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>.<a class="code" href="structETH__DMARxFrameInfos.html#a19e3893903dfbed6ffe5fd0137cb0f3b">buffer</a> = ((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>).FSRxDesc)-&gt;Buffer1Addr;
<a name="l01027"></a>01027       <span class="comment">/* point to next descriptor */</span>
<a name="l01028"></a>01028       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a> = (<a class="code" href="structETH__DMADescTypeDef.html" title="ETH DMA Descriptors data structure definition.">ETH_DMADescTypeDef</a> *)((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>)-&gt;Buffer2NextDescAddr);
<a name="l01029"></a>01029 
<a name="l01030"></a>01030       <span class="comment">/* Set HAL State to Ready */</span>
<a name="l01031"></a>01031       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l01032"></a>01032 
<a name="l01033"></a>01033       <span class="comment">/* Process Unlocked */</span>
<a name="l01034"></a>01034       __HAL_UNLOCK(heth);
<a name="l01035"></a>01035 
<a name="l01036"></a>01036       <span class="comment">/* Return function status */</span>
<a name="l01037"></a>01037       <span class="keywordflow">return</span> HAL_OK;
<a name="l01038"></a>01038     }
<a name="l01039"></a>01039     <span class="comment">/* Check if first segment */</span>
<a name="l01040"></a>01040     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#af265b9bc7cf452993709d3630ebc1303">Status</a> &amp; <a class="code" href="group/group__ETH__DMA__RX__Descriptor.html#gaed0a02f0c7e08723d2f73a4527e3a9a4">ETH_DMARXDESC_FS</a>) != (uint32_t)RESET)
<a name="l01041"></a>01041     {
<a name="l01042"></a>01042       (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>).FSRxDesc = heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>;
<a name="l01043"></a>01043       (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>).LSRxDesc = NULL;
<a name="l01044"></a>01044       (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>).SegCount = 1U;
<a name="l01045"></a>01045       <span class="comment">/* Point to next descriptor */</span>
<a name="l01046"></a>01046       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a> = (<a class="code" href="structETH__DMADescTypeDef.html" title="ETH DMA Descriptors data structure definition.">ETH_DMADescTypeDef</a> *)(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#a0153644a6efbcc4e5d44563bd5350dc7">Buffer2NextDescAddr</a>);
<a name="l01047"></a>01047     }
<a name="l01048"></a>01048     <span class="comment">/* Check if intermediate segment */</span>
<a name="l01049"></a>01049     <span class="keywordflow">else</span>
<a name="l01050"></a>01050     {
<a name="l01051"></a>01051       (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>).SegCount++;
<a name="l01052"></a>01052       <span class="comment">/* Point to next descriptor */</span>
<a name="l01053"></a>01053       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a> = (<a class="code" href="structETH__DMADescTypeDef.html" title="ETH DMA Descriptors data structure definition.">ETH_DMADescTypeDef</a> *)(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#a0153644a6efbcc4e5d44563bd5350dc7">Buffer2NextDescAddr</a>);
<a name="l01054"></a>01054     }
<a name="l01055"></a>01055   }
<a name="l01056"></a>01056 
<a name="l01057"></a>01057   <span class="comment">/* Set ETH HAL State to Ready */</span>
<a name="l01058"></a>01058   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l01059"></a>01059 
<a name="l01060"></a>01060   <span class="comment">/* Process Unlocked */</span>
<a name="l01061"></a>01061   __HAL_UNLOCK(heth);
<a name="l01062"></a>01062 
<a name="l01063"></a>01063   <span class="comment">/* Return function status */</span>
<a name="l01064"></a>01064   <span class="keywordflow">return</span> HAL_ERROR;
<a name="l01065"></a>01065 }
<a name="l01066"></a>01066 <span class="comment"></span>
<a name="l01067"></a>01067 <span class="comment">/**</span>
<a name="l01068"></a>01068 <span class="comment">  * @brief  Gets the Received frame in interrupt mode.</span>
<a name="l01069"></a>01069 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l01070"></a>01070 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l01071"></a>01071 <span class="comment">  * @retval HAL status</span>
<a name="l01072"></a>01072 <span class="comment">  */</span>
<a name="l01073"></a><a class="code" href="group/group__ETH__Exported__Functions__Group2.html#ga022bfeb7fa6961607b36a196844a5a41">01073</a> HAL_StatusTypeDef <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#ga022bfeb7fa6961607b36a196844a5a41" title="Gets the Received frame in interrupt mode.">HAL_ETH_GetReceivedFrame_IT</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l01074"></a>01074 {
<a name="l01075"></a>01075   uint32_t descriptorscancounter = 0U;
<a name="l01076"></a>01076 
<a name="l01077"></a>01077   <span class="comment">/* Process Locked */</span>
<a name="l01078"></a>01078   __HAL_LOCK(heth);
<a name="l01079"></a>01079 
<a name="l01080"></a>01080   <span class="comment">/* Set ETH HAL State to BUSY */</span>
<a name="l01081"></a>01081   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfae4efe1419676b9077d9ca9133d6dce9c">HAL_ETH_STATE_BUSY</a>;
<a name="l01082"></a>01082 
<a name="l01083"></a>01083   <span class="comment">/* Scan descriptors owned by CPU */</span>
<a name="l01084"></a>01084   <span class="keywordflow">while</span> (((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#af265b9bc7cf452993709d3630ebc1303">Status</a> &amp; <a class="code" href="group/group__ETH__DMA__RX__Descriptor.html#ga7df74546d804a664bdfc4571cd6b7d8a" title="Bit definition of RDES0 register: DMA Rx descriptor status register.">ETH_DMARXDESC_OWN</a>) == (uint32_t)RESET) &amp;&amp; (descriptorscancounter &lt; <a class="code" href="stm32f1xx__hal__conf_8h.html#a62b0f224fa9c4f2e5574c9e52526f751">ETH_RXBUFNB</a>))
<a name="l01085"></a>01085   {
<a name="l01086"></a>01086     <span class="comment">/* Just for security */</span>
<a name="l01087"></a>01087     descriptorscancounter++;
<a name="l01088"></a>01088 
<a name="l01089"></a>01089     <span class="comment">/* Check if first segment in frame */</span>
<a name="l01090"></a>01090     <span class="comment">/* ((heth-&gt;RxDesc-&gt;Status &amp; ETH_DMARXDESC_FS) != (uint32_t)RESET) &amp;&amp; ((heth-&gt;RxDesc-&gt;Status &amp; ETH_DMARXDESC_LS) == (uint32_t)RESET)) */</span>
<a name="l01091"></a>01091     <span class="keywordflow">if</span> ((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#af265b9bc7cf452993709d3630ebc1303">Status</a> &amp; (<a class="code" href="group/group__ETH__DMA__RX__Descriptor.html#gaed0a02f0c7e08723d2f73a4527e3a9a4">ETH_DMARXDESC_FS</a> | <a class="code" href="group/group__ETH__DMA__RX__Descriptor.html#gab8a91e41f3b4d5ecfba08b71f0008e8f">ETH_DMARXDESC_LS</a>)) == (uint32_t)<a class="code" href="group/group__ETH__DMA__RX__Descriptor.html#gaed0a02f0c7e08723d2f73a4527e3a9a4">ETH_DMARXDESC_FS</a>)
<a name="l01092"></a>01092     {
<a name="l01093"></a>01093       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>.<a class="code" href="structETH__DMARxFrameInfos.html#ab132c94c3990552f3767595e2db74e3b">FSRxDesc</a> = heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>;
<a name="l01094"></a>01094       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>.<a class="code" href="structETH__DMARxFrameInfos.html#aac54d89efe22273c53ec52369ef75fb3">SegCount</a> = 1U;
<a name="l01095"></a>01095       <span class="comment">/* Point to next descriptor */</span>
<a name="l01096"></a>01096       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a> = (<a class="code" href="structETH__DMADescTypeDef.html" title="ETH DMA Descriptors data structure definition.">ETH_DMADescTypeDef</a> *)(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#a0153644a6efbcc4e5d44563bd5350dc7">Buffer2NextDescAddr</a>);
<a name="l01097"></a>01097     }
<a name="l01098"></a>01098     <span class="comment">/* Check if intermediate segment */</span>
<a name="l01099"></a>01099     <span class="comment">/* ((heth-&gt;RxDesc-&gt;Status &amp; ETH_DMARXDESC_LS) == (uint32_t)RESET)&amp;&amp; ((heth-&gt;RxDesc-&gt;Status &amp; ETH_DMARXDESC_FS) == (uint32_t)RESET)) */</span>
<a name="l01100"></a>01100     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#af265b9bc7cf452993709d3630ebc1303">Status</a> &amp; (<a class="code" href="group/group__ETH__DMA__RX__Descriptor.html#gab8a91e41f3b4d5ecfba08b71f0008e8f">ETH_DMARXDESC_LS</a> | ETH_DMARXDESC_FS)) == (uint32_t)RESET)
<a name="l01101"></a>01101     {
<a name="l01102"></a>01102       <span class="comment">/* Increment segment count */</span>
<a name="l01103"></a>01103       (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>.<a class="code" href="structETH__DMARxFrameInfos.html#aac54d89efe22273c53ec52369ef75fb3">SegCount</a>)++;
<a name="l01104"></a>01104       <span class="comment">/* Point to next descriptor */</span>
<a name="l01105"></a>01105       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a> = (<a class="code" href="structETH__DMADescTypeDef.html" title="ETH DMA Descriptors data structure definition.">ETH_DMADescTypeDef</a> *)(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#a0153644a6efbcc4e5d44563bd5350dc7">Buffer2NextDescAddr</a>);
<a name="l01106"></a>01106     }
<a name="l01107"></a>01107     <span class="comment">/* Should be last segment */</span>
<a name="l01108"></a>01108     <span class="keywordflow">else</span>
<a name="l01109"></a>01109     {
<a name="l01110"></a>01110       <span class="comment">/* Last segment */</span>
<a name="l01111"></a>01111       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>.<a class="code" href="structETH__DMARxFrameInfos.html#af2ffc09f96d107ae65cc006eae868ed3">LSRxDesc</a> = heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>;
<a name="l01112"></a>01112 
<a name="l01113"></a>01113       <span class="comment">/* Increment segment count */</span>
<a name="l01114"></a>01114       (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>.<a class="code" href="structETH__DMARxFrameInfos.html#aac54d89efe22273c53ec52369ef75fb3">SegCount</a>)++;
<a name="l01115"></a>01115 
<a name="l01116"></a>01116       <span class="comment">/* Check if last segment is first segment: one segment contains the frame */</span>
<a name="l01117"></a>01117       <span class="keywordflow">if</span> ((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>.<a class="code" href="structETH__DMARxFrameInfos.html#aac54d89efe22273c53ec52369ef75fb3">SegCount</a>) == 1U)
<a name="l01118"></a>01118       {
<a name="l01119"></a>01119         heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>.<a class="code" href="structETH__DMARxFrameInfos.html#ab132c94c3990552f3767595e2db74e3b">FSRxDesc</a> = heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>;
<a name="l01120"></a>01120       }
<a name="l01121"></a>01121 
<a name="l01122"></a>01122       <span class="comment">/* Get the Frame Length of the received packet: substruct 4 bytes of the CRC */</span>
<a name="l01123"></a>01123       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>.<a class="code" href="structETH__DMARxFrameInfos.html#a596e39e8b9cfc5cbb4ab4119e355029c">length</a> = (((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>)-&gt;Status &amp; <a class="code" href="group/group__ETH__DMA__RX__Descriptor.html#ga42a29a1104881addcfba3b8a1750b893">ETH_DMARXDESC_FL</a>) &gt;&gt; <a class="code" href="group/group__ETH__Private__Defines.html#gac6ead229f2e09555967ed73507961b1d">ETH_DMARXDESC_FRAMELENGTHSHIFT</a>) - 4U;
<a name="l01124"></a>01124 
<a name="l01125"></a>01125       <span class="comment">/* Get the address of the buffer start address */</span>
<a name="l01126"></a>01126       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>.<a class="code" href="structETH__DMARxFrameInfos.html#a19e3893903dfbed6ffe5fd0137cb0f3b">buffer</a> = ((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a988b6920d90cd86b34ef47e8ec394fd8">RxFrameInfos</a>).FSRxDesc)-&gt;Buffer1Addr;
<a name="l01127"></a>01127 
<a name="l01128"></a>01128       <span class="comment">/* Point to next descriptor */</span>
<a name="l01129"></a>01129       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a> = (<a class="code" href="structETH__DMADescTypeDef.html" title="ETH DMA Descriptors data structure definition.">ETH_DMADescTypeDef</a> *)(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#aeebd8b07fde96d8b26ea328550e22639">RxDesc</a>-&gt;<a class="code" href="structETH__DMADescTypeDef.html#a0153644a6efbcc4e5d44563bd5350dc7">Buffer2NextDescAddr</a>);
<a name="l01130"></a>01130 
<a name="l01131"></a>01131       <span class="comment">/* Set HAL State to Ready */</span>
<a name="l01132"></a>01132       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l01133"></a>01133 
<a name="l01134"></a>01134       <span class="comment">/* Process Unlocked */</span>
<a name="l01135"></a>01135       __HAL_UNLOCK(heth);
<a name="l01136"></a>01136 
<a name="l01137"></a>01137       <span class="comment">/* Return function status */</span>
<a name="l01138"></a>01138       <span class="keywordflow">return</span> HAL_OK;
<a name="l01139"></a>01139     }
<a name="l01140"></a>01140   }
<a name="l01141"></a>01141 
<a name="l01142"></a>01142   <span class="comment">/* Set HAL State to Ready */</span>
<a name="l01143"></a>01143   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l01144"></a>01144 
<a name="l01145"></a>01145   <span class="comment">/* Process Unlocked */</span>
<a name="l01146"></a>01146   __HAL_UNLOCK(heth);
<a name="l01147"></a>01147 
<a name="l01148"></a>01148   <span class="comment">/* Return function status */</span>
<a name="l01149"></a>01149   <span class="keywordflow">return</span> HAL_ERROR;
<a name="l01150"></a>01150 }
<a name="l01151"></a>01151 <span class="comment"></span>
<a name="l01152"></a>01152 <span class="comment">/**</span>
<a name="l01153"></a>01153 <span class="comment">  * @brief  This function handles ETH interrupt request.</span>
<a name="l01154"></a>01154 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l01155"></a>01155 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l01156"></a>01156 <span class="comment">  * @retval HAL status</span>
<a name="l01157"></a>01157 <span class="comment">  */</span>
<a name="l01158"></a><a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gadc6ca0477a999a5c71d2f41cedcbf25d">01158</a> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gadc6ca0477a999a5c71d2f41cedcbf25d" title="This function handles ETH interrupt request.">HAL_ETH_IRQHandler</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l01159"></a>01159 {
<a name="l01160"></a>01160   <span class="comment">/* Frame received */</span>
<a name="l01161"></a>01161   <span class="keywordflow">if</span> (<a class="code" href="group/group__ETH__Exported__Macros.html#ga70dea3381d5666c99dac6f76a5d0741a" title="Checks whether the specified ETHERNET DMA flag is set or not.">__HAL_ETH_DMA_GET_FLAG</a>(heth, <a class="code" href="group/group__ETH__DMA__Flags.html#gac0dc6f85688f9ad34108b0f17782cf99">ETH_DMA_FLAG_R</a>))
<a name="l01162"></a>01162   {
<a name="l01163"></a>01163 <span class="preprocessor">#if (USE_HAL_ETH_REGISTER_CALLBACKS == 1)</span>
<a name="l01164"></a>01164 <span class="preprocessor"></span>    <span class="comment">/*Call registered Receive complete callback*/</span>
<a name="l01165"></a>01165     heth-&gt;RxCpltCallback(heth);
<a name="l01166"></a>01166 <span class="preprocessor">#else</span>
<a name="l01167"></a>01167 <span class="preprocessor"></span>    <span class="comment">/* Receive complete callback */</span>
<a name="l01168"></a>01168     <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gac0609dc4bf97bb5906afdab6b9428654" title="Rx Transfer completed callbacks.">HAL_ETH_RxCpltCallback</a>(heth);
<a name="l01169"></a>01169 <span class="preprocessor">#endif </span><span class="comment">/* USE_HAL_ETH_REGISTER_CALLBACKS */</span>
<a name="l01170"></a>01170 
<a name="l01171"></a>01171     <span class="comment">/* Clear the Eth DMA Rx IT pending bits */</span>
<a name="l01172"></a>01172     <a class="code" href="group/group__ETH__Exported__Macros.html#gad031acb99a9b18a28e4a950947e07e78" title="Clears the ETHERNET DMA IT pending bit.">__HAL_ETH_DMA_CLEAR_IT</a>(heth, <a class="code" href="group/group__ETH__DMA__Interrupts.html#ga1e28b6a79dc99f02b06d669a7b593b5b">ETH_DMA_IT_R</a>);
<a name="l01173"></a>01173 
<a name="l01174"></a>01174     <span class="comment">/* Set HAL State to Ready */</span>
<a name="l01175"></a>01175     heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l01176"></a>01176 
<a name="l01177"></a>01177     <span class="comment">/* Process Unlocked */</span>
<a name="l01178"></a>01178     __HAL_UNLOCK(heth);
<a name="l01179"></a>01179 
<a name="l01180"></a>01180   }
<a name="l01181"></a>01181   <span class="comment">/* Frame transmitted */</span>
<a name="l01182"></a>01182   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group/group__ETH__Exported__Macros.html#ga70dea3381d5666c99dac6f76a5d0741a" title="Checks whether the specified ETHERNET DMA flag is set or not.">__HAL_ETH_DMA_GET_FLAG</a>(heth, <a class="code" href="group/group__ETH__DMA__Flags.html#ga27d755f99004121608588fe328e0e283">ETH_DMA_FLAG_T</a>))
<a name="l01183"></a>01183   {
<a name="l01184"></a>01184 <span class="preprocessor">#if (USE_HAL_ETH_REGISTER_CALLBACKS == 1)</span>
<a name="l01185"></a>01185 <span class="preprocessor"></span>    <span class="comment">/*  Call resgistered Transfer complete callback*/</span>
<a name="l01186"></a>01186     heth-&gt;TxCpltCallback(heth);
<a name="l01187"></a>01187 <span class="preprocessor">#else</span>
<a name="l01188"></a>01188 <span class="preprocessor"></span>    <span class="comment">/* Transfer complete callback */</span>
<a name="l01189"></a>01189     <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gac96b23dde481e897508e8b9ad69e3ecb" title="Tx Transfer completed callbacks.">HAL_ETH_TxCpltCallback</a>(heth);
<a name="l01190"></a>01190 <span class="preprocessor">#endif </span><span class="comment">/* USE_HAL_ETH_REGISTER_CALLBACKS */</span>
<a name="l01191"></a>01191 
<a name="l01192"></a>01192     <span class="comment">/* Clear the Eth DMA Tx IT pending bits */</span>
<a name="l01193"></a>01193     <a class="code" href="group/group__ETH__Exported__Macros.html#gad031acb99a9b18a28e4a950947e07e78" title="Clears the ETHERNET DMA IT pending bit.">__HAL_ETH_DMA_CLEAR_IT</a>(heth, <a class="code" href="group/group__ETH__DMA__Interrupts.html#gab6809574b689752d141e87d39681793d">ETH_DMA_IT_T</a>);
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     <span class="comment">/* Set HAL State to Ready */</span>
<a name="l01196"></a>01196     heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l01197"></a>01197 
<a name="l01198"></a>01198     <span class="comment">/* Process Unlocked */</span>
<a name="l01199"></a>01199     __HAL_UNLOCK(heth);
<a name="l01200"></a>01200   }
<a name="l01201"></a>01201 
<a name="l01202"></a>01202   <span class="comment">/* Clear the interrupt flags */</span>
<a name="l01203"></a>01203   <a class="code" href="group/group__ETH__Exported__Macros.html#gad031acb99a9b18a28e4a950947e07e78" title="Clears the ETHERNET DMA IT pending bit.">__HAL_ETH_DMA_CLEAR_IT</a>(heth, <a class="code" href="group/group__ETH__DMA__Interrupts.html#ga2718ee2b32543a6617deec57c773ec02">ETH_DMA_IT_NIS</a>);
<a name="l01204"></a>01204 
<a name="l01205"></a>01205   <span class="comment">/* ETH DMA Error */</span>
<a name="l01206"></a>01206   <span class="keywordflow">if</span> (<a class="code" href="group/group__ETH__Exported__Macros.html#ga70dea3381d5666c99dac6f76a5d0741a" title="Checks whether the specified ETHERNET DMA flag is set or not.">__HAL_ETH_DMA_GET_FLAG</a>(heth, <a class="code" href="group/group__ETH__DMA__Flags.html#gaa4d34ac665edc98c8f82751a30284a15">ETH_DMA_FLAG_AIS</a>))
<a name="l01207"></a>01207   {
<a name="l01208"></a>01208 <span class="preprocessor">#if (USE_HAL_ETH_REGISTER_CALLBACKS == 1)</span>
<a name="l01209"></a>01209 <span class="preprocessor"></span>    heth-&gt;DMAErrorCallback(heth);
<a name="l01210"></a>01210 <span class="preprocessor">#else</span>
<a name="l01211"></a>01211 <span class="preprocessor"></span>    <span class="comment">/* Ethernet Error callback */</span>
<a name="l01212"></a>01212     <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gabb9424d761aa8a5691f983c5aa842dbe" title="Ethernet transfer error callbacks.">HAL_ETH_ErrorCallback</a>(heth);
<a name="l01213"></a>01213 <span class="preprocessor">#endif </span><span class="comment">/* USE_HAL_ETH_REGISTER_CALLBACKS */</span>
<a name="l01214"></a>01214 
<a name="l01215"></a>01215     <span class="comment">/* Clear the interrupt flags */</span>
<a name="l01216"></a>01216     <a class="code" href="group/group__ETH__Exported__Macros.html#gad031acb99a9b18a28e4a950947e07e78" title="Clears the ETHERNET DMA IT pending bit.">__HAL_ETH_DMA_CLEAR_IT</a>(heth, <a class="code" href="group/group__ETH__DMA__Flags.html#gaa4d34ac665edc98c8f82751a30284a15">ETH_DMA_FLAG_AIS</a>);
<a name="l01217"></a>01217 
<a name="l01218"></a>01218     <span class="comment">/* Set HAL State to Ready */</span>
<a name="l01219"></a>01219     heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l01220"></a>01220 
<a name="l01221"></a>01221     <span class="comment">/* Process Unlocked */</span>
<a name="l01222"></a>01222     __HAL_UNLOCK(heth);
<a name="l01223"></a>01223   }
<a name="l01224"></a>01224 }
<a name="l01225"></a>01225 <span class="comment"></span>
<a name="l01226"></a>01226 <span class="comment">/**</span>
<a name="l01227"></a>01227 <span class="comment">  * @brief  Tx Transfer completed callbacks.</span>
<a name="l01228"></a>01228 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l01229"></a>01229 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l01230"></a>01230 <span class="comment">  * @retval None</span>
<a name="l01231"></a>01231 <span class="comment">  */</span>
<a name="l01232"></a><a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gac96b23dde481e897508e8b9ad69e3ecb">01232</a> __weak <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gac96b23dde481e897508e8b9ad69e3ecb" title="Tx Transfer completed callbacks.">HAL_ETH_TxCpltCallback</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l01233"></a>01233 {
<a name="l01234"></a>01234   <span class="comment">/* Prevent unused argument(s) compilation warning */</span>
<a name="l01235"></a>01235   UNUSED(heth);
<a name="l01236"></a>01236   <span class="comment">/* NOTE : This function Should not be modified, when the callback is needed,</span>
<a name="l01237"></a>01237 <span class="comment">  the HAL_ETH_TxCpltCallback could be implemented in the user file</span>
<a name="l01238"></a>01238 <span class="comment">  */</span>
<a name="l01239"></a>01239 }
<a name="l01240"></a>01240 <span class="comment"></span>
<a name="l01241"></a>01241 <span class="comment">/**</span>
<a name="l01242"></a>01242 <span class="comment">  * @brief  Rx Transfer completed callbacks.</span>
<a name="l01243"></a>01243 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l01244"></a>01244 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l01245"></a>01245 <span class="comment">  * @retval None</span>
<a name="l01246"></a>01246 <span class="comment">  */</span>
<a name="l01247"></a><a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gac0609dc4bf97bb5906afdab6b9428654">01247</a> __weak <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gac0609dc4bf97bb5906afdab6b9428654" title="Rx Transfer completed callbacks.">HAL_ETH_RxCpltCallback</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l01248"></a>01248 {
<a name="l01249"></a>01249   <span class="comment">/* Prevent unused argument(s) compilation warning */</span>
<a name="l01250"></a>01250   UNUSED(heth);
<a name="l01251"></a>01251   <span class="comment">/* NOTE : This function Should not be modified, when the callback is needed,</span>
<a name="l01252"></a>01252 <span class="comment">  the HAL_ETH_TxCpltCallback could be implemented in the user file</span>
<a name="l01253"></a>01253 <span class="comment">  */</span>
<a name="l01254"></a>01254 }
<a name="l01255"></a>01255 <span class="comment"></span>
<a name="l01256"></a>01256 <span class="comment">/**</span>
<a name="l01257"></a>01257 <span class="comment">  * @brief  Ethernet transfer error callbacks</span>
<a name="l01258"></a>01258 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l01259"></a>01259 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l01260"></a>01260 <span class="comment">  * @retval None</span>
<a name="l01261"></a>01261 <span class="comment">  */</span>
<a name="l01262"></a><a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gabb9424d761aa8a5691f983c5aa842dbe">01262</a> __weak <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gabb9424d761aa8a5691f983c5aa842dbe" title="Ethernet transfer error callbacks.">HAL_ETH_ErrorCallback</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l01263"></a>01263 {
<a name="l01264"></a>01264   <span class="comment">/* Prevent unused argument(s) compilation warning */</span>
<a name="l01265"></a>01265   UNUSED(heth);
<a name="l01266"></a>01266   <span class="comment">/* NOTE : This function Should not be modified, when the callback is needed,</span>
<a name="l01267"></a>01267 <span class="comment">  the HAL_ETH_TxCpltCallback could be implemented in the user file</span>
<a name="l01268"></a>01268 <span class="comment">  */</span>
<a name="l01269"></a>01269 }
<a name="l01270"></a>01270 <span class="comment"></span>
<a name="l01271"></a>01271 <span class="comment">/**</span>
<a name="l01272"></a>01272 <span class="comment">  * @brief  Reads a PHY register</span>
<a name="l01273"></a>01273 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l01274"></a>01274 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l01275"></a>01275 <span class="comment">  * @param PHYReg: PHY register address, is the index of one of the 32 PHY register.</span>
<a name="l01276"></a>01276 <span class="comment">  *                This parameter can be one of the following values:</span>
<a name="l01277"></a>01277 <span class="comment">  *                   PHY_BCR: Transceiver Basic Control Register,</span>
<a name="l01278"></a>01278 <span class="comment">  *                   PHY_BSR: Transceiver Basic Status Register.</span>
<a name="l01279"></a>01279 <span class="comment">  *                   More PHY register could be read depending on the used PHY</span>
<a name="l01280"></a>01280 <span class="comment">  * @param RegValue: PHY register value</span>
<a name="l01281"></a>01281 <span class="comment">  * @retval HAL status</span>
<a name="l01282"></a>01282 <span class="comment">  */</span>
<a name="l01283"></a><a class="code" href="group/group__ETH__Exported__Functions__Group2.html#ga1cc478c81ef8f44c021828249b07b86a">01283</a> HAL_StatusTypeDef <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#ga1cc478c81ef8f44c021828249b07b86a" title="Reads a PHY register.">HAL_ETH_ReadPHYRegister</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth, uint16_t PHYReg, uint32_t *RegValue)
<a name="l01284"></a>01284 {
<a name="l01285"></a>01285   uint32_t tmpreg1 = 0U;
<a name="l01286"></a>01286   uint32_t tickstart = 0U;
<a name="l01287"></a>01287 
<a name="l01288"></a>01288   <span class="comment">/* Check parameters */</span>
<a name="l01289"></a>01289   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga93dd53e9cc7912faea69c6f8101a7727">IS_ETH_PHY_ADDRESS</a>(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#aeb40abf84f3e1e45658bb67165fbb3ee">PhyAddress</a>));
<a name="l01290"></a>01290 
<a name="l01291"></a>01291   <span class="comment">/* Check the ETH peripheral state */</span>
<a name="l01292"></a>01292   <span class="keywordflow">if</span> (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> == <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bface1a2af0b855601baee1ee76d1630473">HAL_ETH_STATE_BUSY_RD</a>)
<a name="l01293"></a>01293   {
<a name="l01294"></a>01294     <span class="keywordflow">return</span> HAL_BUSY;
<a name="l01295"></a>01295   }
<a name="l01296"></a>01296   <span class="comment">/* Set ETH HAL State to BUSY_RD */</span>
<a name="l01297"></a>01297   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bface1a2af0b855601baee1ee76d1630473">HAL_ETH_STATE_BUSY_RD</a>;
<a name="l01298"></a>01298 
<a name="l01299"></a>01299   <span class="comment">/* Get the ETHERNET MACMIIAR value */</span>
<a name="l01300"></a>01300   tmpreg1 = heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>-&gt;MACMIIAR;
<a name="l01301"></a>01301 
<a name="l01302"></a>01302   <span class="comment">/* Keep only the CSR Clock Range CR[2:0] bits value */</span>
<a name="l01303"></a>01303   tmpreg1 &amp;= ~<a class="code" href="group/group__ETH__Private__Defines.html#gaf99ee8ca4e2417ef84c83dcb8efd6319">ETH_MACMIIAR_CR_MASK</a>;
<a name="l01304"></a>01304 
<a name="l01305"></a>01305   <span class="comment">/* Prepare the MII address register value */</span>
<a name="l01306"></a>01306   tmpreg1 |= (((uint32_t)heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#aeb40abf84f3e1e45658bb67165fbb3ee">PhyAddress</a> &lt;&lt; 11U) &amp; ETH_MACMIIAR_PA); <span class="comment">/* Set the PHY device address   */</span>
<a name="l01307"></a>01307   tmpreg1 |= (((uint32_t)PHYReg &lt;&lt; 6U) &amp; ETH_MACMIIAR_MR);                <span class="comment">/* Set the PHY register address */</span>
<a name="l01308"></a>01308   tmpreg1 &amp;= ~ETH_MACMIIAR_MW;                                            <span class="comment">/* Set the read mode            */</span>
<a name="l01309"></a>01309   tmpreg1 |= ETH_MACMIIAR_MB;                                             <span class="comment">/* Set the MII Busy bit         */</span>
<a name="l01310"></a>01310 
<a name="l01311"></a>01311   <span class="comment">/* Write the result value into the MII Address register */</span>
<a name="l01312"></a>01312   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>-&gt;MACMIIAR = tmpreg1;
<a name="l01313"></a>01313 
<a name="l01314"></a>01314   <span class="comment">/* Get tick */</span>
<a name="l01315"></a>01315   tickstart = <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gaf2c4f03d53e997a54e1fd5e80daa55c4" title="Provides a tick value in millisecond.">HAL_GetTick</a>();
<a name="l01316"></a>01316 
<a name="l01317"></a>01317   <span class="comment">/* Check for the Busy flag */</span>
<a name="l01318"></a>01318   <span class="keywordflow">while</span> ((tmpreg1 &amp; ETH_MACMIIAR_MB) == ETH_MACMIIAR_MB)
<a name="l01319"></a>01319   {
<a name="l01320"></a>01320     <span class="comment">/* Check for the Timeout */</span>
<a name="l01321"></a>01321     <span class="keywordflow">if</span> ((<a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gaf2c4f03d53e997a54e1fd5e80daa55c4" title="Provides a tick value in millisecond.">HAL_GetTick</a>() - tickstart) &gt; <a class="code" href="stm32f1xx__hal__conf_8h.html#a9d356ada86535630c403690bef0fb887">PHY_READ_TO</a>)
<a name="l01322"></a>01322     {
<a name="l01323"></a>01323       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l01324"></a>01324 
<a name="l01325"></a>01325       <span class="comment">/* Process Unlocked */</span>
<a name="l01326"></a>01326       __HAL_UNLOCK(heth);
<a name="l01327"></a>01327 
<a name="l01328"></a>01328       <span class="keywordflow">return</span> HAL_TIMEOUT;
<a name="l01329"></a>01329     }
<a name="l01330"></a>01330 
<a name="l01331"></a>01331     tmpreg1 = heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>-&gt;MACMIIAR;
<a name="l01332"></a>01332   }
<a name="l01333"></a>01333 
<a name="l01334"></a>01334   <span class="comment">/* Get MACMIIDR value */</span>
<a name="l01335"></a>01335   *RegValue = (uint16_t)(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>-&gt;MACMIIDR);
<a name="l01336"></a>01336 
<a name="l01337"></a>01337   <span class="comment">/* Set ETH HAL State to READY */</span>
<a name="l01338"></a>01338   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l01339"></a>01339 
<a name="l01340"></a>01340   <span class="comment">/* Return function status */</span>
<a name="l01341"></a>01341   <span class="keywordflow">return</span> HAL_OK;
<a name="l01342"></a>01342 }
<a name="l01343"></a>01343 <span class="comment"></span>
<a name="l01344"></a>01344 <span class="comment">/**</span>
<a name="l01345"></a>01345 <span class="comment">  * @brief  Writes to a PHY register.</span>
<a name="l01346"></a>01346 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l01347"></a>01347 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l01348"></a>01348 <span class="comment">  * @param  PHYReg: PHY register address, is the index of one of the 32 PHY register.</span>
<a name="l01349"></a>01349 <span class="comment">  *          This parameter can be one of the following values:</span>
<a name="l01350"></a>01350 <span class="comment">  *             PHY_BCR: Transceiver Control Register.</span>
<a name="l01351"></a>01351 <span class="comment">  *             More PHY register could be written depending on the used PHY</span>
<a name="l01352"></a>01352 <span class="comment">  * @param  RegValue: the value to write</span>
<a name="l01353"></a>01353 <span class="comment">  * @retval HAL status</span>
<a name="l01354"></a>01354 <span class="comment">  */</span>
<a name="l01355"></a><a class="code" href="group/group__ETH__Exported__Functions__Group2.html#ga3e46a062a5a97b8b5920bbd5bfdd09e7">01355</a> HAL_StatusTypeDef <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#ga3e46a062a5a97b8b5920bbd5bfdd09e7" title="Writes to a PHY register.">HAL_ETH_WritePHYRegister</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth, uint16_t PHYReg, uint32_t RegValue)
<a name="l01356"></a>01356 {
<a name="l01357"></a>01357   uint32_t tmpreg1 = 0U;
<a name="l01358"></a>01358   uint32_t tickstart = 0U;
<a name="l01359"></a>01359 
<a name="l01360"></a>01360   <span class="comment">/* Check parameters */</span>
<a name="l01361"></a>01361   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga93dd53e9cc7912faea69c6f8101a7727">IS_ETH_PHY_ADDRESS</a>(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#aeb40abf84f3e1e45658bb67165fbb3ee">PhyAddress</a>));
<a name="l01362"></a>01362 
<a name="l01363"></a>01363   <span class="comment">/* Check the ETH peripheral state */</span>
<a name="l01364"></a>01364   <span class="keywordflow">if</span> (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> == <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa33ae1155e6c8ea4fb9fe9deca348de35">HAL_ETH_STATE_BUSY_WR</a>)
<a name="l01365"></a>01365   {
<a name="l01366"></a>01366     <span class="keywordflow">return</span> HAL_BUSY;
<a name="l01367"></a>01367   }
<a name="l01368"></a>01368   <span class="comment">/* Set ETH HAL State to BUSY_WR */</span>
<a name="l01369"></a>01369   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa33ae1155e6c8ea4fb9fe9deca348de35">HAL_ETH_STATE_BUSY_WR</a>;
<a name="l01370"></a>01370 
<a name="l01371"></a>01371   <span class="comment">/* Get the ETHERNET MACMIIAR value */</span>
<a name="l01372"></a>01372   tmpreg1 = heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>-&gt;MACMIIAR;
<a name="l01373"></a>01373 
<a name="l01374"></a>01374   <span class="comment">/* Keep only the CSR Clock Range CR[2:0] bits value */</span>
<a name="l01375"></a>01375   tmpreg1 &amp;= ~<a class="code" href="group/group__ETH__Private__Defines.html#gaf99ee8ca4e2417ef84c83dcb8efd6319">ETH_MACMIIAR_CR_MASK</a>;
<a name="l01376"></a>01376 
<a name="l01377"></a>01377   <span class="comment">/* Prepare the MII register address value */</span>
<a name="l01378"></a>01378   tmpreg1 |= (((uint32_t)heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#aeb40abf84f3e1e45658bb67165fbb3ee">PhyAddress</a> &lt;&lt; 11U) &amp; ETH_MACMIIAR_PA); <span class="comment">/* Set the PHY device address */</span>
<a name="l01379"></a>01379   tmpreg1 |= (((uint32_t)PHYReg &lt;&lt; 6U) &amp; ETH_MACMIIAR_MR);              <span class="comment">/* Set the PHY register address */</span>
<a name="l01380"></a>01380   tmpreg1 |= ETH_MACMIIAR_MW;                                           <span class="comment">/* Set the write mode */</span>
<a name="l01381"></a>01381   tmpreg1 |= ETH_MACMIIAR_MB;                                           <span class="comment">/* Set the MII Busy bit */</span>
<a name="l01382"></a>01382 
<a name="l01383"></a>01383   <span class="comment">/* Give the value to the MII data register */</span>
<a name="l01384"></a>01384   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>-&gt;MACMIIDR = (uint16_t)RegValue;
<a name="l01385"></a>01385 
<a name="l01386"></a>01386   <span class="comment">/* Write the result value into the MII Address register */</span>
<a name="l01387"></a>01387   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>-&gt;MACMIIAR = tmpreg1;
<a name="l01388"></a>01388 
<a name="l01389"></a>01389   <span class="comment">/* Get tick */</span>
<a name="l01390"></a>01390   tickstart = <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gaf2c4f03d53e997a54e1fd5e80daa55c4" title="Provides a tick value in millisecond.">HAL_GetTick</a>();
<a name="l01391"></a>01391 
<a name="l01392"></a>01392   <span class="comment">/* Check for the Busy flag */</span>
<a name="l01393"></a>01393   <span class="keywordflow">while</span> ((tmpreg1 &amp; ETH_MACMIIAR_MB) == ETH_MACMIIAR_MB)
<a name="l01394"></a>01394   {
<a name="l01395"></a>01395     <span class="comment">/* Check for the Timeout */</span>
<a name="l01396"></a>01396     <span class="keywordflow">if</span> ((<a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gaf2c4f03d53e997a54e1fd5e80daa55c4" title="Provides a tick value in millisecond.">HAL_GetTick</a>() - tickstart) &gt; <a class="code" href="stm32f1xx__hal__conf_8h.html#a474bf13e28d09b667e41b151140ee39d">PHY_WRITE_TO</a>)
<a name="l01397"></a>01397     {
<a name="l01398"></a>01398       heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l01399"></a>01399 
<a name="l01400"></a>01400       <span class="comment">/* Process Unlocked */</span>
<a name="l01401"></a>01401       __HAL_UNLOCK(heth);
<a name="l01402"></a>01402 
<a name="l01403"></a>01403       <span class="keywordflow">return</span> HAL_TIMEOUT;
<a name="l01404"></a>01404     }
<a name="l01405"></a>01405 
<a name="l01406"></a>01406     tmpreg1 = heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>-&gt;MACMIIAR;
<a name="l01407"></a>01407   }
<a name="l01408"></a>01408 
<a name="l01409"></a>01409   <span class="comment">/* Set ETH HAL State to READY */</span>
<a name="l01410"></a>01410   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l01411"></a>01411 
<a name="l01412"></a>01412   <span class="comment">/* Return function status */</span>
<a name="l01413"></a>01413   <span class="keywordflow">return</span> HAL_OK;
<a name="l01414"></a>01414 }
<a name="l01415"></a>01415 <span class="comment"></span>
<a name="l01416"></a>01416 <span class="comment">/**</span>
<a name="l01417"></a>01417 <span class="comment">  * @}</span>
<a name="l01418"></a>01418 <span class="comment">  */</span>
<a name="l01419"></a>01419 <span class="comment"></span>
<a name="l01420"></a>01420 <span class="comment">/** @defgroup ETH_Exported_Functions_Group3 Peripheral Control functions</span>
<a name="l01421"></a>01421 <span class="comment"> *  @brief    Peripheral Control functions</span>
<a name="l01422"></a>01422 <span class="comment"> *</span>
<a name="l01423"></a>01423 <span class="comment">@verbatim</span>
<a name="l01424"></a>01424 <span class="comment"> ===============================================================================</span>
<a name="l01425"></a>01425 <span class="comment">                  ##### Peripheral Control functions #####</span>
<a name="l01426"></a>01426 <span class="comment"> ===============================================================================</span>
<a name="l01427"></a>01427 <span class="comment">    [..]  This section provides functions allowing to:</span>
<a name="l01428"></a>01428 <span class="comment">      (+) Enable MAC and DMA transmission and reception.</span>
<a name="l01429"></a>01429 <span class="comment">          HAL_ETH_Start();</span>
<a name="l01430"></a>01430 <span class="comment">      (+) Disable MAC and DMA transmission and reception.</span>
<a name="l01431"></a>01431 <span class="comment">          HAL_ETH_Stop();</span>
<a name="l01432"></a>01432 <span class="comment">      (+) Set the MAC configuration in runtime mode</span>
<a name="l01433"></a>01433 <span class="comment">          HAL_ETH_ConfigMAC();</span>
<a name="l01434"></a>01434 <span class="comment">      (+) Set the DMA configuration in runtime mode</span>
<a name="l01435"></a>01435 <span class="comment">          HAL_ETH_ConfigDMA();</span>
<a name="l01436"></a>01436 <span class="comment"></span>
<a name="l01437"></a>01437 <span class="comment">@endverbatim</span>
<a name="l01438"></a>01438 <span class="comment">  * @{</span>
<a name="l01439"></a>01439 <span class="comment">  */</span>
<a name="l01440"></a>01440 <span class="comment"></span>
<a name="l01441"></a>01441 <span class="comment">/**</span>
<a name="l01442"></a>01442 <span class="comment"> * @brief  Enables Ethernet MAC and DMA reception/transmission</span>
<a name="l01443"></a>01443 <span class="comment"> * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l01444"></a>01444 <span class="comment"> *         the configuration information for ETHERNET module</span>
<a name="l01445"></a>01445 <span class="comment"> * @retval HAL status</span>
<a name="l01446"></a>01446 <span class="comment"> */</span>
<a name="l01447"></a><a class="code" href="group/group__ETH__Exported__Functions__Group3.html#ga3016b3f463eca679428244a5d7d286b8">01447</a> HAL_StatusTypeDef <a class="code" href="group/group__ETH__Exported__Functions__Group3.html#ga3016b3f463eca679428244a5d7d286b8" title="Enables Ethernet MAC and DMA reception/transmission.">HAL_ETH_Start</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l01448"></a>01448 {
<a name="l01449"></a>01449   <span class="comment">/* Process Locked */</span>
<a name="l01450"></a>01450   __HAL_LOCK(heth);
<a name="l01451"></a>01451 
<a name="l01452"></a>01452   <span class="comment">/* Set the ETH peripheral state to BUSY */</span>
<a name="l01453"></a>01453   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfae4efe1419676b9077d9ca9133d6dce9c">HAL_ETH_STATE_BUSY</a>;
<a name="l01454"></a>01454 
<a name="l01455"></a>01455   <span class="comment">/* Enable transmit state machine of the MAC for transmission on the MII */</span>
<a name="l01456"></a>01456   <a class="code" href="group/group__ETH__Private__Functions.html#gabb47dbf0dc21c9a513dd950ac0fc5a0d" title="Enables the MAC transmission.">ETH_MACTransmissionEnable</a>(heth);
<a name="l01457"></a>01457 
<a name="l01458"></a>01458   <span class="comment">/* Enable receive state machine of the MAC for reception from the MII */</span>
<a name="l01459"></a>01459   <a class="code" href="group/group__ETH__Private__Functions.html#ga745fa00d6214af8cecf06542f9e05d63" title="Enables the MAC reception.">ETH_MACReceptionEnable</a>(heth);
<a name="l01460"></a>01460 
<a name="l01461"></a>01461   <span class="comment">/* Flush Transmit FIFO */</span>
<a name="l01462"></a>01462   <a class="code" href="group/group__ETH__Private__Functions.html#gaf608a0b63258ad4adb1e9a14f8a0546f" title="Clears the ETHERNET transmit FIFO.">ETH_FlushTransmitFIFO</a>(heth);
<a name="l01463"></a>01463 
<a name="l01464"></a>01464   <span class="comment">/* Start DMA transmission */</span>
<a name="l01465"></a>01465   <a class="code" href="group/group__ETH__Private__Functions.html#ga93b1d3f59736fff1b50ef3ccc85c3bf6" title="Enables the DMA transmission.">ETH_DMATransmissionEnable</a>(heth);
<a name="l01466"></a>01466 
<a name="l01467"></a>01467   <span class="comment">/* Start DMA reception */</span>
<a name="l01468"></a>01468   <a class="code" href="group/group__ETH__Private__Functions.html#ga40f6929c9bb79bbb13fcf8923090c4d7" title="Enables the DMA reception.">ETH_DMAReceptionEnable</a>(heth);
<a name="l01469"></a>01469 
<a name="l01470"></a>01470   <span class="comment">/* Set the ETH state to READY*/</span>
<a name="l01471"></a>01471   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l01472"></a>01472 
<a name="l01473"></a>01473   <span class="comment">/* Process Unlocked */</span>
<a name="l01474"></a>01474   __HAL_UNLOCK(heth);
<a name="l01475"></a>01475 
<a name="l01476"></a>01476   <span class="comment">/* Return function status */</span>
<a name="l01477"></a>01477   <span class="keywordflow">return</span> HAL_OK;
<a name="l01478"></a>01478 }
<a name="l01479"></a>01479 <span class="comment"></span>
<a name="l01480"></a>01480 <span class="comment">/**</span>
<a name="l01481"></a>01481 <span class="comment">  * @brief  Stop Ethernet MAC and DMA reception/transmission</span>
<a name="l01482"></a>01482 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l01483"></a>01483 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l01484"></a>01484 <span class="comment">  * @retval HAL status</span>
<a name="l01485"></a>01485 <span class="comment">  */</span>
<a name="l01486"></a><a class="code" href="group/group__ETH__Exported__Functions__Group3.html#gae40b55bbb4b3a4ac34b8f17c09ce3ff0">01486</a> HAL_StatusTypeDef <a class="code" href="group/group__ETH__Exported__Functions__Group3.html#gae40b55bbb4b3a4ac34b8f17c09ce3ff0" title="Stop Ethernet MAC and DMA reception/transmission.">HAL_ETH_Stop</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l01487"></a>01487 {
<a name="l01488"></a>01488   <span class="comment">/* Process Locked */</span>
<a name="l01489"></a>01489   __HAL_LOCK(heth);
<a name="l01490"></a>01490 
<a name="l01491"></a>01491   <span class="comment">/* Set the ETH peripheral state to BUSY */</span>
<a name="l01492"></a>01492   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfae4efe1419676b9077d9ca9133d6dce9c">HAL_ETH_STATE_BUSY</a>;
<a name="l01493"></a>01493 
<a name="l01494"></a>01494   <span class="comment">/* Stop DMA transmission */</span>
<a name="l01495"></a>01495   <a class="code" href="group/group__ETH__Private__Functions.html#ga58c934fdbdd20c3ec7a15f6e245933bf" title="Disables the DMA transmission.">ETH_DMATransmissionDisable</a>(heth);
<a name="l01496"></a>01496 
<a name="l01497"></a>01497   <span class="comment">/* Stop DMA reception */</span>
<a name="l01498"></a>01498   <a class="code" href="group/group__ETH__Private__Functions.html#gaed0cf21dc49879e0fd45b2873d4a75e5" title="Disables the DMA reception.">ETH_DMAReceptionDisable</a>(heth);
<a name="l01499"></a>01499 
<a name="l01500"></a>01500   <span class="comment">/* Disable receive state machine of the MAC for reception from the MII */</span>
<a name="l01501"></a>01501   <a class="code" href="group/group__ETH__Private__Functions.html#ga4d330655bc9aa7e89b0678c8e41dc843" title="Disables the MAC reception.">ETH_MACReceptionDisable</a>(heth);
<a name="l01502"></a>01502 
<a name="l01503"></a>01503   <span class="comment">/* Flush Transmit FIFO */</span>
<a name="l01504"></a>01504   <a class="code" href="group/group__ETH__Private__Functions.html#gaf608a0b63258ad4adb1e9a14f8a0546f" title="Clears the ETHERNET transmit FIFO.">ETH_FlushTransmitFIFO</a>(heth);
<a name="l01505"></a>01505 
<a name="l01506"></a>01506   <span class="comment">/* Disable transmit state machine of the MAC for transmission on the MII */</span>
<a name="l01507"></a>01507   <a class="code" href="group/group__ETH__Private__Functions.html#ga8d818da79bab22874e7915ccded59130" title="Disables the MAC transmission.">ETH_MACTransmissionDisable</a>(heth);
<a name="l01508"></a>01508 
<a name="l01509"></a>01509   <span class="comment">/* Set the ETH state*/</span>
<a name="l01510"></a>01510   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l01511"></a>01511 
<a name="l01512"></a>01512   <span class="comment">/* Process Unlocked */</span>
<a name="l01513"></a>01513   __HAL_UNLOCK(heth);
<a name="l01514"></a>01514 
<a name="l01515"></a>01515   <span class="comment">/* Return function status */</span>
<a name="l01516"></a>01516   <span class="keywordflow">return</span> HAL_OK;
<a name="l01517"></a>01517 }
<a name="l01518"></a>01518 <span class="comment"></span>
<a name="l01519"></a>01519 <span class="comment">/**</span>
<a name="l01520"></a>01520 <span class="comment">  * @brief  Set ETH MAC Configuration.</span>
<a name="l01521"></a>01521 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l01522"></a>01522 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l01523"></a>01523 <span class="comment">  * @param  macconf: MAC Configuration structure</span>
<a name="l01524"></a>01524 <span class="comment">  * @retval HAL status</span>
<a name="l01525"></a>01525 <span class="comment">  */</span>
<a name="l01526"></a><a class="code" href="group/group__ETH__Exported__Functions__Group3.html#ga49ac8de8cc04ed2e920978444503bc99">01526</a> HAL_StatusTypeDef <a class="code" href="group/group__ETH__Exported__Functions__Group3.html#ga49ac8de8cc04ed2e920978444503bc99" title="Set ETH MAC Configuration.">HAL_ETH_ConfigMAC</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth, <a class="code" href="structETH__MACInitTypeDef.html" title="ETH MAC Configuration Structure definition.">ETH_MACInitTypeDef</a> *macconf)
<a name="l01527"></a>01527 {
<a name="l01528"></a>01528   uint32_t tmpreg1 = 0U;
<a name="l01529"></a>01529 
<a name="l01530"></a>01530   <span class="comment">/* Process Locked */</span>
<a name="l01531"></a>01531   __HAL_LOCK(heth);
<a name="l01532"></a>01532 
<a name="l01533"></a>01533   <span class="comment">/* Set the ETH peripheral state to BUSY */</span>
<a name="l01534"></a>01534   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfae4efe1419676b9077d9ca9133d6dce9c">HAL_ETH_STATE_BUSY</a>;
<a name="l01535"></a>01535 
<a name="l01536"></a>01536   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga40e3bc2833cd65e7f1ea1d2501cb6f5b">IS_ETH_SPEED</a>(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#aa3937b6109b57f923be10b7ed01d4851">Speed</a>));
<a name="l01537"></a>01537   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga969fd727f78be3069201ce46af4bd9a5">IS_ETH_DUPLEX_MODE</a>(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#a54655cd6e0aa3279608559e2eeb5e28c">DuplexMode</a>));
<a name="l01538"></a>01538 
<a name="l01539"></a>01539   <span class="keywordflow">if</span> (macconf != NULL)
<a name="l01540"></a>01540   {
<a name="l01541"></a>01541     <span class="comment">/* Check the parameters */</span>
<a name="l01542"></a>01542     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga106c4e2f2f23d651feaf5eaa12b6df9f">IS_ETH_WATCHDOG</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#abc70549d59dfd63ec88a225b5cdca2f6">Watchdog</a>));
<a name="l01543"></a>01543     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga3bb6e6bc84e5463de927f35a445cc58d">IS_ETH_JABBER</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a402b274a00f90c4ecf64b4bf1bbdd954">Jabber</a>));
<a name="l01544"></a>01544     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gad7d1ebb60ebca0c381f7d7d32a4b597d">IS_ETH_INTER_FRAME_GAP</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a8856bba09b2f077d5489ff617165f1b8">InterFrameGap</a>));
<a name="l01545"></a>01545     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga8a9d07fcb03917ca72683a2c65f08a0f">IS_ETH_CARRIER_SENSE</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a04100c17d9f4f128c4ac5852e9394dcc">CarrierSense</a>));
<a name="l01546"></a>01546     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gad6b4a676a523bae476e24b1d36b60809">IS_ETH_RECEIVE_OWN</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a8bacba8c173fb53e2e554ec2133aa63e">ReceiveOwn</a>));
<a name="l01547"></a>01547     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gad5c8cd11354c13650aa488cacb44b2dd">IS_ETH_LOOPBACK_MODE</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#afde2312197db7915a028bfd3d7c28f6d">LoopbackMode</a>));
<a name="l01548"></a>01548     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gaa16cc488c5116474a64e1c5610a8bf65">IS_ETH_CHECKSUM_OFFLOAD</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#ad97ae0c7f2efe5b3a3627425e46b4435">ChecksumOffload</a>));
<a name="l01549"></a>01549     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga1ed828c83fb291de37077c1f32a6c5f2">IS_ETH_RETRY_TRANSMISSION</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a19aaa3e133d2c2e385a2d271705bae0b">RetryTransmission</a>));
<a name="l01550"></a>01550     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gab5f29e17bf54d3b88f57444da20fd327">IS_ETH_AUTOMATIC_PADCRC_STRIP</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#ad6cb7a75669f90a9138490c941e2bb39">AutomaticPadCRCStrip</a>));
<a name="l01551"></a>01551     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gad43dc2aace1094485047db9453822e32">IS_ETH_BACKOFF_LIMIT</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a9f4116699468469693618cc31046010d">BackOffLimit</a>));
<a name="l01552"></a>01552     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga8145a9dde9adc25cec7f47e7e2c8a2db">IS_ETH_DEFERRAL_CHECK</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a3ada22c49852e5be4ca42321a64c0f8a">DeferralCheck</a>));
<a name="l01553"></a>01553     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga5c50fc11e6c3c45a18fc9b8ccb7389b7">IS_ETH_RECEIVE_ALL</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#aaf03ffe5b3ad36a9a877b616fdd34275">ReceiveAll</a>));
<a name="l01554"></a>01554     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gad0d6a0f445b659028ff55af785d68c68">IS_ETH_SOURCE_ADDR_FILTER</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#aad3a7f788eba5ec06aa98427177cc00b">SourceAddrFilter</a>));
<a name="l01555"></a>01555     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gaf86603506251cf3b9eb0aa0b937e0a53">IS_ETH_CONTROL_FRAMES</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#abbdeea6b481c7fb15bda42f41bcace60">PassControlFrames</a>));
<a name="l01556"></a>01556     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gaf439118e2dea4a07deafd8c6af61b45e">IS_ETH_BROADCAST_FRAMES_RECEPTION</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a8d22f19753438b68c4393696a37b5ebd">BroadcastFramesReception</a>));
<a name="l01557"></a>01557     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gaf25279f1f21f7b9f544615996ebf724d">IS_ETH_DESTINATION_ADDR_FILTER</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#aa08b33448fe33adfa4d34e15f9bdb367">DestinationAddrFilter</a>));
<a name="l01558"></a>01558     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gae3c1100056f881dcf2acd320c2e90abd">IS_ETH_PROMISCUOUS_MODE</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#ae194255a7a780583482779b04ad90e4b">PromiscuousMode</a>));
<a name="l01559"></a>01559     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga005048aceaf60cdf5a3906a2bb369f4d">IS_ETH_MULTICAST_FRAMES_FILTER</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a6d7a07ade90f2905b01508d496e40b79">MulticastFramesFilter</a>));
<a name="l01560"></a>01560     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga2279b1da31f2ac5d2b1e65261818f728">IS_ETH_UNICAST_FRAMES_FILTER</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a7f24269f241e65b55ddbbcdc05a8b7c4">UnicastFramesFilter</a>));
<a name="l01561"></a>01561     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga9cd8b87f017d9a2f2384b691779fda38">IS_ETH_PAUSE_TIME</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a726ebba49a7a4134996f3abafa1c1a0a">PauseTime</a>));
<a name="l01562"></a>01562     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga17783651850604b8d65efabfdb8949d1">IS_ETH_ZEROQUANTA_PAUSE</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#ae3604370b904432db12253d5a4827bcc">ZeroQuantaPause</a>));
<a name="l01563"></a>01563     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga7a5893c9d2dbe4720f8268195f024c4a">IS_ETH_PAUSE_LOW_THRESHOLD</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a3a03b793f92af5cce9471c19b23056d6">PauseLowThreshold</a>));
<a name="l01564"></a>01564     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga71830e6423f5d363c5357bc986a108ec">IS_ETH_UNICAST_PAUSE_FRAME_DETECT</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#ae5dbb23f8b746ac923554d7756faba6d">UnicastPauseFrameDetect</a>));
<a name="l01565"></a>01565     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gab57e51e2e41487e5128ecc22b3a91133">IS_ETH_RECEIVE_FLOWCONTROL</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#acb293ed2557bba31392965021776e2a4">ReceiveFlowControl</a>));
<a name="l01566"></a>01566     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gacfce6946c6333a60a6b035fea2c9b3a8">IS_ETH_TRANSMIT_FLOWCONTROL</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a4a974aedd9372947e4dadc2b8c3515a3">TransmitFlowControl</a>));
<a name="l01567"></a>01567     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga3189756bb0b8d8707c3350a77a66ba2e">IS_ETH_VLAN_TAG_COMPARISON</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a32aa33a1fbeaf4ce516c0a27aa2c49f1">VLANTagComparison</a>));
<a name="l01568"></a>01568     <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga6278fc62052b7c2d114a48dca33e9d6e">IS_ETH_VLAN_TAG_IDENTIFIER</a>(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a3d6915ff0e524a1d042704d5a96589ed">VLANTagIdentifier</a>));
<a name="l01569"></a>01569 
<a name="l01570"></a>01570     <span class="comment">/*------------------------ ETHERNET MACCR Configuration --------------------*/</span>
<a name="l01571"></a>01571     <span class="comment">/* Get the ETHERNET MACCR value */</span>
<a name="l01572"></a>01572     tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR;
<a name="l01573"></a>01573     <span class="comment">/* Clear WD, PCE, PS, TE and RE bits */</span>
<a name="l01574"></a>01574     tmpreg1 &amp;= <a class="code" href="group/group__ETH__Private__Defines.html#ga37701d0199bc22ea258985c6b59fc201">ETH_MACCR_CLEAR_MASK</a>;
<a name="l01575"></a>01575 
<a name="l01576"></a>01576     tmpreg1 |= (uint32_t)(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#abc70549d59dfd63ec88a225b5cdca2f6">Watchdog</a> |
<a name="l01577"></a>01577                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a402b274a00f90c4ecf64b4bf1bbdd954">Jabber</a> |
<a name="l01578"></a>01578                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a8856bba09b2f077d5489ff617165f1b8">InterFrameGap</a> |
<a name="l01579"></a>01579                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a04100c17d9f4f128c4ac5852e9394dcc">CarrierSense</a> |
<a name="l01580"></a>01580                           (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).Speed |
<a name="l01581"></a>01581                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a8bacba8c173fb53e2e554ec2133aa63e">ReceiveOwn</a> |
<a name="l01582"></a>01582                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#afde2312197db7915a028bfd3d7c28f6d">LoopbackMode</a> |
<a name="l01583"></a>01583                           (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).DuplexMode |
<a name="l01584"></a>01584                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#ad97ae0c7f2efe5b3a3627425e46b4435">ChecksumOffload</a> |
<a name="l01585"></a>01585                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a19aaa3e133d2c2e385a2d271705bae0b">RetryTransmission</a> |
<a name="l01586"></a>01586                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#ad6cb7a75669f90a9138490c941e2bb39">AutomaticPadCRCStrip</a> |
<a name="l01587"></a>01587                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a9f4116699468469693618cc31046010d">BackOffLimit</a> |
<a name="l01588"></a>01588                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a3ada22c49852e5be4ca42321a64c0f8a">DeferralCheck</a>);
<a name="l01589"></a>01589 
<a name="l01590"></a>01590     <span class="comment">/* Write to ETHERNET MACCR */</span>
<a name="l01591"></a>01591     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR = (uint32_t)tmpreg1;
<a name="l01592"></a>01592 
<a name="l01593"></a>01593     <span class="comment">/* Wait until the write operation will be taken into account :</span>
<a name="l01594"></a>01594 <span class="comment">    at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l01595"></a>01595     tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR;
<a name="l01596"></a>01596     <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gae63b34eea12780ca2e1100c2402da18e" title="This function provides minimum delay (in milliseconds) based on variable incremented.">HAL_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l01597"></a>01597     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR = tmpreg1;
<a name="l01598"></a>01598 
<a name="l01599"></a>01599     <span class="comment">/*----------------------- ETHERNET MACFFR Configuration --------------------*/</span>
<a name="l01600"></a>01600     <span class="comment">/* Write to ETHERNET MACFFR */</span>
<a name="l01601"></a>01601     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACFFR = (uint32_t)(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#aaf03ffe5b3ad36a9a877b616fdd34275">ReceiveAll</a> |
<a name="l01602"></a>01602                                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#aad3a7f788eba5ec06aa98427177cc00b">SourceAddrFilter</a> |
<a name="l01603"></a>01603                                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#abbdeea6b481c7fb15bda42f41bcace60">PassControlFrames</a> |
<a name="l01604"></a>01604                                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a8d22f19753438b68c4393696a37b5ebd">BroadcastFramesReception</a> |
<a name="l01605"></a>01605                                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#aa08b33448fe33adfa4d34e15f9bdb367">DestinationAddrFilter</a> |
<a name="l01606"></a>01606                                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#ae194255a7a780583482779b04ad90e4b">PromiscuousMode</a> |
<a name="l01607"></a>01607                                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a6d7a07ade90f2905b01508d496e40b79">MulticastFramesFilter</a> |
<a name="l01608"></a>01608                                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a7f24269f241e65b55ddbbcdc05a8b7c4">UnicastFramesFilter</a>);
<a name="l01609"></a>01609 
<a name="l01610"></a>01610     <span class="comment">/* Wait until the write operation will be taken into account :</span>
<a name="l01611"></a>01611 <span class="comment">    at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l01612"></a>01612     tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACFFR;
<a name="l01613"></a>01613     <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gae63b34eea12780ca2e1100c2402da18e" title="This function provides minimum delay (in milliseconds) based on variable incremented.">HAL_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l01614"></a>01614     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACFFR = tmpreg1;
<a name="l01615"></a>01615 
<a name="l01616"></a>01616     <span class="comment">/*--------------- ETHERNET MACHTHR and MACHTLR Configuration ---------------*/</span>
<a name="l01617"></a>01617     <span class="comment">/* Write to ETHERNET MACHTHR */</span>
<a name="l01618"></a>01618     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACHTHR = (uint32_t)macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a113b43786edc8318b67387ad2871083d">HashTableHigh</a>;
<a name="l01619"></a>01619 
<a name="l01620"></a>01620     <span class="comment">/* Write to ETHERNET MACHTLR */</span>
<a name="l01621"></a>01621     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACHTLR = (uint32_t)macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#ae66fa96348538e5480fb45f58bf91669">HashTableLow</a>;
<a name="l01622"></a>01622     <span class="comment">/*----------------------- ETHERNET MACFCR Configuration --------------------*/</span>
<a name="l01623"></a>01623 
<a name="l01624"></a>01624     <span class="comment">/* Get the ETHERNET MACFCR value */</span>
<a name="l01625"></a>01625     tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACFCR;
<a name="l01626"></a>01626     <span class="comment">/* Clear xx bits */</span>
<a name="l01627"></a>01627     tmpreg1 &amp;= <a class="code" href="group/group__ETH__Private__Defines.html#ga758ca683139255de7b90bf1ec4ba064c">ETH_MACFCR_CLEAR_MASK</a>;
<a name="l01628"></a>01628 
<a name="l01629"></a>01629     tmpreg1 |= (uint32_t)((macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a726ebba49a7a4134996f3abafa1c1a0a">PauseTime</a> &lt;&lt; 16U) |
<a name="l01630"></a>01630                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#ae3604370b904432db12253d5a4827bcc">ZeroQuantaPause</a> |
<a name="l01631"></a>01631                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a3a03b793f92af5cce9471c19b23056d6">PauseLowThreshold</a> |
<a name="l01632"></a>01632                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#ae5dbb23f8b746ac923554d7756faba6d">UnicastPauseFrameDetect</a> |
<a name="l01633"></a>01633                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#acb293ed2557bba31392965021776e2a4">ReceiveFlowControl</a> |
<a name="l01634"></a>01634                           macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a4a974aedd9372947e4dadc2b8c3515a3">TransmitFlowControl</a>);
<a name="l01635"></a>01635 
<a name="l01636"></a>01636     <span class="comment">/* Write to ETHERNET MACFCR */</span>
<a name="l01637"></a>01637     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACFCR = (uint32_t)tmpreg1;
<a name="l01638"></a>01638 
<a name="l01639"></a>01639     <span class="comment">/* Wait until the write operation will be taken into account :</span>
<a name="l01640"></a>01640 <span class="comment">    at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l01641"></a>01641     tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACFCR;
<a name="l01642"></a>01642     <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gae63b34eea12780ca2e1100c2402da18e" title="This function provides minimum delay (in milliseconds) based on variable incremented.">HAL_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l01643"></a>01643     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACFCR = tmpreg1;
<a name="l01644"></a>01644 
<a name="l01645"></a>01645     <span class="comment">/*----------------------- ETHERNET MACVLANTR Configuration -----------------*/</span>
<a name="l01646"></a>01646     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACVLANTR = (uint32_t)(macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a32aa33a1fbeaf4ce516c0a27aa2c49f1">VLANTagComparison</a> |
<a name="l01647"></a>01647                                              macconf-&gt;<a class="code" href="structETH__MACInitTypeDef.html#a3d6915ff0e524a1d042704d5a96589ed">VLANTagIdentifier</a>);
<a name="l01648"></a>01648 
<a name="l01649"></a>01649     <span class="comment">/* Wait until the write operation will be taken into account :</span>
<a name="l01650"></a>01650 <span class="comment">    at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l01651"></a>01651     tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACVLANTR;
<a name="l01652"></a>01652     <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gae63b34eea12780ca2e1100c2402da18e" title="This function provides minimum delay (in milliseconds) based on variable incremented.">HAL_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l01653"></a>01653     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACVLANTR = tmpreg1;
<a name="l01654"></a>01654   }
<a name="l01655"></a>01655   <span class="keywordflow">else</span> <span class="comment">/* macconf == NULL : here we just configure Speed and Duplex mode */</span>
<a name="l01656"></a>01656   {
<a name="l01657"></a>01657     <span class="comment">/*------------------------ ETHERNET MACCR Configuration --------------------*/</span>
<a name="l01658"></a>01658     <span class="comment">/* Get the ETHERNET MACCR value */</span>
<a name="l01659"></a>01659     tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR;
<a name="l01660"></a>01660 
<a name="l01661"></a>01661     <span class="comment">/* Clear FES and DM bits */</span>
<a name="l01662"></a>01662     tmpreg1 &amp;= ~(0x00004800U);
<a name="l01663"></a>01663 
<a name="l01664"></a>01664     tmpreg1 |= (uint32_t)(heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#aa3937b6109b57f923be10b7ed01d4851">Speed</a> | heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#a54655cd6e0aa3279608559e2eeb5e28c">DuplexMode</a>);
<a name="l01665"></a>01665 
<a name="l01666"></a>01666     <span class="comment">/* Write to ETHERNET MACCR */</span>
<a name="l01667"></a>01667     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR = (uint32_t)tmpreg1;
<a name="l01668"></a>01668 
<a name="l01669"></a>01669     <span class="comment">/* Wait until the write operation will be taken into account:</span>
<a name="l01670"></a>01670 <span class="comment">    at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l01671"></a>01671     tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR;
<a name="l01672"></a>01672     <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gae63b34eea12780ca2e1100c2402da18e" title="This function provides minimum delay (in milliseconds) based on variable incremented.">HAL_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l01673"></a>01673     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR = tmpreg1;
<a name="l01674"></a>01674   }
<a name="l01675"></a>01675 
<a name="l01676"></a>01676   <span class="comment">/* Set the ETH state to Ready */</span>
<a name="l01677"></a>01677   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l01678"></a>01678 
<a name="l01679"></a>01679   <span class="comment">/* Process Unlocked */</span>
<a name="l01680"></a>01680   __HAL_UNLOCK(heth);
<a name="l01681"></a>01681 
<a name="l01682"></a>01682   <span class="comment">/* Return function status */</span>
<a name="l01683"></a>01683   <span class="keywordflow">return</span> HAL_OK;
<a name="l01684"></a>01684 }
<a name="l01685"></a>01685 <span class="comment"></span>
<a name="l01686"></a>01686 <span class="comment">/**</span>
<a name="l01687"></a>01687 <span class="comment">  * @brief  Sets ETH DMA Configuration.</span>
<a name="l01688"></a>01688 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l01689"></a>01689 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l01690"></a>01690 <span class="comment">  * @param  dmaconf: DMA Configuration structure</span>
<a name="l01691"></a>01691 <span class="comment">  * @retval HAL status</span>
<a name="l01692"></a>01692 <span class="comment">  */</span>
<a name="l01693"></a><a class="code" href="group/group__ETH__Exported__Functions__Group3.html#ga15955d746dcc827629ae24d948157b1c">01693</a> HAL_StatusTypeDef <a class="code" href="group/group__ETH__Exported__Functions__Group3.html#ga15955d746dcc827629ae24d948157b1c" title="Sets ETH DMA Configuration.">HAL_ETH_ConfigDMA</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth, <a class="code" href="structETH__DMAInitTypeDef.html" title="ETH DMA Configuration Structure definition.">ETH_DMAInitTypeDef</a> *dmaconf)
<a name="l01694"></a>01694 {
<a name="l01695"></a>01695   uint32_t tmpreg1 = 0U;
<a name="l01696"></a>01696 
<a name="l01697"></a>01697   <span class="comment">/* Process Locked */</span>
<a name="l01698"></a>01698   __HAL_LOCK(heth);
<a name="l01699"></a>01699 
<a name="l01700"></a>01700   <span class="comment">/* Set the ETH peripheral state to BUSY */</span>
<a name="l01701"></a>01701   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfae4efe1419676b9077d9ca9133d6dce9c">HAL_ETH_STATE_BUSY</a>;
<a name="l01702"></a>01702 
<a name="l01703"></a>01703   <span class="comment">/* Check parameters */</span>
<a name="l01704"></a>01704   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gac2dc36a0990eda6ffb2b6f56564efffb">IS_ETH_DROP_TCPIP_CHECKSUM_FRAME</a>(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#adde9f6029b172020ac6a1cb14bf8e68f">DropTCPIPChecksumErrorFrame</a>));
<a name="l01705"></a>01705   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gaff6dd79ad4eaec5ef25ebb80c1f1ad16">IS_ETH_RECEIVE_STORE_FORWARD</a>(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a28be85beb274d8e6d94cf1f420bd5d4a">ReceiveStoreForward</a>));
<a name="l01706"></a>01706   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga80f382d7c2bfc5e83bb10e926d0bb614">IS_ETH_FLUSH_RECEIVE_FRAME</a>(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a92eee4059671bcae220c0d82134ce784">FlushReceivedFrame</a>));
<a name="l01707"></a>01707   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga60776eaf90308ef009968af114ea4ad9">IS_ETH_TRANSMIT_STORE_FORWARD</a>(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#ab4bdbc785494d0306541257217ff648f">TransmitStoreForward</a>));
<a name="l01708"></a>01708   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga3fc0dd9507f8e42b31883404b22a1ed8">IS_ETH_TRANSMIT_THRESHOLD_CONTROL</a>(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#af5238a7b937f08f857cb4fc9b13cc764">TransmitThresholdControl</a>));
<a name="l01709"></a>01709   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gabdc367d707927dc58c66c4149bfe0062">IS_ETH_FORWARD_ERROR_FRAMES</a>(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a2bf15d7481824d129c111a6a09fb9cca">ForwardErrorFrames</a>));
<a name="l01710"></a>01710   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga396d1c32f54795ba0a3648a12084cc78">IS_ETH_FORWARD_UNDERSIZED_GOOD_FRAMES</a>(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a18cc15950193e4e110553cccc645dee2">ForwardUndersizedGoodFrames</a>));
<a name="l01711"></a>01711   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gaa8d7a425eda457cae75d598372bc2d84">IS_ETH_RECEIVE_THRESHOLD_CONTROL</a>(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#ab692ba44c3abd7ebf524a6e0667b896d">ReceiveThresholdControl</a>));
<a name="l01712"></a>01712   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga7d3935bcff40a471112cc854d20c9029">IS_ETH_SECOND_FRAME_OPERATE</a>(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#ac517ce01c33a90d757d9bc601c86016a">SecondFrameOperate</a>));
<a name="l01713"></a>01713   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gaf7a8baa206b9b4911d8eca23ac955d33">IS_ETH_ADDRESS_ALIGNED_BEATS</a>(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#ac7319cb734e946d17ce9a45917ba73fd">AddressAlignedBeats</a>));
<a name="l01714"></a>01714   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga49edfadc8a07750fb104b7dad0a15f42">IS_ETH_FIXED_BURST</a>(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a30f8334e0ecbbf5caba1c9e0a7c988fb">FixedBurst</a>));
<a name="l01715"></a>01715   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gaefb7ffe891dfbb50f58c085eb2b931ea">IS_ETH_RXDMA_BURST_LENGTH</a>(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a2d055f193279d8696dc8ad94a4886628">RxDMABurstLength</a>));
<a name="l01716"></a>01716   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#gacf7c896b34b70c9132cbc78db448d3e4">IS_ETH_TXDMA_BURST_LENGTH</a>(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#ae4adc8e35cb98f7ad8192f0b1b78022c">TxDMABurstLength</a>));
<a name="l01717"></a>01717   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga30fbde7ca9ea97de66a47ba1c063b3f0">IS_ETH_DMA_DESC_SKIP_LENGTH</a>(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a1bee942212738aacaa9b45f488c99e00">DescriptorSkipLength</a>));
<a name="l01718"></a>01718   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga9aaf1d4f05400c4b0ba5f490f4a9e244">IS_ETH_DMA_ARBITRATION_ROUNDROBIN_RXTX</a>(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a7b95306c46498650124436d3140e0dae">DMAArbitration</a>));
<a name="l01719"></a>01719 
<a name="l01720"></a>01720   <span class="comment">/*----------------------- ETHERNET DMAOMR Configuration --------------------*/</span>
<a name="l01721"></a>01721   <span class="comment">/* Get the ETHERNET DMAOMR value */</span>
<a name="l01722"></a>01722   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMAOMR;
<a name="l01723"></a>01723   <span class="comment">/* Clear xx bits */</span>
<a name="l01724"></a>01724   tmpreg1 &amp;= <a class="code" href="group/group__ETH__Private__Defines.html#gab9a3e4f97d820bf84963811f7635c736">ETH_DMAOMR_CLEAR_MASK</a>;
<a name="l01725"></a>01725 
<a name="l01726"></a>01726   tmpreg1 |= (uint32_t)(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#adde9f6029b172020ac6a1cb14bf8e68f">DropTCPIPChecksumErrorFrame</a> |
<a name="l01727"></a>01727                         dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a28be85beb274d8e6d94cf1f420bd5d4a">ReceiveStoreForward</a> |
<a name="l01728"></a>01728                         dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a92eee4059671bcae220c0d82134ce784">FlushReceivedFrame</a> |
<a name="l01729"></a>01729                         dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#ab4bdbc785494d0306541257217ff648f">TransmitStoreForward</a> |
<a name="l01730"></a>01730                         dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#af5238a7b937f08f857cb4fc9b13cc764">TransmitThresholdControl</a> |
<a name="l01731"></a>01731                         dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a2bf15d7481824d129c111a6a09fb9cca">ForwardErrorFrames</a> |
<a name="l01732"></a>01732                         dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a18cc15950193e4e110553cccc645dee2">ForwardUndersizedGoodFrames</a> |
<a name="l01733"></a>01733                         dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#ab692ba44c3abd7ebf524a6e0667b896d">ReceiveThresholdControl</a> |
<a name="l01734"></a>01734                         dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#ac517ce01c33a90d757d9bc601c86016a">SecondFrameOperate</a>);
<a name="l01735"></a>01735 
<a name="l01736"></a>01736   <span class="comment">/* Write to ETHERNET DMAOMR */</span>
<a name="l01737"></a>01737   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMAOMR = (uint32_t)tmpreg1;
<a name="l01738"></a>01738 
<a name="l01739"></a>01739   <span class="comment">/* Wait until the write operation will be taken into account:</span>
<a name="l01740"></a>01740 <span class="comment">  at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l01741"></a>01741   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMAOMR;
<a name="l01742"></a>01742   <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gae63b34eea12780ca2e1100c2402da18e" title="This function provides minimum delay (in milliseconds) based on variable incremented.">HAL_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l01743"></a>01743   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMAOMR = tmpreg1;
<a name="l01744"></a>01744 
<a name="l01745"></a>01745   <span class="comment">/*----------------------- ETHERNET DMABMR Configuration --------------------*/</span>
<a name="l01746"></a>01746   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMABMR = (uint32_t)(dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#ac7319cb734e946d17ce9a45917ba73fd">AddressAlignedBeats</a> |
<a name="l01747"></a>01747                                         dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a30f8334e0ecbbf5caba1c9e0a7c988fb">FixedBurst</a> |
<a name="l01748"></a>01748                                         dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a2d055f193279d8696dc8ad94a4886628">RxDMABurstLength</a> | <span class="comment">/* !! if 4xPBL is selected for Tx or Rx it is applied for the other */</span>
<a name="l01749"></a>01749                                         dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#ae4adc8e35cb98f7ad8192f0b1b78022c">TxDMABurstLength</a> |
<a name="l01750"></a>01750                                         (dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a1bee942212738aacaa9b45f488c99e00">DescriptorSkipLength</a> &lt;&lt; 2U) |
<a name="l01751"></a>01751                                         dmaconf-&gt;<a class="code" href="structETH__DMAInitTypeDef.html#a7b95306c46498650124436d3140e0dae">DMAArbitration</a> |
<a name="l01752"></a>01752                                         ETH_DMABMR_USP); <span class="comment">/* Enable use of separate PBL for Rx and Tx */</span>
<a name="l01753"></a>01753 
<a name="l01754"></a>01754   <span class="comment">/* Wait until the write operation will be taken into account:</span>
<a name="l01755"></a>01755 <span class="comment">     at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l01756"></a>01756   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMABMR;
<a name="l01757"></a>01757   <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gae63b34eea12780ca2e1100c2402da18e" title="This function provides minimum delay (in milliseconds) based on variable incremented.">HAL_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l01758"></a>01758   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMABMR = tmpreg1;
<a name="l01759"></a>01759 
<a name="l01760"></a>01760   <span class="comment">/* Set the ETH state to Ready */</span>
<a name="l01761"></a>01761   heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a> = <a class="code" href="group/group__ETH__Exported__Types.html#gga53086b23929278e203fa4ff0c46a57bfa50b0406bcb48418329720a408fc5cc50">HAL_ETH_STATE_READY</a>;
<a name="l01762"></a>01762 
<a name="l01763"></a>01763   <span class="comment">/* Process Unlocked */</span>
<a name="l01764"></a>01764   __HAL_UNLOCK(heth);
<a name="l01765"></a>01765 
<a name="l01766"></a>01766   <span class="comment">/* Return function status */</span>
<a name="l01767"></a>01767   <span class="keywordflow">return</span> HAL_OK;
<a name="l01768"></a>01768 }
<a name="l01769"></a>01769 <span class="comment"></span>
<a name="l01770"></a>01770 <span class="comment">/**</span>
<a name="l01771"></a>01771 <span class="comment">  * @}</span>
<a name="l01772"></a>01772 <span class="comment">  */</span>
<a name="l01773"></a>01773 <span class="comment"></span>
<a name="l01774"></a>01774 <span class="comment">/** @defgroup ETH_Exported_Functions_Group4 Peripheral State functions</span>
<a name="l01775"></a>01775 <span class="comment">  *  @brief   Peripheral State functions</span>
<a name="l01776"></a>01776 <span class="comment">  *</span>
<a name="l01777"></a>01777 <span class="comment">  @verbatim</span>
<a name="l01778"></a>01778 <span class="comment">  ===============================================================================</span>
<a name="l01779"></a>01779 <span class="comment">                         ##### Peripheral State functions #####</span>
<a name="l01780"></a>01780 <span class="comment">  ===============================================================================</span>
<a name="l01781"></a>01781 <span class="comment">  [..]</span>
<a name="l01782"></a>01782 <span class="comment">  This subsection permits to get in run-time the status of the peripheral</span>
<a name="l01783"></a>01783 <span class="comment">  and the data flow.</span>
<a name="l01784"></a>01784 <span class="comment">       (+) Get the ETH handle state:</span>
<a name="l01785"></a>01785 <span class="comment">           HAL_ETH_GetState();</span>
<a name="l01786"></a>01786 <span class="comment"></span>
<a name="l01787"></a>01787 <span class="comment"></span>
<a name="l01788"></a>01788 <span class="comment">  @endverbatim</span>
<a name="l01789"></a>01789 <span class="comment">  * @{</span>
<a name="l01790"></a>01790 <span class="comment">  */</span>
<a name="l01791"></a>01791 <span class="comment"></span>
<a name="l01792"></a>01792 <span class="comment">/**</span>
<a name="l01793"></a>01793 <span class="comment">  * @brief  Return the ETH HAL state</span>
<a name="l01794"></a>01794 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l01795"></a>01795 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l01796"></a>01796 <span class="comment">  * @retval HAL state</span>
<a name="l01797"></a>01797 <span class="comment">  */</span>
<a name="l01798"></a><a class="code" href="group/group__ETH__Exported__Functions__Group4.html#ga49cd7dc7bdf24e6ae46387d931330b9c">01798</a> <a class="code" href="group/group__ETH__Exported__Types.html#ga53086b23929278e203fa4ff0c46a57bf" title="HAL State structures definition.">HAL_ETH_StateTypeDef</a> <a class="code" href="group/group__ETH__Exported__Functions__Group4.html#ga49cd7dc7bdf24e6ae46387d931330b9c" title="Return the ETH HAL state.">HAL_ETH_GetState</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l01799"></a>01799 {
<a name="l01800"></a>01800   <span class="comment">/* Return ETH state */</span>
<a name="l01801"></a>01801   <span class="keywordflow">return</span> heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#af079af9dbb7a3ae370adde5c4e0df1e9">State</a>;
<a name="l01802"></a>01802 }
<a name="l01803"></a>01803 <span class="comment"></span>
<a name="l01804"></a>01804 <span class="comment">/**</span>
<a name="l01805"></a>01805 <span class="comment">  * @}</span>
<a name="l01806"></a>01806 <span class="comment">  */</span>
<a name="l01807"></a>01807 <span class="comment"></span>
<a name="l01808"></a>01808 <span class="comment">/**</span>
<a name="l01809"></a>01809 <span class="comment">  * @}</span>
<a name="l01810"></a>01810 <span class="comment">  */</span>
<a name="l01811"></a>01811 <span class="comment"></span>
<a name="l01812"></a>01812 <span class="comment">/** @addtogroup ETH_Private_Functions</span>
<a name="l01813"></a>01813 <span class="comment">  * @{</span>
<a name="l01814"></a>01814 <span class="comment">  */</span>
<a name="l01815"></a>01815 <span class="comment"></span>
<a name="l01816"></a>01816 <span class="comment">/**</span>
<a name="l01817"></a>01817 <span class="comment">  * @brief  Configures Ethernet MAC and DMA with default parameters.</span>
<a name="l01818"></a>01818 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l01819"></a>01819 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l01820"></a>01820 <span class="comment">  * @param  err: Ethernet Init error</span>
<a name="l01821"></a>01821 <span class="comment">  * @retval HAL status</span>
<a name="l01822"></a>01822 <span class="comment">  */</span>
<a name="l01823"></a><a class="code" href="group/group__ETH__Private__Functions.html#gab88fa6b6dcdf01c9924e353067112052">01823</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#gab88fa6b6dcdf01c9924e353067112052" title="Configures Ethernet MAC and DMA with default parameters.">ETH_MACDMAConfig</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth, uint32_t err)
<a name="l01824"></a>01824 {
<a name="l01825"></a>01825   <a class="code" href="structETH__MACInitTypeDef.html" title="ETH MAC Configuration Structure definition.">ETH_MACInitTypeDef</a> macinit;
<a name="l01826"></a>01826   <a class="code" href="structETH__DMAInitTypeDef.html" title="ETH DMA Configuration Structure definition.">ETH_DMAInitTypeDef</a> dmainit;
<a name="l01827"></a>01827   uint32_t tmpreg1 = 0U;
<a name="l01828"></a>01828 
<a name="l01829"></a>01829   <span class="keywordflow">if</span> (err != <a class="code" href="group/group__ETH__Private__Defines.html#ga2fb2e6248630a20832d42340e122c81c">ETH_SUCCESS</a>) <span class="comment">/* Auto-negotiation failed */</span>
<a name="l01830"></a>01830   {
<a name="l01831"></a>01831     <span class="comment">/* Set Ethernet duplex mode to Full-duplex */</span>
<a name="l01832"></a>01832     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).DuplexMode = <a class="code" href="group/group__ETH__Duplex__Mode.html#ga348c63c8ed45aa8db82b2854621a3e0f">ETH_MODE_FULLDUPLEX</a>;
<a name="l01833"></a>01833 
<a name="l01834"></a>01834     <span class="comment">/* Set Ethernet speed to 100M */</span>
<a name="l01835"></a>01835     (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).Speed = <a class="code" href="group/group__ETH__Speed.html#ga30250d05d2e66449bfde40ff20a5bc85">ETH_SPEED_100M</a>;
<a name="l01836"></a>01836   }
<a name="l01837"></a>01837 
<a name="l01838"></a>01838   <span class="comment">/* Ethernet MAC default initialization **************************************/</span>
<a name="l01839"></a>01839   macinit.<a class="code" href="structETH__MACInitTypeDef.html#abc70549d59dfd63ec88a225b5cdca2f6">Watchdog</a> = <a class="code" href="group/group__ETH__Watchdog.html#ga8e960be55af98cd030b83dc6685e21b0">ETH_WATCHDOG_ENABLE</a>;
<a name="l01840"></a>01840   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a402b274a00f90c4ecf64b4bf1bbdd954">Jabber</a> = <a class="code" href="group/group__ETH__Jabber.html#ga8bca160f056f677ddb84f8194c1e2b82">ETH_JABBER_ENABLE</a>;
<a name="l01841"></a>01841   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a8856bba09b2f077d5489ff617165f1b8">InterFrameGap</a> = <a class="code" href="group/group__ETH__Inter__Frame__Gap.html#ga69b762a479113084f689c381d41555ac">ETH_INTERFRAMEGAP_96BIT</a>;
<a name="l01842"></a>01842   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a04100c17d9f4f128c4ac5852e9394dcc">CarrierSense</a> = <a class="code" href="group/group__ETH__Carrier__Sense.html#ga6ed507b534ca9504b43736de7ab07d10">ETH_CARRIERSENCE_ENABLE</a>;
<a name="l01843"></a>01843   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a8bacba8c173fb53e2e554ec2133aa63e">ReceiveOwn</a> = <a class="code" href="group/group__ETH__Receive__Own.html#ga1afbf08abf73efb9b09169643e48957b">ETH_RECEIVEOWN_ENABLE</a>;
<a name="l01844"></a>01844   macinit.<a class="code" href="structETH__MACInitTypeDef.html#afde2312197db7915a028bfd3d7c28f6d">LoopbackMode</a> = <a class="code" href="group/group__ETH__Loop__Back__Mode.html#ga54bb70824756e8b470eb220b7805d48c">ETH_LOOPBACKMODE_DISABLE</a>;
<a name="l01845"></a>01845   <span class="keywordflow">if</span> (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#a416fc3299228f47bf581a6c6bd6a35d3">ChecksumMode</a> == <a class="code" href="group/group__ETH__Checksum__Mode.html#ga33e327fcecd000644e567173eb32a452">ETH_CHECKSUM_BY_HARDWARE</a>)
<a name="l01846"></a>01846   {
<a name="l01847"></a>01847     macinit.<a class="code" href="structETH__MACInitTypeDef.html#ad97ae0c7f2efe5b3a3627425e46b4435">ChecksumOffload</a> = <a class="code" href="group/group__ETH__Checksum__Offload.html#gaa2326f20aed459dffea082a3593b2cd3">ETH_CHECKSUMOFFLAOD_ENABLE</a>;
<a name="l01848"></a>01848   }
<a name="l01849"></a>01849   <span class="keywordflow">else</span>
<a name="l01850"></a>01850   {
<a name="l01851"></a>01851     macinit.<a class="code" href="structETH__MACInitTypeDef.html#ad97ae0c7f2efe5b3a3627425e46b4435">ChecksumOffload</a> = <a class="code" href="group/group__ETH__Checksum__Offload.html#gaaef324bb41604972acd3c57a5a8ce232">ETH_CHECKSUMOFFLAOD_DISABLE</a>;
<a name="l01852"></a>01852   }
<a name="l01853"></a>01853   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a19aaa3e133d2c2e385a2d271705bae0b">RetryTransmission</a> = <a class="code" href="group/group__ETH__Retry__Transmission.html#gac244d706f28224b8b3c3aad7025aed57">ETH_RETRYTRANSMISSION_DISABLE</a>;
<a name="l01854"></a>01854   macinit.<a class="code" href="structETH__MACInitTypeDef.html#ad6cb7a75669f90a9138490c941e2bb39">AutomaticPadCRCStrip</a> = <a class="code" href="group/group__ETH__Automatic__Pad__CRC__Strip.html#ga8a822338feee2f188014731815208810">ETH_AUTOMATICPADCRCSTRIP_DISABLE</a>;
<a name="l01855"></a>01855   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a9f4116699468469693618cc31046010d">BackOffLimit</a> = <a class="code" href="group/group__ETH__Back__Off__Limit.html#gac93ee6653fee190e4aaf19e76b531ac9">ETH_BACKOFFLIMIT_10</a>;
<a name="l01856"></a>01856   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a3ada22c49852e5be4ca42321a64c0f8a">DeferralCheck</a> = <a class="code" href="group/group__ETH__Deferral__Check.html#ga2c0aa0fd467b725cabfcf73918183900">ETH_DEFFERRALCHECK_DISABLE</a>;
<a name="l01857"></a>01857   macinit.<a class="code" href="structETH__MACInitTypeDef.html#aaf03ffe5b3ad36a9a877b616fdd34275">ReceiveAll</a> = <a class="code" href="group/group__ETH__Receive__All.html#ga68b064bd438be4608bac0bd7fa4b5223">ETH_RECEIVEAll_DISABLE</a>;
<a name="l01858"></a>01858   macinit.<a class="code" href="structETH__MACInitTypeDef.html#aad3a7f788eba5ec06aa98427177cc00b">SourceAddrFilter</a> = <a class="code" href="group/group__ETH__Source__Addr__Filter.html#ga9986bb0921304577f3af6d579d7ddd89">ETH_SOURCEADDRFILTER_DISABLE</a>;
<a name="l01859"></a>01859   macinit.<a class="code" href="structETH__MACInitTypeDef.html#abbdeea6b481c7fb15bda42f41bcace60">PassControlFrames</a> = <a class="code" href="group/group__ETH__Pass__Control__Frames.html#ga58dafd17473479115b3d4a6014859ce0">ETH_PASSCONTROLFRAMES_BLOCKALL</a>;
<a name="l01860"></a>01860   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a8d22f19753438b68c4393696a37b5ebd">BroadcastFramesReception</a> = <a class="code" href="group/group__ETH__Broadcast__Frames__Reception.html#ga5fdbf07ea351c033bb0c1981e470ddce">ETH_BROADCASTFRAMESRECEPTION_ENABLE</a>;
<a name="l01861"></a>01861   macinit.<a class="code" href="structETH__MACInitTypeDef.html#aa08b33448fe33adfa4d34e15f9bdb367">DestinationAddrFilter</a> = <a class="code" href="group/group__ETH__Destination__Addr__Filter.html#gae714e13dafb40939164497d8858057c2">ETH_DESTINATIONADDRFILTER_NORMAL</a>;
<a name="l01862"></a>01862   macinit.<a class="code" href="structETH__MACInitTypeDef.html#ae194255a7a780583482779b04ad90e4b">PromiscuousMode</a> = <a class="code" href="group/group__ETH__Promiscuous__Mode.html#ga7e7c002bb121815ffc26246bab3af8f3">ETH_PROMISCUOUS_MODE_DISABLE</a>;
<a name="l01863"></a>01863   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a6d7a07ade90f2905b01508d496e40b79">MulticastFramesFilter</a> = <a class="code" href="group/group__ETH__Multicast__Frames__Filter.html#ga926679e16556b26f34872329088f8e9e">ETH_MULTICASTFRAMESFILTER_PERFECT</a>;
<a name="l01864"></a>01864   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a7f24269f241e65b55ddbbcdc05a8b7c4">UnicastFramesFilter</a> = <a class="code" href="group/group__ETH__Unicast__Frames__Filter.html#gaf364a8e07cbbe94d721737315eebe90c">ETH_UNICASTFRAMESFILTER_PERFECT</a>;
<a name="l01865"></a>01865   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a113b43786edc8318b67387ad2871083d">HashTableHigh</a> = 0x0U;
<a name="l01866"></a>01866   macinit.<a class="code" href="structETH__MACInitTypeDef.html#ae66fa96348538e5480fb45f58bf91669">HashTableLow</a> = 0x0U;
<a name="l01867"></a>01867   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a726ebba49a7a4134996f3abafa1c1a0a">PauseTime</a> = 0x0U;
<a name="l01868"></a>01868   macinit.<a class="code" href="structETH__MACInitTypeDef.html#ae3604370b904432db12253d5a4827bcc">ZeroQuantaPause</a> = <a class="code" href="group/group__ETH__Zero__Quanta__Pause.html#ga925b6fdda3a81184aad147faa2243aa3">ETH_ZEROQUANTAPAUSE_DISABLE</a>;
<a name="l01869"></a>01869   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a3a03b793f92af5cce9471c19b23056d6">PauseLowThreshold</a> = <a class="code" href="group/group__ETH__Pause__Low__Threshold.html#gaf96811f3fc2d06c6416dc28ff2dc2f30">ETH_PAUSELOWTHRESHOLD_MINUS4</a>;
<a name="l01870"></a>01870   macinit.<a class="code" href="structETH__MACInitTypeDef.html#ae5dbb23f8b746ac923554d7756faba6d">UnicastPauseFrameDetect</a> = <a class="code" href="group/group__ETH__Unicast__Pause__Frame__Detect.html#ga1e331564fbada7c9eda581f4e421902b">ETH_UNICASTPAUSEFRAMEDETECT_DISABLE</a>;
<a name="l01871"></a>01871   macinit.<a class="code" href="structETH__MACInitTypeDef.html#acb293ed2557bba31392965021776e2a4">ReceiveFlowControl</a> = <a class="code" href="group/group__ETH__Receive__Flow__Control.html#gab2c9c6411f36bf79b02f5bbb9bbc29f7">ETH_RECEIVEFLOWCONTROL_DISABLE</a>;
<a name="l01872"></a>01872   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a4a974aedd9372947e4dadc2b8c3515a3">TransmitFlowControl</a> = <a class="code" href="group/group__ETH__Transmit__Flow__Control.html#gaec71f2740f7dc94e3042c49388a86b2a">ETH_TRANSMITFLOWCONTROL_DISABLE</a>;
<a name="l01873"></a>01873   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a32aa33a1fbeaf4ce516c0a27aa2c49f1">VLANTagComparison</a> = <a class="code" href="group/group__ETH__VLAN__Tag__Comparison.html#gaed57b74e39870e10b1f6733ed83dca91">ETH_VLANTAGCOMPARISON_16BIT</a>;
<a name="l01874"></a>01874   macinit.<a class="code" href="structETH__MACInitTypeDef.html#a3d6915ff0e524a1d042704d5a96589ed">VLANTagIdentifier</a> = 0x0U;
<a name="l01875"></a>01875 
<a name="l01876"></a>01876   <span class="comment">/*------------------------ ETHERNET MACCR Configuration --------------------*/</span>
<a name="l01877"></a>01877   <span class="comment">/* Get the ETHERNET MACCR value */</span>
<a name="l01878"></a>01878   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR;
<a name="l01879"></a>01879   <span class="comment">/* Clear WD, PCE, PS, TE and RE bits */</span>
<a name="l01880"></a>01880   tmpreg1 &amp;= <a class="code" href="group/group__ETH__Private__Defines.html#ga37701d0199bc22ea258985c6b59fc201">ETH_MACCR_CLEAR_MASK</a>;
<a name="l01881"></a>01881   <span class="comment">/* Set the WD bit according to ETH Watchdog value */</span>
<a name="l01882"></a>01882   <span class="comment">/* Set the JD: bit according to ETH Jabber value */</span>
<a name="l01883"></a>01883   <span class="comment">/* Set the IFG bit according to ETH InterFrameGap value */</span>
<a name="l01884"></a>01884   <span class="comment">/* Set the DCRS bit according to ETH CarrierSense value */</span>
<a name="l01885"></a>01885   <span class="comment">/* Set the FES bit according to ETH Speed value */</span>
<a name="l01886"></a>01886   <span class="comment">/* Set the DO bit according to ETH ReceiveOwn value */</span>
<a name="l01887"></a>01887   <span class="comment">/* Set the LM bit according to ETH LoopbackMode value */</span>
<a name="l01888"></a>01888   <span class="comment">/* Set the DM bit according to ETH Mode value */</span>
<a name="l01889"></a>01889   <span class="comment">/* Set the IPCO bit according to ETH ChecksumOffload value */</span>
<a name="l01890"></a>01890   <span class="comment">/* Set the DR bit according to ETH RetryTransmission value */</span>
<a name="l01891"></a>01891   <span class="comment">/* Set the ACS bit according to ETH AutomaticPadCRCStrip value */</span>
<a name="l01892"></a>01892   <span class="comment">/* Set the BL bit according to ETH BackOffLimit value */</span>
<a name="l01893"></a>01893   <span class="comment">/* Set the DC bit according to ETH DeferralCheck value */</span>
<a name="l01894"></a>01894   tmpreg1 |= (uint32_t)(macinit.<a class="code" href="structETH__MACInitTypeDef.html#abc70549d59dfd63ec88a225b5cdca2f6">Watchdog</a> |
<a name="l01895"></a>01895                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#a402b274a00f90c4ecf64b4bf1bbdd954">Jabber</a> |
<a name="l01896"></a>01896                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#a8856bba09b2f077d5489ff617165f1b8">InterFrameGap</a> |
<a name="l01897"></a>01897                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#a04100c17d9f4f128c4ac5852e9394dcc">CarrierSense</a> |
<a name="l01898"></a>01898                         (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).Speed |
<a name="l01899"></a>01899                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#a8bacba8c173fb53e2e554ec2133aa63e">ReceiveOwn</a> |
<a name="l01900"></a>01900                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#afde2312197db7915a028bfd3d7c28f6d">LoopbackMode</a> |
<a name="l01901"></a>01901                         (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).DuplexMode |
<a name="l01902"></a>01902                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#ad97ae0c7f2efe5b3a3627425e46b4435">ChecksumOffload</a> |
<a name="l01903"></a>01903                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#a19aaa3e133d2c2e385a2d271705bae0b">RetryTransmission</a> |
<a name="l01904"></a>01904                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#ad6cb7a75669f90a9138490c941e2bb39">AutomaticPadCRCStrip</a> |
<a name="l01905"></a>01905                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#a9f4116699468469693618cc31046010d">BackOffLimit</a> |
<a name="l01906"></a>01906                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#a3ada22c49852e5be4ca42321a64c0f8a">DeferralCheck</a>);
<a name="l01907"></a>01907 
<a name="l01908"></a>01908   <span class="comment">/* Write to ETHERNET MACCR */</span>
<a name="l01909"></a>01909   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR = (uint32_t)tmpreg1;
<a name="l01910"></a>01910 
<a name="l01911"></a>01911   <span class="comment">/* Wait until the write operation will be taken into account:</span>
<a name="l01912"></a>01912 <span class="comment">     at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l01913"></a>01913   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR;
<a name="l01914"></a>01914   <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gae63b34eea12780ca2e1100c2402da18e" title="This function provides minimum delay (in milliseconds) based on variable incremented.">HAL_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l01915"></a>01915   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR = tmpreg1;
<a name="l01916"></a>01916 
<a name="l01917"></a>01917   <span class="comment">/*----------------------- ETHERNET MACFFR Configuration --------------------*/</span>
<a name="l01918"></a>01918   <span class="comment">/* Set the RA bit according to ETH ReceiveAll value */</span>
<a name="l01919"></a>01919   <span class="comment">/* Set the SAF and SAIF bits according to ETH SourceAddrFilter value */</span>
<a name="l01920"></a>01920   <span class="comment">/* Set the PCF bit according to ETH PassControlFrames value */</span>
<a name="l01921"></a>01921   <span class="comment">/* Set the DBF bit according to ETH BroadcastFramesReception value */</span>
<a name="l01922"></a>01922   <span class="comment">/* Set the DAIF bit according to ETH DestinationAddrFilter value */</span>
<a name="l01923"></a>01923   <span class="comment">/* Set the PR bit according to ETH PromiscuousMode value */</span>
<a name="l01924"></a>01924   <span class="comment">/* Set the PM, HMC and HPF bits according to ETH MulticastFramesFilter value */</span>
<a name="l01925"></a>01925   <span class="comment">/* Set the HUC and HPF bits according to ETH UnicastFramesFilter value */</span>
<a name="l01926"></a>01926   <span class="comment">/* Write to ETHERNET MACFFR */</span>
<a name="l01927"></a>01927   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACFFR = (uint32_t)(macinit.<a class="code" href="structETH__MACInitTypeDef.html#aaf03ffe5b3ad36a9a877b616fdd34275">ReceiveAll</a> |
<a name="l01928"></a>01928                                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#aad3a7f788eba5ec06aa98427177cc00b">SourceAddrFilter</a> |
<a name="l01929"></a>01929                                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#abbdeea6b481c7fb15bda42f41bcace60">PassControlFrames</a> |
<a name="l01930"></a>01930                                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#a8d22f19753438b68c4393696a37b5ebd">BroadcastFramesReception</a> |
<a name="l01931"></a>01931                                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#aa08b33448fe33adfa4d34e15f9bdb367">DestinationAddrFilter</a> |
<a name="l01932"></a>01932                                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#ae194255a7a780583482779b04ad90e4b">PromiscuousMode</a> |
<a name="l01933"></a>01933                                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#a6d7a07ade90f2905b01508d496e40b79">MulticastFramesFilter</a> |
<a name="l01934"></a>01934                                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#a7f24269f241e65b55ddbbcdc05a8b7c4">UnicastFramesFilter</a>);
<a name="l01935"></a>01935 
<a name="l01936"></a>01936   <span class="comment">/* Wait until the write operation will be taken into account:</span>
<a name="l01937"></a>01937 <span class="comment">     at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l01938"></a>01938   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACFFR;
<a name="l01939"></a>01939   <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gae63b34eea12780ca2e1100c2402da18e" title="This function provides minimum delay (in milliseconds) based on variable incremented.">HAL_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l01940"></a>01940   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACFFR = tmpreg1;
<a name="l01941"></a>01941 
<a name="l01942"></a>01942   <span class="comment">/*--------------- ETHERNET MACHTHR and MACHTLR Configuration --------------*/</span>
<a name="l01943"></a>01943   <span class="comment">/* Write to ETHERNET MACHTHR */</span>
<a name="l01944"></a>01944   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACHTHR = (uint32_t)macinit.<a class="code" href="structETH__MACInitTypeDef.html#a113b43786edc8318b67387ad2871083d">HashTableHigh</a>;
<a name="l01945"></a>01945 
<a name="l01946"></a>01946   <span class="comment">/* Write to ETHERNET MACHTLR */</span>
<a name="l01947"></a>01947   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACHTLR = (uint32_t)macinit.<a class="code" href="structETH__MACInitTypeDef.html#ae66fa96348538e5480fb45f58bf91669">HashTableLow</a>;
<a name="l01948"></a>01948   <span class="comment">/*----------------------- ETHERNET MACFCR Configuration -------------------*/</span>
<a name="l01949"></a>01949 
<a name="l01950"></a>01950   <span class="comment">/* Get the ETHERNET MACFCR value */</span>
<a name="l01951"></a>01951   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACFCR;
<a name="l01952"></a>01952   <span class="comment">/* Clear xx bits */</span>
<a name="l01953"></a>01953   tmpreg1 &amp;= <a class="code" href="group/group__ETH__Private__Defines.html#ga758ca683139255de7b90bf1ec4ba064c">ETH_MACFCR_CLEAR_MASK</a>;
<a name="l01954"></a>01954 
<a name="l01955"></a>01955   <span class="comment">/* Set the PT bit according to ETH PauseTime value */</span>
<a name="l01956"></a>01956   <span class="comment">/* Set the DZPQ bit according to ETH ZeroQuantaPause value */</span>
<a name="l01957"></a>01957   <span class="comment">/* Set the PLT bit according to ETH PauseLowThreshold value */</span>
<a name="l01958"></a>01958   <span class="comment">/* Set the UP bit according to ETH UnicastPauseFrameDetect value */</span>
<a name="l01959"></a>01959   <span class="comment">/* Set the RFE bit according to ETH ReceiveFlowControl value */</span>
<a name="l01960"></a>01960   <span class="comment">/* Set the TFE bit according to ETH TransmitFlowControl value */</span>
<a name="l01961"></a>01961   tmpreg1 |= (uint32_t)((macinit.<a class="code" href="structETH__MACInitTypeDef.html#a726ebba49a7a4134996f3abafa1c1a0a">PauseTime</a> &lt;&lt; 16U) |
<a name="l01962"></a>01962                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#ae3604370b904432db12253d5a4827bcc">ZeroQuantaPause</a> |
<a name="l01963"></a>01963                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#a3a03b793f92af5cce9471c19b23056d6">PauseLowThreshold</a> |
<a name="l01964"></a>01964                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#ae5dbb23f8b746ac923554d7756faba6d">UnicastPauseFrameDetect</a> |
<a name="l01965"></a>01965                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#acb293ed2557bba31392965021776e2a4">ReceiveFlowControl</a> |
<a name="l01966"></a>01966                         macinit.<a class="code" href="structETH__MACInitTypeDef.html#a4a974aedd9372947e4dadc2b8c3515a3">TransmitFlowControl</a>);
<a name="l01967"></a>01967 
<a name="l01968"></a>01968   <span class="comment">/* Write to ETHERNET MACFCR */</span>
<a name="l01969"></a>01969   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACFCR = (uint32_t)tmpreg1;
<a name="l01970"></a>01970 
<a name="l01971"></a>01971   <span class="comment">/* Wait until the write operation will be taken into account:</span>
<a name="l01972"></a>01972 <span class="comment">  at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l01973"></a>01973   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACFCR;
<a name="l01974"></a>01974   <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gae63b34eea12780ca2e1100c2402da18e" title="This function provides minimum delay (in milliseconds) based on variable incremented.">HAL_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l01975"></a>01975   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACFCR = tmpreg1;
<a name="l01976"></a>01976 
<a name="l01977"></a>01977   <span class="comment">/*----------------------- ETHERNET MACVLANTR Configuration ----------------*/</span>
<a name="l01978"></a>01978   <span class="comment">/* Set the ETV bit according to ETH VLANTagComparison value */</span>
<a name="l01979"></a>01979   <span class="comment">/* Set the VL bit according to ETH VLANTagIdentifier value */</span>
<a name="l01980"></a>01980   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACVLANTR = (uint32_t)(macinit.<a class="code" href="structETH__MACInitTypeDef.html#a32aa33a1fbeaf4ce516c0a27aa2c49f1">VLANTagComparison</a> |
<a name="l01981"></a>01981                                            macinit.<a class="code" href="structETH__MACInitTypeDef.html#a3d6915ff0e524a1d042704d5a96589ed">VLANTagIdentifier</a>);
<a name="l01982"></a>01982 
<a name="l01983"></a>01983   <span class="comment">/* Wait until the write operation will be taken into account:</span>
<a name="l01984"></a>01984 <span class="comment">     at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l01985"></a>01985   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACVLANTR;
<a name="l01986"></a>01986   <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gae63b34eea12780ca2e1100c2402da18e" title="This function provides minimum delay (in milliseconds) based on variable incremented.">HAL_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l01987"></a>01987   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACVLANTR = tmpreg1;
<a name="l01988"></a>01988 
<a name="l01989"></a>01989   <span class="comment">/* Ethernet DMA default initialization ************************************/</span>
<a name="l01990"></a>01990   dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#adde9f6029b172020ac6a1cb14bf8e68f">DropTCPIPChecksumErrorFrame</a> = <a class="code" href="group/group__ETH__Drop__TCP__IP__Checksum__Error__Frame.html#gae30cffccf41e368bb2bc0db555dfb5bf">ETH_DROPTCPIPCHECKSUMERRORFRAME_ENABLE</a>;
<a name="l01991"></a>01991   dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a28be85beb274d8e6d94cf1f420bd5d4a">ReceiveStoreForward</a> = <a class="code" href="group/group__ETH__Receive__Store__Forward.html#ga18603c1b1e28a2a28bb2cabadcf7a6b7">ETH_RECEIVESTOREFORWARD_ENABLE</a>;
<a name="l01992"></a>01992   dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a92eee4059671bcae220c0d82134ce784">FlushReceivedFrame</a> = <a class="code" href="group/group__ETH__Flush__Received__Frame.html#ga7141e31582d2ec7092e45e31b6498b4b">ETH_FLUSHRECEIVEDFRAME_ENABLE</a>;
<a name="l01993"></a>01993   dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#ab4bdbc785494d0306541257217ff648f">TransmitStoreForward</a> = <a class="code" href="group/group__ETH__Transmit__Store__Forward.html#ga344c177d67cf8a51ca9b9d0aad0f6695">ETH_TRANSMITSTOREFORWARD_ENABLE</a>;
<a name="l01994"></a>01994   dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#af5238a7b937f08f857cb4fc9b13cc764">TransmitThresholdControl</a> = <a class="code" href="group/group__ETH__Transmit__Threshold__Control.html#ga3239bd3523b06a72f7c7a2abf52e1a0e">ETH_TRANSMITTHRESHOLDCONTROL_64BYTES</a>;
<a name="l01995"></a>01995   dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a2bf15d7481824d129c111a6a09fb9cca">ForwardErrorFrames</a> = <a class="code" href="group/group__ETH__Forward__Error__Frames.html#ga6d5f7619403f22f566711379812ab599">ETH_FORWARDERRORFRAMES_DISABLE</a>;
<a name="l01996"></a>01996   dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a18cc15950193e4e110553cccc645dee2">ForwardUndersizedGoodFrames</a> = <a class="code" href="group/group__ETH__Forward__Undersized__Good__Frames.html#gaea87354f84e353df2560169d981f638f">ETH_FORWARDUNDERSIZEDGOODFRAMES_DISABLE</a>;
<a name="l01997"></a>01997   dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#ab692ba44c3abd7ebf524a6e0667b896d">ReceiveThresholdControl</a> = <a class="code" href="group/group__ETH__Receive__Threshold__Control.html#ga7ede88da42a493de06d6c9cb9b0bc8f7">ETH_RECEIVEDTHRESHOLDCONTROL_64BYTES</a>;
<a name="l01998"></a>01998   dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#ac517ce01c33a90d757d9bc601c86016a">SecondFrameOperate</a> = <a class="code" href="group/group__ETH__Second__Frame__Operate.html#ga0165d12ad1b451b0ba08b82b2fef691f">ETH_SECONDFRAMEOPERARTE_ENABLE</a>;
<a name="l01999"></a>01999   dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#ac7319cb734e946d17ce9a45917ba73fd">AddressAlignedBeats</a> = <a class="code" href="group/group__ETH__Address__Aligned__Beats.html#ga5434dec7210731e7ecc09466c0360d82">ETH_ADDRESSALIGNEDBEATS_ENABLE</a>;
<a name="l02000"></a>02000   dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a30f8334e0ecbbf5caba1c9e0a7c988fb">FixedBurst</a> = <a class="code" href="group/group__ETH__Fixed__Burst.html#ga1f36d3969a79a4b2cb703304025400b1">ETH_FIXEDBURST_ENABLE</a>;
<a name="l02001"></a>02001   dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a2d055f193279d8696dc8ad94a4886628">RxDMABurstLength</a> = <a class="code" href="group/group__ETH__Rx__DMA__Burst__Length.html#gade3d1c6c4f8323acc047aa448d0b45b6">ETH_RXDMABURSTLENGTH_32BEAT</a>;
<a name="l02002"></a>02002   dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#ae4adc8e35cb98f7ad8192f0b1b78022c">TxDMABurstLength</a> = <a class="code" href="group/group__ETH__Tx__DMA__Burst__Length.html#gac70b5f18302aff78397447b6d9fe4f2e">ETH_TXDMABURSTLENGTH_32BEAT</a>;
<a name="l02003"></a>02003   dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a1bee942212738aacaa9b45f488c99e00">DescriptorSkipLength</a> = 0x0U;
<a name="l02004"></a>02004   dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a7b95306c46498650124436d3140e0dae">DMAArbitration</a> = <a class="code" href="group/group__ETH__DMA__Arbitration.html#ga9749abb369fb8e69951e2721ea03ceb1">ETH_DMAARBITRATION_ROUNDROBIN_RXTX_1_1</a>;
<a name="l02005"></a>02005 
<a name="l02006"></a>02006   <span class="comment">/* Get the ETHERNET DMAOMR value */</span>
<a name="l02007"></a>02007   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMAOMR;
<a name="l02008"></a>02008   <span class="comment">/* Clear xx bits */</span>
<a name="l02009"></a>02009   tmpreg1 &amp;= <a class="code" href="group/group__ETH__Private__Defines.html#gab9a3e4f97d820bf84963811f7635c736">ETH_DMAOMR_CLEAR_MASK</a>;
<a name="l02010"></a>02010 
<a name="l02011"></a>02011   <span class="comment">/* Set the DT bit according to ETH DropTCPIPChecksumErrorFrame value */</span>
<a name="l02012"></a>02012   <span class="comment">/* Set the RSF bit according to ETH ReceiveStoreForward value */</span>
<a name="l02013"></a>02013   <span class="comment">/* Set the DFF bit according to ETH FlushReceivedFrame value */</span>
<a name="l02014"></a>02014   <span class="comment">/* Set the TSF bit according to ETH TransmitStoreForward value */</span>
<a name="l02015"></a>02015   <span class="comment">/* Set the TTC bit according to ETH TransmitThresholdControl value */</span>
<a name="l02016"></a>02016   <span class="comment">/* Set the FEF bit according to ETH ForwardErrorFrames value */</span>
<a name="l02017"></a>02017   <span class="comment">/* Set the FUF bit according to ETH ForwardUndersizedGoodFrames value */</span>
<a name="l02018"></a>02018   <span class="comment">/* Set the RTC bit according to ETH ReceiveThresholdControl value */</span>
<a name="l02019"></a>02019   <span class="comment">/* Set the OSF bit according to ETH SecondFrameOperate value */</span>
<a name="l02020"></a>02020   tmpreg1 |= (uint32_t)(dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#adde9f6029b172020ac6a1cb14bf8e68f">DropTCPIPChecksumErrorFrame</a> |
<a name="l02021"></a>02021                         dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a28be85beb274d8e6d94cf1f420bd5d4a">ReceiveStoreForward</a> |
<a name="l02022"></a>02022                         dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a92eee4059671bcae220c0d82134ce784">FlushReceivedFrame</a> |
<a name="l02023"></a>02023                         dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#ab4bdbc785494d0306541257217ff648f">TransmitStoreForward</a> |
<a name="l02024"></a>02024                         dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#af5238a7b937f08f857cb4fc9b13cc764">TransmitThresholdControl</a> |
<a name="l02025"></a>02025                         dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a2bf15d7481824d129c111a6a09fb9cca">ForwardErrorFrames</a> |
<a name="l02026"></a>02026                         dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a18cc15950193e4e110553cccc645dee2">ForwardUndersizedGoodFrames</a> |
<a name="l02027"></a>02027                         dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#ab692ba44c3abd7ebf524a6e0667b896d">ReceiveThresholdControl</a> |
<a name="l02028"></a>02028                         dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#ac517ce01c33a90d757d9bc601c86016a">SecondFrameOperate</a>);
<a name="l02029"></a>02029 
<a name="l02030"></a>02030   <span class="comment">/* Write to ETHERNET DMAOMR */</span>
<a name="l02031"></a>02031   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMAOMR = (uint32_t)tmpreg1;
<a name="l02032"></a>02032 
<a name="l02033"></a>02033   <span class="comment">/* Wait until the write operation will be taken into account:</span>
<a name="l02034"></a>02034 <span class="comment">     at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l02035"></a>02035   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMAOMR;
<a name="l02036"></a>02036   <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gae63b34eea12780ca2e1100c2402da18e" title="This function provides minimum delay (in milliseconds) based on variable incremented.">HAL_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l02037"></a>02037   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMAOMR = tmpreg1;
<a name="l02038"></a>02038 
<a name="l02039"></a>02039   <span class="comment">/*----------------------- ETHERNET DMABMR Configuration ------------------*/</span>
<a name="l02040"></a>02040   <span class="comment">/* Set the AAL bit according to ETH AddressAlignedBeats value */</span>
<a name="l02041"></a>02041   <span class="comment">/* Set the FB bit according to ETH FixedBurst value */</span>
<a name="l02042"></a>02042   <span class="comment">/* Set the RPBL and 4*PBL bits according to ETH RxDMABurstLength value */</span>
<a name="l02043"></a>02043   <span class="comment">/* Set the PBL and 4*PBL bits according to ETH TxDMABurstLength value */</span>
<a name="l02044"></a>02044   <span class="comment">/* Set the DSL bit according to ETH DesciptorSkipLength value */</span>
<a name="l02045"></a>02045   <span class="comment">/* Set the PR and DA bits according to ETH DMAArbitration value */</span>
<a name="l02046"></a>02046   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMABMR = (uint32_t)(dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#ac7319cb734e946d17ce9a45917ba73fd">AddressAlignedBeats</a> |
<a name="l02047"></a>02047                                         dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a30f8334e0ecbbf5caba1c9e0a7c988fb">FixedBurst</a> |
<a name="l02048"></a>02048                                         dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a2d055f193279d8696dc8ad94a4886628">RxDMABurstLength</a> |    <span class="comment">/* !! if 4xPBL is selected for Tx or Rx it is applied for the other */</span>
<a name="l02049"></a>02049                                         dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#ae4adc8e35cb98f7ad8192f0b1b78022c">TxDMABurstLength</a> |
<a name="l02050"></a>02050                                         (dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a1bee942212738aacaa9b45f488c99e00">DescriptorSkipLength</a> &lt;&lt; 2U) |
<a name="l02051"></a>02051                                         dmainit.<a class="code" href="structETH__DMAInitTypeDef.html#a7b95306c46498650124436d3140e0dae">DMAArbitration</a> |
<a name="l02052"></a>02052                                         ETH_DMABMR_USP); <span class="comment">/* Enable use of separate PBL for Rx and Tx */</span>
<a name="l02053"></a>02053 
<a name="l02054"></a>02054   <span class="comment">/* Wait until the write operation will be taken into account:</span>
<a name="l02055"></a>02055 <span class="comment">     at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l02056"></a>02056   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMABMR;
<a name="l02057"></a>02057   <a class="code" href="group/group__HAL__Exported__Functions__Group2.html#gae63b34eea12780ca2e1100c2402da18e" title="This function provides minimum delay (in milliseconds) based on variable incremented.">HAL_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l02058"></a>02058   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMABMR = tmpreg1;
<a name="l02059"></a>02059 
<a name="l02060"></a>02060   <span class="keywordflow">if</span> ((heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>).RxMode == <a class="code" href="group/group__ETH__Rx__Mode.html#ga66f979e1658e1ecdc05a46f8c2b6073f">ETH_RXINTERRUPT_MODE</a>)
<a name="l02061"></a>02061   {
<a name="l02062"></a>02062     <span class="comment">/* Enable the Ethernet Rx Interrupt */</span>
<a name="l02063"></a>02063     <a class="code" href="group/group__ETH__Exported__Macros.html#gaaef5d4c4be8512c70397c0830c028f89" title="Enables the specified ETHERNET DMA interrupts.">__HAL_ETH_DMA_ENABLE_IT</a>((heth), <a class="code" href="group/group__ETH__DMA__Interrupts.html#ga2718ee2b32543a6617deec57c773ec02">ETH_DMA_IT_NIS</a> | <a class="code" href="group/group__ETH__DMA__Interrupts.html#ga1e28b6a79dc99f02b06d669a7b593b5b">ETH_DMA_IT_R</a>);
<a name="l02064"></a>02064   }
<a name="l02065"></a>02065 
<a name="l02066"></a>02066   <span class="comment">/* Initialize MAC address in ethernet MAC */</span>
<a name="l02067"></a>02067   <a class="code" href="group/group__ETH__Private__Functions.html#gad9cce41a1e68624c8ce48536a2f71bb6" title="Configures the selected MAC address.">ETH_MACAddressConfig</a>(heth, <a class="code" href="group/group__ETH__MAC__addresses.html#ga149bbc74b6ee6c30880b78b7b2b68dd3">ETH_MAC_ADDRESS0</a>, heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#a132423b4e5079b31e9d4adfe7658c919">Init</a>.<a class="code" href="structETH__InitTypeDef.html#ad3aa55f56ab0aeff1eefa209ca521bb0">MACAddr</a>);
<a name="l02068"></a>02068 }
<a name="l02069"></a>02069 <span class="comment"></span>
<a name="l02070"></a>02070 <span class="comment">/**</span>
<a name="l02071"></a>02071 <span class="comment">  * @brief  Configures the selected MAC address.</span>
<a name="l02072"></a>02072 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l02073"></a>02073 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l02074"></a>02074 <span class="comment">  * @param  MacAddr: The MAC address to configure</span>
<a name="l02075"></a>02075 <span class="comment">  *          This parameter can be one of the following values:</span>
<a name="l02076"></a>02076 <span class="comment">  *             @arg ETH_MAC_Address0: MAC Address0</span>
<a name="l02077"></a>02077 <span class="comment">  *             @arg ETH_MAC_Address1: MAC Address1</span>
<a name="l02078"></a>02078 <span class="comment">  *             @arg ETH_MAC_Address2: MAC Address2</span>
<a name="l02079"></a>02079 <span class="comment">  *             @arg ETH_MAC_Address3: MAC Address3</span>
<a name="l02080"></a>02080 <span class="comment">  * @param  Addr: Pointer to MAC address buffer data (6 bytes)</span>
<a name="l02081"></a>02081 <span class="comment">  * @retval HAL status</span>
<a name="l02082"></a>02082 <span class="comment">  */</span>
<a name="l02083"></a><a class="code" href="group/group__ETH__Private__Functions.html#gad9cce41a1e68624c8ce48536a2f71bb6">02083</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#gad9cce41a1e68624c8ce48536a2f71bb6" title="Configures the selected MAC address.">ETH_MACAddressConfig</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth, uint32_t MacAddr, uint8_t *Addr)
<a name="l02084"></a>02084 {
<a name="l02085"></a>02085   uint32_t tmpreg1;
<a name="l02086"></a>02086 
<a name="l02087"></a>02087   <span class="comment">/* Prevent unused argument(s) compilation warning */</span>
<a name="l02088"></a>02088   UNUSED(heth);
<a name="l02089"></a>02089 
<a name="l02090"></a>02090   <span class="comment">/* Check the parameters */</span>
<a name="l02091"></a>02091   <a class="code" href="stm32f1xx__hal__conf_8h.html#a631dea7b230e600555f979c62af1de21" title="Include module&#39;s header file.">assert_param</a>(<a class="code" href="group/group__ETH__Private__Macros.html#ga99a9878f6b1425da31ab9ed4b9c3d83c">IS_ETH_MAC_ADDRESS0123</a>(MacAddr));
<a name="l02092"></a>02092 
<a name="l02093"></a>02093   <span class="comment">/* Calculate the selected MAC address high register */</span>
<a name="l02094"></a>02094   tmpreg1 = ((uint32_t)Addr[5U] &lt;&lt; 8U) | (uint32_t)Addr[4U];
<a name="l02095"></a>02095   <span class="comment">/* Load the selected MAC address high register */</span>
<a name="l02096"></a>02096   (*(__IO uint32_t *)((uint32_t)(<a class="code" href="group/group__ETH__Private__Defines.html#ga85a9d7b17b05b08c64528e5b43b08ef4">ETH_MAC_ADDR_HBASE</a> + MacAddr))) = tmpreg1;
<a name="l02097"></a>02097   <span class="comment">/* Calculate the selected MAC address low register */</span>
<a name="l02098"></a>02098   tmpreg1 = ((uint32_t)Addr[3U] &lt;&lt; 24U) | ((uint32_t)Addr[2U] &lt;&lt; 16U) | ((uint32_t)Addr[1U] &lt;&lt; 8U) | Addr[0U];
<a name="l02099"></a>02099 
<a name="l02100"></a>02100   <span class="comment">/* Load the selected MAC address low register */</span>
<a name="l02101"></a>02101   (*(__IO uint32_t *)((uint32_t)(<a class="code" href="group/group__ETH__Private__Defines.html#ga5dc2dd58c5508a16cd61414a1c740529">ETH_MAC_ADDR_LBASE</a> + MacAddr))) = tmpreg1;
<a name="l02102"></a>02102 }
<a name="l02103"></a>02103 <span class="comment"></span>
<a name="l02104"></a>02104 <span class="comment">/**</span>
<a name="l02105"></a>02105 <span class="comment">  * @brief  Enables the MAC transmission.</span>
<a name="l02106"></a>02106 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l02107"></a>02107 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l02108"></a>02108 <span class="comment">  * @retval None</span>
<a name="l02109"></a>02109 <span class="comment">  */</span>
<a name="l02110"></a><a class="code" href="group/group__ETH__Private__Functions.html#gabb47dbf0dc21c9a513dd950ac0fc5a0d">02110</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#gabb47dbf0dc21c9a513dd950ac0fc5a0d" title="Enables the MAC transmission.">ETH_MACTransmissionEnable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l02111"></a>02111 {
<a name="l02112"></a>02112   __IO uint32_t tmpreg1 = 0U;
<a name="l02113"></a>02113 
<a name="l02114"></a>02114   <span class="comment">/* Enable the MAC transmission */</span>
<a name="l02115"></a>02115   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR |= ETH_MACCR_TE;
<a name="l02116"></a>02116 
<a name="l02117"></a>02117   <span class="comment">/* Wait until the write operation will be taken into account:</span>
<a name="l02118"></a>02118 <span class="comment">     at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l02119"></a>02119   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR;
<a name="l02120"></a>02120   <a class="code" href="group/group__ETH__Private__Functions.html#ga76faf4a9f268c24dccb0db6422c5a550" title="This function provides delay (in milliseconds) based on CPU cycles method.">ETH_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l02121"></a>02121   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR = tmpreg1;
<a name="l02122"></a>02122 }
<a name="l02123"></a>02123 <span class="comment"></span>
<a name="l02124"></a>02124 <span class="comment">/**</span>
<a name="l02125"></a>02125 <span class="comment">  * @brief  Disables the MAC transmission.</span>
<a name="l02126"></a>02126 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l02127"></a>02127 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l02128"></a>02128 <span class="comment">  * @retval None</span>
<a name="l02129"></a>02129 <span class="comment">  */</span>
<a name="l02130"></a><a class="code" href="group/group__ETH__Private__Functions.html#ga8d818da79bab22874e7915ccded59130">02130</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#ga8d818da79bab22874e7915ccded59130" title="Disables the MAC transmission.">ETH_MACTransmissionDisable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l02131"></a>02131 {
<a name="l02132"></a>02132   __IO uint32_t tmpreg1 = 0U;
<a name="l02133"></a>02133 
<a name="l02134"></a>02134   <span class="comment">/* Disable the MAC transmission */</span>
<a name="l02135"></a>02135   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR &amp;= ~ETH_MACCR_TE;
<a name="l02136"></a>02136 
<a name="l02137"></a>02137   <span class="comment">/* Wait until the write operation will be taken into account:</span>
<a name="l02138"></a>02138 <span class="comment">     at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l02139"></a>02139   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR;
<a name="l02140"></a>02140   <a class="code" href="group/group__ETH__Private__Functions.html#ga76faf4a9f268c24dccb0db6422c5a550" title="This function provides delay (in milliseconds) based on CPU cycles method.">ETH_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l02141"></a>02141   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR = tmpreg1;
<a name="l02142"></a>02142 }
<a name="l02143"></a>02143 <span class="comment"></span>
<a name="l02144"></a>02144 <span class="comment">/**</span>
<a name="l02145"></a>02145 <span class="comment">  * @brief  Enables the MAC reception.</span>
<a name="l02146"></a>02146 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l02147"></a>02147 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l02148"></a>02148 <span class="comment">  * @retval None</span>
<a name="l02149"></a>02149 <span class="comment">  */</span>
<a name="l02150"></a><a class="code" href="group/group__ETH__Private__Functions.html#ga745fa00d6214af8cecf06542f9e05d63">02150</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#ga745fa00d6214af8cecf06542f9e05d63" title="Enables the MAC reception.">ETH_MACReceptionEnable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l02151"></a>02151 {
<a name="l02152"></a>02152   __IO uint32_t tmpreg1 = 0U;
<a name="l02153"></a>02153 
<a name="l02154"></a>02154   <span class="comment">/* Enable the MAC reception */</span>
<a name="l02155"></a>02155   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR |= ETH_MACCR_RE;
<a name="l02156"></a>02156 
<a name="l02157"></a>02157   <span class="comment">/* Wait until the write operation will be taken into account:</span>
<a name="l02158"></a>02158 <span class="comment">     at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l02159"></a>02159   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR;
<a name="l02160"></a>02160   <a class="code" href="group/group__ETH__Private__Functions.html#ga76faf4a9f268c24dccb0db6422c5a550" title="This function provides delay (in milliseconds) based on CPU cycles method.">ETH_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l02161"></a>02161   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR = tmpreg1;
<a name="l02162"></a>02162 }
<a name="l02163"></a>02163 <span class="comment"></span>
<a name="l02164"></a>02164 <span class="comment">/**</span>
<a name="l02165"></a>02165 <span class="comment">  * @brief  Disables the MAC reception.</span>
<a name="l02166"></a>02166 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l02167"></a>02167 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l02168"></a>02168 <span class="comment">  * @retval None</span>
<a name="l02169"></a>02169 <span class="comment">  */</span>
<a name="l02170"></a><a class="code" href="group/group__ETH__Private__Functions.html#ga4d330655bc9aa7e89b0678c8e41dc843">02170</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#ga4d330655bc9aa7e89b0678c8e41dc843" title="Disables the MAC reception.">ETH_MACReceptionDisable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l02171"></a>02171 {
<a name="l02172"></a>02172   __IO uint32_t tmpreg1 = 0U;
<a name="l02173"></a>02173 
<a name="l02174"></a>02174   <span class="comment">/* Disable the MAC reception */</span>
<a name="l02175"></a>02175   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR &amp;= ~ETH_MACCR_RE;
<a name="l02176"></a>02176 
<a name="l02177"></a>02177   <span class="comment">/* Wait until the write operation will be taken into account:</span>
<a name="l02178"></a>02178 <span class="comment">     at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l02179"></a>02179   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR;
<a name="l02180"></a>02180   <a class="code" href="group/group__ETH__Private__Functions.html#ga76faf4a9f268c24dccb0db6422c5a550" title="This function provides delay (in milliseconds) based on CPU cycles method.">ETH_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l02181"></a>02181   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;MACCR = tmpreg1;
<a name="l02182"></a>02182 }
<a name="l02183"></a>02183 <span class="comment"></span>
<a name="l02184"></a>02184 <span class="comment">/**</span>
<a name="l02185"></a>02185 <span class="comment">  * @brief  Enables the DMA transmission.</span>
<a name="l02186"></a>02186 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l02187"></a>02187 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l02188"></a>02188 <span class="comment">  * @retval None</span>
<a name="l02189"></a>02189 <span class="comment">  */</span>
<a name="l02190"></a><a class="code" href="group/group__ETH__Private__Functions.html#ga93b1d3f59736fff1b50ef3ccc85c3bf6">02190</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#ga93b1d3f59736fff1b50ef3ccc85c3bf6" title="Enables the DMA transmission.">ETH_DMATransmissionEnable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l02191"></a>02191 {
<a name="l02192"></a>02192   <span class="comment">/* Enable the DMA transmission */</span>
<a name="l02193"></a>02193   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMAOMR |= ETH_DMAOMR_ST;
<a name="l02194"></a>02194 }
<a name="l02195"></a>02195 <span class="comment"></span>
<a name="l02196"></a>02196 <span class="comment">/**</span>
<a name="l02197"></a>02197 <span class="comment">  * @brief  Disables the DMA transmission.</span>
<a name="l02198"></a>02198 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l02199"></a>02199 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l02200"></a>02200 <span class="comment">  * @retval None</span>
<a name="l02201"></a>02201 <span class="comment">  */</span>
<a name="l02202"></a><a class="code" href="group/group__ETH__Private__Functions.html#ga58c934fdbdd20c3ec7a15f6e245933bf">02202</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#ga58c934fdbdd20c3ec7a15f6e245933bf" title="Disables the DMA transmission.">ETH_DMATransmissionDisable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l02203"></a>02203 {
<a name="l02204"></a>02204   <span class="comment">/* Disable the DMA transmission */</span>
<a name="l02205"></a>02205   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMAOMR &amp;= ~ETH_DMAOMR_ST;
<a name="l02206"></a>02206 }
<a name="l02207"></a>02207 <span class="comment"></span>
<a name="l02208"></a>02208 <span class="comment">/**</span>
<a name="l02209"></a>02209 <span class="comment">  * @brief  Enables the DMA reception.</span>
<a name="l02210"></a>02210 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l02211"></a>02211 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l02212"></a>02212 <span class="comment">  * @retval None</span>
<a name="l02213"></a>02213 <span class="comment">  */</span>
<a name="l02214"></a><a class="code" href="group/group__ETH__Private__Functions.html#ga40f6929c9bb79bbb13fcf8923090c4d7">02214</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#ga40f6929c9bb79bbb13fcf8923090c4d7" title="Enables the DMA reception.">ETH_DMAReceptionEnable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l02215"></a>02215 {
<a name="l02216"></a>02216   <span class="comment">/* Enable the DMA reception */</span>
<a name="l02217"></a>02217   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMAOMR |= ETH_DMAOMR_SR;
<a name="l02218"></a>02218 }
<a name="l02219"></a>02219 <span class="comment"></span>
<a name="l02220"></a>02220 <span class="comment">/**</span>
<a name="l02221"></a>02221 <span class="comment">  * @brief  Disables the DMA reception.</span>
<a name="l02222"></a>02222 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l02223"></a>02223 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l02224"></a>02224 <span class="comment">  * @retval None</span>
<a name="l02225"></a>02225 <span class="comment">  */</span>
<a name="l02226"></a><a class="code" href="group/group__ETH__Private__Functions.html#gaed0cf21dc49879e0fd45b2873d4a75e5">02226</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#gaed0cf21dc49879e0fd45b2873d4a75e5" title="Disables the DMA reception.">ETH_DMAReceptionDisable</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l02227"></a>02227 {
<a name="l02228"></a>02228   <span class="comment">/* Disable the DMA reception */</span>
<a name="l02229"></a>02229   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMAOMR &amp;= ~ETH_DMAOMR_SR;
<a name="l02230"></a>02230 }
<a name="l02231"></a>02231 <span class="comment"></span>
<a name="l02232"></a>02232 <span class="comment">/**</span>
<a name="l02233"></a>02233 <span class="comment">  * @brief  Clears the ETHERNET transmit FIFO.</span>
<a name="l02234"></a>02234 <span class="comment">  * @param  heth: pointer to a ETH_HandleTypeDef structure that contains</span>
<a name="l02235"></a>02235 <span class="comment">  *         the configuration information for ETHERNET module</span>
<a name="l02236"></a>02236 <span class="comment">  * @retval None</span>
<a name="l02237"></a>02237 <span class="comment">  */</span>
<a name="l02238"></a><a class="code" href="group/group__ETH__Private__Functions.html#gaf608a0b63258ad4adb1e9a14f8a0546f">02238</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#gaf608a0b63258ad4adb1e9a14f8a0546f" title="Clears the ETHERNET transmit FIFO.">ETH_FlushTransmitFIFO</a>(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l02239"></a>02239 {
<a name="l02240"></a>02240   __IO uint32_t tmpreg1 = 0U;
<a name="l02241"></a>02241 
<a name="l02242"></a>02242   <span class="comment">/* Set the Flush Transmit FIFO bit */</span>
<a name="l02243"></a>02243   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMAOMR |= ETH_DMAOMR_FTF;
<a name="l02244"></a>02244 
<a name="l02245"></a>02245   <span class="comment">/* Wait until the write operation will be taken into account:</span>
<a name="l02246"></a>02246 <span class="comment">     at least four TX_CLK/RX_CLK clock cycles */</span>
<a name="l02247"></a>02247   tmpreg1 = (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMAOMR;
<a name="l02248"></a>02248   <a class="code" href="group/group__ETH__Private__Functions.html#ga76faf4a9f268c24dccb0db6422c5a550" title="This function provides delay (in milliseconds) based on CPU cycles method.">ETH_Delay</a>(<a class="code" href="group/group__ETH__Private__Defines.html#gaad9bfc5cf3fe3e78b9a7a6f60e337f5d">ETH_REG_WRITE_DELAY</a>);
<a name="l02249"></a>02249   (heth-&gt;<a class="code" href="structETH__HandleTypeDef.html#ac5e7fd14533767a3aee2c05dd02e028f">Instance</a>)-&gt;DMAOMR = tmpreg1;
<a name="l02250"></a>02250 }
<a name="l02251"></a>02251 <span class="comment"></span>
<a name="l02252"></a>02252 <span class="comment">/**</span>
<a name="l02253"></a>02253 <span class="comment">  * @brief  This function provides delay (in milliseconds) based on CPU cycles method.</span>
<a name="l02254"></a>02254 <span class="comment">  * @param  mdelay: specifies the delay time length, in milliseconds.</span>
<a name="l02255"></a>02255 <span class="comment">  * @retval None</span>
<a name="l02256"></a>02256 <span class="comment">  */</span>
<a name="l02257"></a><a class="code" href="group/group__ETH__Private__Functions.html#ga76faf4a9f268c24dccb0db6422c5a550">02257</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group/group__ETH__Private__Functions.html#ga76faf4a9f268c24dccb0db6422c5a550" title="This function provides delay (in milliseconds) based on CPU cycles method.">ETH_Delay</a>(uint32_t mdelay)
<a name="l02258"></a>02258 {
<a name="l02259"></a>02259   __IO uint32_t Delay = mdelay * (SystemCoreClock / 8U / 1000U);
<a name="l02260"></a>02260   <span class="keywordflow">do</span>
<a name="l02261"></a>02261   {
<a name="l02262"></a>02262     __NOP();
<a name="l02263"></a>02263   }
<a name="l02264"></a>02264   <span class="keywordflow">while</span> (Delay --);
<a name="l02265"></a>02265 }
<a name="l02266"></a>02266 
<a name="l02267"></a>02267 <span class="preprocessor">#if (USE_HAL_ETH_REGISTER_CALLBACKS == 1)</span>
<a name="l02268"></a>02268 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> ETH_InitCallbacksToDefault(<a class="code" href="structETH__HandleTypeDef.html" title="ETH Handle Structure definition.">ETH_HandleTypeDef</a> *heth)
<a name="l02269"></a>02269 {
<a name="l02270"></a>02270   <span class="comment">/* Init the ETH Callback settings */</span>
<a name="l02271"></a>02271   heth-&gt;TxCpltCallback       = <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gac96b23dde481e897508e8b9ad69e3ecb" title="Tx Transfer completed callbacks.">HAL_ETH_TxCpltCallback</a>; <span class="comment">/* Legacy weak TxCpltCallback   */</span>
<a name="l02272"></a>02272   heth-&gt;RxCpltCallback       = <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gac0609dc4bf97bb5906afdab6b9428654" title="Rx Transfer completed callbacks.">HAL_ETH_RxCpltCallback</a>; <span class="comment">/* Legacy weak RxCpltCallback   */</span>
<a name="l02273"></a>02273   heth-&gt;DMAErrorCallback     = <a class="code" href="group/group__ETH__Exported__Functions__Group2.html#gabb9424d761aa8a5691f983c5aa842dbe" title="Ethernet transfer error callbacks.">HAL_ETH_ErrorCallback</a>;  <span class="comment">/* Legacy weak DMAErrorCallback */</span>
<a name="l02274"></a>02274 }
<a name="l02275"></a>02275 <span class="preprocessor">#endif </span><span class="comment">/* USE_HAL_ETH_REGISTER_CALLBACKS */</span>
<a name="l02276"></a>02276 <span class="comment"></span>
<a name="l02277"></a>02277 <span class="comment">/**</span>
<a name="l02278"></a>02278 <span class="comment">  * @}</span>
<a name="l02279"></a>02279 <span class="comment">  */</span>
<a name="l02280"></a>02280 
<a name="l02281"></a>02281 <span class="preprocessor">#endif </span><span class="comment">/* ETH */</span>
<a name="l02282"></a>02282 
<a name="l02283"></a>02283 <span class="preprocessor">#endif </span><span class="comment">/* HAL_ETH_MODULE_ENABLED */</span>
<a name="l02284"></a>02284 <span class="comment">/**</span>
<a name="l02285"></a>02285 <span class="comment">  * @}</span>
<a name="l02286"></a>02286 <span class="comment">  */</span>
<a name="l02287"></a>02287 <span class="comment"></span>
<a name="l02288"></a>02288 <span class="comment">/**</span>
<a name="l02289"></a>02289 <span class="comment">  * @}</span>
<a name="l02290"></a>02290 <span class="comment">  */</span>
<a name="l02291"></a>02291 
<a name="l02292"></a>02292 <span class="comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span>
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue May 14 2019 08:58:35 for STM32F107xC HAL User Manual by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
